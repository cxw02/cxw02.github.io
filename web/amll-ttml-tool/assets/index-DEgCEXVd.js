import{M as Yh,N as Jr,O as Zh,m as it,j as Ye,Q as Kh,d as Jh,u as ce,l as Qh,x as tl,U as el,V as rl,p as sl,W as il,X as nl}from"./index-Bue90L20.js";import{s as al,a as ol,l as hl}from"./preview-tmsyiqgT.js";var Ae=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(Ae||{}),Co=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(Co||{}),Ui=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Ui||{}),st=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(st||{}),Qr=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(Qr||{}),X=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(X||{}),Ze=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(Ze||{}),ot=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(ot||{}),W=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(W||{}),Qt=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(Qt||{}),nn=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(nn||{}),Se=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(Se||{}),Re=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(Re||{}),ye=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(ye||{}),an=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(an||{}),kt=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(kt||{}),It=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(It||{}),Rt=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(Rt||{}),Wt=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(Wt||{});const ll={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},ft={ADAPTER:ll,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Rs=/iPhone/i,Pn=/iPod/i,Nn=/iPad/i,On=/\biOS-universal(?:.+)Mac\b/i,Ms=/\bAndroid(?:.+)Mobile\b/i,Bn=/Android/i,Ne=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Ar=/Silk/i,Zt=/Windows Phone/i,kn=/\bWindows(?:.+)ARM\b/i,Un=/BlackBerry/i,Dn=/BB10/i,Gn=/Opera Mini/i,zn=/\b(CriOS|Chrome)(?:.+)Mobile/i,$n=/Mobile(?:.+)Firefox\b/i,Vn=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function ul(i){return function(t){return t.test(i)}}function Hn(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var s=ul(e),n={apple:{phone:s(Rs)&&!s(Zt),ipod:s(Pn),tablet:!s(Rs)&&(s(Nn)||Vn(t))&&!s(Zt),universal:s(On),device:(s(Rs)||s(Pn)||s(Nn)||s(On)||Vn(t))&&!s(Zt)},amazon:{phone:s(Ne),tablet:!s(Ne)&&s(Ar),device:s(Ne)||s(Ar)},android:{phone:!s(Zt)&&s(Ne)||!s(Zt)&&s(Ms),tablet:!s(Zt)&&!s(Ne)&&!s(Ms)&&(s(Ar)||s(Bn)),device:!s(Zt)&&(s(Ne)||s(Ar)||s(Ms)||s(Bn))||s(/\bokhttp\b/i)},windows:{phone:s(Zt),tablet:s(kn),device:s(Zt)||s(kn)},other:{blackberry:s(Un),blackberry10:s(Dn),opera:s(Gn),firefox:s($n),chrome:s(zn),device:s(Un)||s(Dn)||s(Gn)||s($n)||s(zn)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const cl=Hn.default??Hn,je=cl(globalThis.navigator);ft.RETINA_PREFIX=/@([0-9\.]+)x/;ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Is={exports:{}},qn;function dl(){return qn||(qn=1,function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function s(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function n(h,l,u,c,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new s(u,c||h,f),v=e?e+l:l;return h._events[v]?h._events[v].fn?h._events[v]=[h._events[v],p]:h._events[v].push(p):(h._events[v]=p,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],u,c;if(this._eventsCount===0)return l;for(c in u=this._events)t.call(u,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},o.prototype.listeners=function(l){var u=e?e+l:l,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var f=0,p=c.length,v=new Array(p);f<p;f++)v[f]=c[f].fn;return v},o.prototype.listenerCount=function(l){var u=e?e+l:l,c=this._events[u];return c?c.fn?1:c.length:0},o.prototype.emit=function(l,u,c,f,p,v){var g=e?e+l:l;if(!this._events[g])return!1;var d=this._events[g],y=arguments.length,x,E;if(d.fn){switch(d.once&&this.removeListener(l,d.fn,void 0,!0),y){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,u),!0;case 3:return d.fn.call(d.context,u,c),!0;case 4:return d.fn.call(d.context,u,c,f),!0;case 5:return d.fn.call(d.context,u,c,f,p),!0;case 6:return d.fn.call(d.context,u,c,f,p,v),!0}for(E=1,x=new Array(y-1);E<y;E++)x[E-1]=arguments[E];d.fn.apply(d.context,x)}else{var w=d.length,m;for(E=0;E<w;E++)switch(d[E].once&&this.removeListener(l,d[E].fn,void 0,!0),y){case 1:d[E].fn.call(d[E].context);break;case 2:d[E].fn.call(d[E].context,u);break;case 3:d[E].fn.call(d[E].context,u,c);break;case 4:d[E].fn.call(d[E].context,u,c,f);break;default:if(!x)for(m=1,x=new Array(y-1);m<y;m++)x[m-1]=arguments[m];d[E].fn.apply(d[E].context,x)}}return!0},o.prototype.on=function(l,u,c){return n(this,l,u,c,!1)},o.prototype.once=function(l,u,c){return n(this,l,u,c,!0)},o.prototype.removeListener=function(l,u,c,f){var p=e?e+l:l;if(!this._events[p])return this;if(!u)return a(this,p),this;var v=this._events[p];if(v.fn)v.fn===u&&(!f||v.once)&&(!c||v.context===c)&&a(this,p);else{for(var g=0,d=[],y=v.length;g<y;g++)(v[g].fn!==u||f&&!v[g].once||c&&v[g].context!==c)&&d.push(v[g]);d.length?this._events[p]=d.length===1?d[0]:d:a(this,p)}return this},o.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&a(this,u)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,i.exports=o}(Is)),Is.exports}var fl=dl();const us=Yh(fl);var Rr={exports:{}},Xn;function pl(){if(Xn)return Rr.exports;Xn=1,Rr.exports=i,Rr.exports.default=i;function i(T,A,b){b=b||2;var F=A&&A.length,R=F?A[0]*b:T.length,M=t(T,0,R,b,!0),N=[];if(!M||M.next===M.prev)return N;var P,G,z,Y,Z,K,tt;if(F&&(M=h(T,A,M,b)),T.length>80*b){P=z=T[0],G=Y=T[1];for(var q=b;q<R;q+=b)Z=T[q],K=T[q+1],Z<P&&(P=Z),K<G&&(G=K),Z>z&&(z=Z),K>Y&&(Y=K);tt=Math.max(z-P,Y-G),tt=tt!==0?32767/tt:0}return r(M,N,b,P,G,tt,0),N}function t(T,A,b,F,R){var M,N;if(R===V(T,A,b,F)>0)for(M=A;M<b;M+=F)N=L(M,T[M],T[M+1],N);else for(M=b-F;M>=A;M-=F)N=L(M,T[M],T[M+1],N);return N&&w(N,N.next)&&(j(N),N=N.next),N}function e(T,A){if(!T)return T;A||(A=T);var b=T,F;do if(F=!1,!b.steiner&&(w(b,b.next)||E(b.prev,b,b.next)===0)){if(j(b),b=A=b.prev,b===b.next)break;F=!0}else b=b.next;while(F||b!==A);return A}function r(T,A,b,F,R,M,N){if(T){!N&&M&&p(T,F,R,M);for(var P=T,G,z;T.prev!==T.next;){if(G=T.prev,z=T.next,M?n(T,F,R,M):s(T)){A.push(G.i/b|0),A.push(T.i/b|0),A.push(z.i/b|0),j(T),T=z.next,P=z.next;continue}if(T=z,T===P){N?N===1?(T=a(e(T),A,b),r(T,A,b,F,R,M,2)):N===2&&o(T,A,b,F,R,M):r(e(T),A,b,F,R,M,1);break}}}}function s(T){var A=T.prev,b=T,F=T.next;if(E(A,b,F)>=0)return!1;for(var R=A.x,M=b.x,N=F.x,P=A.y,G=b.y,z=F.y,Y=R<M?R<N?R:N:M<N?M:N,Z=P<G?P<z?P:z:G<z?G:z,K=R>M?R>N?R:N:M>N?M:N,tt=P>G?P>z?P:z:G>z?G:z,q=F.next;q!==A;){if(q.x>=Y&&q.x<=K&&q.y>=Z&&q.y<=tt&&y(R,P,M,G,N,z,q.x,q.y)&&E(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function n(T,A,b,F){var R=T.prev,M=T,N=T.next;if(E(R,M,N)>=0)return!1;for(var P=R.x,G=M.x,z=N.x,Y=R.y,Z=M.y,K=N.y,tt=P<G?P<z?P:z:G<z?G:z,q=Y<Z?Y<K?Y:K:Z<K?Z:K,et=P>G?P>z?P:z:G>z?G:z,rt=Y>Z?Y>K?Y:K:Z>K?Z:K,lt=g(tt,q,A,b,F),dt=g(et,rt,A,b,F),J=T.prevZ,Q=T.nextZ;J&&J.z>=lt&&Q&&Q.z<=dt;){if(J.x>=tt&&J.x<=et&&J.y>=q&&J.y<=rt&&J!==R&&J!==N&&y(P,Y,G,Z,z,K,J.x,J.y)&&E(J.prev,J,J.next)>=0||(J=J.prevZ,Q.x>=tt&&Q.x<=et&&Q.y>=q&&Q.y<=rt&&Q!==R&&Q!==N&&y(P,Y,G,Z,z,K,Q.x,Q.y)&&E(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;J&&J.z>=lt;){if(J.x>=tt&&J.x<=et&&J.y>=q&&J.y<=rt&&J!==R&&J!==N&&y(P,Y,G,Z,z,K,J.x,J.y)&&E(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;Q&&Q.z<=dt;){if(Q.x>=tt&&Q.x<=et&&Q.y>=q&&Q.y<=rt&&Q!==R&&Q!==N&&y(P,Y,G,Z,z,K,Q.x,Q.y)&&E(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function a(T,A,b){var F=T;do{var R=F.prev,M=F.next.next;!w(R,M)&&m(R,F,F.next,M)&&U(R,M)&&U(M,R)&&(A.push(R.i/b|0),A.push(F.i/b|0),A.push(M.i/b|0),j(F),j(F.next),F=T=M),F=F.next}while(F!==T);return e(F)}function o(T,A,b,F,R,M){var N=T;do{for(var P=N.next.next;P!==N.prev;){if(N.i!==P.i&&x(N,P)){var G=D(N,P);N=e(N,N.next),G=e(G,G.next),r(N,A,b,F,R,M,0),r(G,A,b,F,R,M,0);return}P=P.next}N=N.next}while(N!==T)}function h(T,A,b,F){var R=[],M,N,P,G,z;for(M=0,N=A.length;M<N;M++)P=A[M]*F,G=M<N-1?A[M+1]*F:T.length,z=t(T,P,G,F,!1),z===z.next&&(z.steiner=!0),R.push(d(z));for(R.sort(l),M=0;M<R.length;M++)b=u(R[M],b);return b}function l(T,A){return T.x-A.x}function u(T,A){var b=c(T,A);if(!b)return A;var F=D(b,T);return e(F,F.next),e(b,b.next)}function c(T,A){var b=A,F=T.x,R=T.y,M=-1/0,N;do{if(R<=b.y&&R>=b.next.y&&b.next.y!==b.y){var P=b.x+(R-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(P<=F&&P>M&&(M=P,N=b.x<b.next.x?b:b.next,P===F))return N}b=b.next}while(b!==A);if(!N)return null;var G=N,z=N.x,Y=N.y,Z=1/0,K;b=N;do F>=b.x&&b.x>=z&&F!==b.x&&y(R<Y?F:M,R,z,Y,R<Y?M:F,R,b.x,b.y)&&(K=Math.abs(R-b.y)/(F-b.x),U(b,T)&&(K<Z||K===Z&&(b.x>N.x||b.x===N.x&&f(N,b)))&&(N=b,Z=K)),b=b.next;while(b!==G);return N}function f(T,A){return E(T.prev,T,A.prev)<0&&E(A.next,T,T.next)<0}function p(T,A,b,F){var R=T;do R.z===0&&(R.z=g(R.x,R.y,A,b,F)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==T);R.prevZ.nextZ=null,R.prevZ=null,v(R)}function v(T){var A,b,F,R,M,N,P,G,z=1;do{for(b=T,T=null,M=null,N=0;b;){for(N++,F=b,P=0,A=0;A<z&&(P++,F=F.nextZ,!!F);A++);for(G=z;P>0||G>0&&F;)P!==0&&(G===0||!F||b.z<=F.z)?(R=b,b=b.nextZ,P--):(R=F,F=F.nextZ,G--),M?M.nextZ=R:T=R,R.prevZ=M,M=R;b=F}M.nextZ=null,z*=2}while(N>1);return T}function g(T,A,b,F,R){return T=(T-b)*R|0,A=(A-F)*R|0,T=(T|T<<8)&16711935,T=(T|T<<4)&252645135,T=(T|T<<2)&858993459,T=(T|T<<1)&1431655765,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,T|A<<1}function d(T){var A=T,b=T;do(A.x<b.x||A.x===b.x&&A.y<b.y)&&(b=A),A=A.next;while(A!==T);return b}function y(T,A,b,F,R,M,N,P){return(R-N)*(A-P)>=(T-N)*(M-P)&&(T-N)*(F-P)>=(b-N)*(A-P)&&(b-N)*(M-P)>=(R-N)*(F-P)}function x(T,A){return T.next.i!==A.i&&T.prev.i!==A.i&&!B(T,A)&&(U(T,A)&&U(A,T)&&k(T,A)&&(E(T.prev,T,A.prev)||E(T,A.prev,A))||w(T,A)&&E(T.prev,T,T.next)>0&&E(A.prev,A,A.next)>0)}function E(T,A,b){return(A.y-T.y)*(b.x-A.x)-(A.x-T.x)*(b.y-A.y)}function w(T,A){return T.x===A.x&&T.y===A.y}function m(T,A,b,F){var R=_(E(T,A,b)),M=_(E(T,A,F)),N=_(E(b,F,T)),P=_(E(b,F,A));return!!(R!==M&&N!==P||R===0&&S(T,b,A)||M===0&&S(T,F,A)||N===0&&S(b,T,F)||P===0&&S(b,A,F))}function S(T,A,b){return A.x<=Math.max(T.x,b.x)&&A.x>=Math.min(T.x,b.x)&&A.y<=Math.max(T.y,b.y)&&A.y>=Math.min(T.y,b.y)}function _(T){return T>0?1:T<0?-1:0}function B(T,A){var b=T;do{if(b.i!==T.i&&b.next.i!==T.i&&b.i!==A.i&&b.next.i!==A.i&&m(b,b.next,T,A))return!0;b=b.next}while(b!==T);return!1}function U(T,A){return E(T.prev,T,T.next)<0?E(T,A,T.next)>=0&&E(T,T.prev,A)>=0:E(T,A,T.prev)<0||E(T,T.next,A)<0}function k(T,A){var b=T,F=!1,R=(T.x+A.x)/2,M=(T.y+A.y)/2;do b.y>M!=b.next.y>M&&b.next.y!==b.y&&R<(b.next.x-b.x)*(M-b.y)/(b.next.y-b.y)+b.x&&(F=!F),b=b.next;while(b!==T);return F}function D(T,A){var b=new H(T.i,T.x,T.y),F=new H(A.i,A.x,A.y),R=T.next,M=A.prev;return T.next=A,A.prev=T,b.next=R,R.prev=b,F.next=b,b.prev=F,M.next=F,F.prev=M,F}function L(T,A,b,F){var R=new H(T,A,b);return F?(R.next=F.next,R.prev=F,F.next.prev=R,F.next=R):(R.prev=R,R.next=R),R}function j(T){T.next.prev=T.prev,T.prev.next=T.next,T.prevZ&&(T.prevZ.nextZ=T.nextZ),T.nextZ&&(T.nextZ.prevZ=T.prevZ)}function H(T,A,b){this.i=T,this.x=A,this.y=b,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(T,A,b,F){var R=A&&A.length,M=R?A[0]*b:T.length,N=Math.abs(V(T,0,M,b));if(R)for(var P=0,G=A.length;P<G;P++){var z=A[P]*b,Y=P<G-1?A[P+1]*b:T.length;N-=Math.abs(V(T,z,Y,b))}var Z=0;for(P=0;P<F.length;P+=3){var K=F[P]*b,tt=F[P+1]*b,q=F[P+2]*b;Z+=Math.abs((T[K]-T[q])*(T[tt+1]-T[K+1])-(T[K]-T[tt])*(T[q+1]-T[K+1]))}return N===0&&Z===0?0:Math.abs((Z-N)/N)};function V(T,A,b,F){for(var R=0,M=A,N=b-F;M<b;M+=F)R+=(T[N]-T[M])*(T[M+1]+T[N+1]),N=M;return R}return i.flatten=function(T){for(var A=T[0][0].length,b={vertices:[],holes:[],dimensions:A},F=0,R=0;R<T.length;R++){for(var M=0;M<T[R].length;M++)for(var N=0;N<A;N++)b.vertices.push(T[R][M][N]);R>0&&(F+=T[R-1].length,b.holes.push(F))}return b},Rr.exports}pl();var de={},ur={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var ml=ur.exports,jn;function yl(){return jn||(jn=1,function(i,t){(function(e){var r=t&&!t.nodeType&&t,s=i&&!i.nodeType&&i,n=typeof Jr=="object"&&Jr;(n.global===n||n.window===n||n.self===n)&&(e=n);var a,o=2147483647,h=36,l=1,u=26,c=38,f=700,p=72,v=128,g="-",d=/^xn--/,y=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=h-l,m=Math.floor,S=String.fromCharCode,_;function B(R){throw new RangeError(E[R])}function U(R,M){for(var N=R.length,P=[];N--;)P[N]=M(R[N]);return P}function k(R,M){var N=R.split("@"),P="";N.length>1&&(P=N[0]+"@",R=N[1]),R=R.replace(x,".");var G=R.split("."),z=U(G,M).join(".");return P+z}function D(R){for(var M=[],N=0,P=R.length,G,z;N<P;)G=R.charCodeAt(N++),G>=55296&&G<=56319&&N<P?(z=R.charCodeAt(N++),(z&64512)==56320?M.push(((G&1023)<<10)+(z&1023)+65536):(M.push(G),N--)):M.push(G);return M}function L(R){return U(R,function(M){var N="";return M>65535&&(M-=65536,N+=S(M>>>10&1023|55296),M=56320|M&1023),N+=S(M),N}).join("")}function j(R){return R-48<10?R-22:R-65<26?R-65:R-97<26?R-97:h}function H(R,M){return R+22+75*(R<26)-((M!=0)<<5)}function V(R,M,N){var P=0;for(R=N?m(R/f):R>>1,R+=m(R/M);R>w*u>>1;P+=h)R=m(R/w);return m(P+(w+1)*R/(R+c))}function T(R){var M=[],N=R.length,P,G=0,z=v,Y=p,Z,K,tt,q,et,rt,lt,dt,J;for(Z=R.lastIndexOf(g),Z<0&&(Z=0),K=0;K<Z;++K)R.charCodeAt(K)>=128&&B("not-basic"),M.push(R.charCodeAt(K));for(tt=Z>0?Z+1:0;tt<N;){for(q=G,et=1,rt=h;tt>=N&&B("invalid-input"),lt=j(R.charCodeAt(tt++)),(lt>=h||lt>m((o-G)/et))&&B("overflow"),G+=lt*et,dt=rt<=Y?l:rt>=Y+u?u:rt-Y,!(lt<dt);rt+=h)J=h-dt,et>m(o/J)&&B("overflow"),et*=J;P=M.length+1,Y=V(G-q,P,q==0),m(G/P)>o-z&&B("overflow"),z+=m(G/P),G%=P,M.splice(G++,0,z)}return L(M)}function A(R){var M,N,P,G,z,Y,Z,K,tt,q,et,rt=[],lt,dt,J,Q;for(R=D(R),lt=R.length,M=v,N=0,z=p,Y=0;Y<lt;++Y)et=R[Y],et<128&&rt.push(S(et));for(P=G=rt.length,G&&rt.push(g);P<lt;){for(Z=o,Y=0;Y<lt;++Y)et=R[Y],et>=M&&et<Z&&(Z=et);for(dt=P+1,Z-M>m((o-N)/dt)&&B("overflow"),N+=(Z-M)*dt,M=Z,Y=0;Y<lt;++Y)if(et=R[Y],et<M&&++N>o&&B("overflow"),et==M){for(K=N,tt=h;q=tt<=z?l:tt>=z+u?u:tt-z,!(K<q);tt+=h)Q=K-q,J=h-q,rt.push(S(H(q+Q%J,0))),K=m(Q/J);rt.push(S(H(K,0))),z=V(N,dt,P==G),N=0,++P}++N,++M}return rt.join("")}function b(R){return k(R,function(M){return d.test(M)?T(M.slice(4).toLowerCase()):M})}function F(R){return k(R,function(M){return y.test(M)?"xn--"+A(M):M})}if(a={version:"1.4.1",ucs2:{decode:D,encode:L},decode:T,encode:A,toASCII:F,toUnicode:b},r&&s)if(i.exports==r)s.exports=a;else for(_ in a)a.hasOwnProperty(_)&&(r[_]=a[_]);else e.punycode=a})(ml)}(ur,ur.exports)),ur.exports}var Cs,Wn;function rr(){return Wn||(Wn=1,Cs=TypeError),Cs}const gl={},vl=Object.freeze(Object.defineProperty({__proto__:null,default:gl},Symbol.toStringTag,{value:"Module"})),_l=Zh(vl);var Ls,Yn;function cs(){if(Yn)return Ls;Yn=1;var i=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=i&&t&&typeof t.get=="function"?t.get:null,r=i&&Map.prototype.forEach,s=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=s&&n&&typeof n.get=="function"?n.get:null,o=s&&Set.prototype.forEach,h=typeof WeakMap=="function"&&WeakMap.prototype,l=h?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,c=u?WeakSet.prototype.has:null,f=typeof WeakRef=="function"&&WeakRef.prototype,p=f?WeakRef.prototype.deref:null,v=Boolean.prototype.valueOf,g=Object.prototype.toString,d=Function.prototype.toString,y=String.prototype.match,x=String.prototype.slice,E=String.prototype.replace,w=String.prototype.toUpperCase,m=String.prototype.toLowerCase,S=RegExp.prototype.test,_=Array.prototype.concat,B=Array.prototype.join,U=Array.prototype.slice,k=Math.floor,D=typeof BigInt=="function"?BigInt.prototype.valueOf:null,L=Object.getOwnPropertySymbols,j=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,H=typeof Symbol=="function"&&typeof Symbol.iterator=="object",V=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===H||!0)?Symbol.toStringTag:null,T=Object.prototype.propertyIsEnumerable,A=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(C){return C.__proto__}:null);function b(C,O){if(C===1/0||C===-1/0||C!==C||C&&C>-1e3&&C<1e3||S.call(/e/,O))return O;var pt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof C=="number"){var Tt=C<0?-k(-C):k(C);if(Tt!==C){var wt=String(Tt),at=x.call(O,wt.length+1);return E.call(wt,pt,"$&_")+"."+E.call(E.call(at,/([0-9]{3})/g,"$&_"),/_$/,"")}}return E.call(O,pt,"$&_")}var F=_l,R=F.custom,M=dt(R)?R:null,N={__proto__:null,double:'"',single:"'"},P={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};Ls=function C(O,pt,Tt,wt){var at=pt||{};if(Mt(at,"quoteStyle")&&!Mt(N,at.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Mt(at,"maxStringLength")&&(typeof at.maxStringLength=="number"?at.maxStringLength<0&&at.maxStringLength!==1/0:at.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var re=Mt(at,"customInspect")?at.customInspect:!0;if(typeof re!="boolean"&&re!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Mt(at,"indent")&&at.indent!==null&&at.indent!=="	"&&!(parseInt(at.indent,10)===at.indent&&at.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Mt(at,"numericSeparator")&&typeof at.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var ue=at.numericSeparator;if(typeof O>"u")return"undefined";if(O===null)return"null";if(typeof O=="boolean")return O?"true":"false";if(typeof O=="string")return En(O,at);if(typeof O=="number"){if(O===0)return 1/0/O>0?"0":"-0";var Ot=String(O);return ue?b(O,Ot):Ot}if(typeof O=="bigint"){var se=String(O)+"n";return ue?b(O,se):se}var xs=typeof at.depth>"u"?5:at.depth;if(typeof Tt>"u"&&(Tt=0),Tt>=xs&&xs>0&&typeof O=="object")return Z(O)?"[Array]":"[Object]";var Fe=Xh(at,Tt);if(typeof wt>"u")wt=[];else if(ee(wt,O)>=0)return"[Circular]";function Gt(Pe,Sr,Wh){if(Sr&&(wt=U.call(wt),wt.push(Sr)),Wh){var Fn={depth:at.depth};return Mt(at,"quoteStyle")&&(Fn.quoteStyle=at.quoteStyle),C(Pe,Fn,Tt+1,wt)}return C(Pe,at,Tt+1,wt)}if(typeof O=="function"&&!tt(O)){var Sn=Me(O),An=Er(O,Gt);return"[Function"+(Sn?": "+Sn:" (anonymous)")+"]"+(An.length>0?" { "+B.call(An,", ")+" }":"")}if(dt(O)){var Rn=H?E.call(String(O),/^(Symbol\(.*\))_[^)]*$/,"$1"):j.call(O);return typeof O=="object"&&!H?ir(Rn):Rn}if(Vh(O)){for(var nr="<"+m.call(String(O.nodeName)),bs=O.attributes||[],wr=0;wr<bs.length;wr++)nr+=" "+bs[wr].name+"="+G(z(bs[wr].value),"double",at);return nr+=">",O.childNodes&&O.childNodes.length&&(nr+="..."),nr+="</"+m.call(String(O.nodeName))+">",nr}if(Z(O)){if(O.length===0)return"[]";var Ts=Er(O,Gt);return Fe&&!qh(Ts)?"["+_s(Ts,Fe)+"]":"[ "+B.call(Ts,", ")+" ]"}if(q(O)){var Es=Er(O,Gt);return!("cause"in Error.prototype)&&"cause"in O&&!T.call(O,"cause")?"{ ["+String(O)+"] "+B.call(_.call("[cause]: "+Gt(O.cause),Es),", ")+" }":Es.length===0?"["+String(O)+"]":"{ ["+String(O)+"] "+B.call(Es,", ")+" }"}if(typeof O=="object"&&re){if(M&&typeof O[M]=="function"&&F)return F(O,{depth:xs-Tt});if(re!=="symbol"&&typeof O.inspect=="function")return O.inspect()}if(Dt(O)){var Mn=[];return r&&r.call(O,function(Pe,Sr){Mn.push(Gt(Sr,O,!0)+" => "+Gt(Pe,O))}),wn("Map",e.call(O),Mn,Fe)}if(Le(O)){var In=[];return o&&o.call(O,function(Pe){In.push(Gt(Pe,O))}),wn("Set",a.call(O),In,Fe)}if(Ie(O))return vs("WeakMap");if($h(O))return vs("WeakSet");if(Ce(O))return vs("WeakRef");if(rt(O))return ir(Gt(Number(O)));if(J(O))return ir(Gt(D.call(O)));if(lt(O))return ir(v.call(O));if(et(O))return ir(Gt(String(O)));if(typeof window<"u"&&O===window)return"{ [object Window] }";if(typeof globalThis<"u"&&O===globalThis||typeof Jr<"u"&&O===Jr)return"{ [object globalThis] }";if(!K(O)&&!tt(O)){var ws=Er(O,Gt),Cn=A?A(O)===Object.prototype:O instanceof Object||O.constructor===Object,Ss=O instanceof Object?"":"null prototype",Ln=!Cn&&V&&Object(O)===O&&V in O?x.call(Nt(O),8,-1):Ss?"Object":"",jh=Cn||typeof O.constructor!="function"?"":O.constructor.name?O.constructor.name+" ":"",As=jh+(Ln||Ss?"["+B.call(_.call([],Ln||[],Ss||[]),": ")+"] ":"");return ws.length===0?As+"{}":Fe?As+"{"+_s(ws,Fe)+"}":As+"{ "+B.call(ws,", ")+" }"}return String(O)};function G(C,O,pt){var Tt=pt.quoteStyle||O,wt=N[Tt];return wt+C+wt}function z(C){return E.call(String(C),/"/g,"&quot;")}function Y(C){return!V||!(typeof C=="object"&&(V in C||typeof C[V]<"u"))}function Z(C){return Nt(C)==="[object Array]"&&Y(C)}function K(C){return Nt(C)==="[object Date]"&&Y(C)}function tt(C){return Nt(C)==="[object RegExp]"&&Y(C)}function q(C){return Nt(C)==="[object Error]"&&Y(C)}function et(C){return Nt(C)==="[object String]"&&Y(C)}function rt(C){return Nt(C)==="[object Number]"&&Y(C)}function lt(C){return Nt(C)==="[object Boolean]"&&Y(C)}function dt(C){if(H)return C&&typeof C=="object"&&C instanceof Symbol;if(typeof C=="symbol")return!0;if(!C||typeof C!="object"||!j)return!1;try{return j.call(C),!0}catch{}return!1}function J(C){if(!C||typeof C!="object"||!D)return!1;try{return D.call(C),!0}catch{}return!1}var Q=Object.prototype.hasOwnProperty||function(C){return C in this};function Mt(C,O){return Q.call(C,O)}function Nt(C){return g.call(C)}function Me(C){if(C.name)return C.name;var O=y.call(d.call(C),/^function\s*([\w$]+)/);return O?O[1]:null}function ee(C,O){if(C.indexOf)return C.indexOf(O);for(var pt=0,Tt=C.length;pt<Tt;pt++)if(C[pt]===O)return pt;return-1}function Dt(C){if(!e||!C||typeof C!="object")return!1;try{e.call(C);try{a.call(C)}catch{return!0}return C instanceof Map}catch{}return!1}function Ie(C){if(!l||!C||typeof C!="object")return!1;try{l.call(C,l);try{c.call(C,c)}catch{return!0}return C instanceof WeakMap}catch{}return!1}function Ce(C){if(!p||!C||typeof C!="object")return!1;try{return p.call(C),!0}catch{}return!1}function Le(C){if(!a||!C||typeof C!="object")return!1;try{a.call(C);try{e.call(C)}catch{return!0}return C instanceof Set}catch{}return!1}function $h(C){if(!c||!C||typeof C!="object")return!1;try{c.call(C,c);try{l.call(C,l)}catch{return!0}return C instanceof WeakSet}catch{}return!1}function Vh(C){return!C||typeof C!="object"?!1:typeof HTMLElement<"u"&&C instanceof HTMLElement?!0:typeof C.nodeName=="string"&&typeof C.getAttribute=="function"}function En(C,O){if(C.length>O.maxStringLength){var pt=C.length-O.maxStringLength,Tt="... "+pt+" more character"+(pt>1?"s":"");return En(x.call(C,0,O.maxStringLength),O)+Tt}var wt=P[O.quoteStyle||"single"];wt.lastIndex=0;var at=E.call(E.call(C,wt,"\\$1"),/[\x00-\x1f]/g,Hh);return G(at,"single",O)}function Hh(C){var O=C.charCodeAt(0),pt={8:"b",9:"t",10:"n",12:"f",13:"r"}[O];return pt?"\\"+pt:"\\x"+(O<16?"0":"")+w.call(O.toString(16))}function ir(C){return"Object("+C+")"}function vs(C){return C+" { ? }"}function wn(C,O,pt,Tt){var wt=Tt?_s(pt,Tt):B.call(pt,", ");return C+" ("+O+") {"+wt+"}"}function qh(C){for(var O=0;O<C.length;O++)if(ee(C[O],`
`)>=0)return!1;return!0}function Xh(C,O){var pt;if(C.indent==="	")pt="	";else if(typeof C.indent=="number"&&C.indent>0)pt=B.call(Array(C.indent+1)," ");else return null;return{base:pt,prev:B.call(Array(O+1),pt)}}function _s(C,O){if(C.length===0)return"";var pt=`
`+O.prev+O.base;return pt+B.call(C,","+pt)+`
`+O.prev}function Er(C,O){var pt=Z(C),Tt=[];if(pt){Tt.length=C.length;for(var wt=0;wt<C.length;wt++)Tt[wt]=Mt(C,wt)?O(C[wt],C):""}var at=typeof L=="function"?L(C):[],re;if(H){re={};for(var ue=0;ue<at.length;ue++)re["$"+at[ue]]=at[ue]}for(var Ot in C)Mt(C,Ot)&&(pt&&String(Number(Ot))===Ot&&Ot<C.length||H&&re["$"+Ot]instanceof Symbol||(S.call(/[^\w$]/,Ot)?Tt.push(O(Ot,C)+": "+O(C[Ot],C)):Tt.push(Ot+": "+O(C[Ot],C))));if(typeof L=="function")for(var se=0;se<at.length;se++)T.call(C,at[se])&&Tt.push("["+O(at[se])+"]: "+O(C[at[se]],C));return Tt}return Ls}var Fs,Zn;function xl(){if(Zn)return Fs;Zn=1;var i=cs(),t=rr(),e=function(o,h,l){for(var u=o,c;(c=u.next)!=null;u=c)if(c.key===h)return u.next=c.next,l||(c.next=o.next,o.next=c),c},r=function(o,h){if(o){var l=e(o,h);return l&&l.value}},s=function(o,h,l){var u=e(o,h);u?u.value=l:o.next={key:h,next:o.next,value:l}},n=function(o,h){return o?!!e(o,h):!1},a=function(o,h){if(o)return e(o,h,!0)};return Fs=function(){var h,l={assert:function(u){if(!l.has(u))throw new t("Side channel does not contain "+i(u))},delete:function(u){var c=h&&h.next,f=a(h,u);return f&&c&&c===f&&(h=void 0),!!f},get:function(u){return r(h,u)},has:function(u){return n(h,u)},set:function(u,c){h||(h={next:void 0}),s(h,u,c)}};return l},Fs}var Ps,Kn;function Lo(){return Kn||(Kn=1,Ps=Object),Ps}var Ns,Jn;function bl(){return Jn||(Jn=1,Ns=Error),Ns}var Os,Qn;function Tl(){return Qn||(Qn=1,Os=EvalError),Os}var Bs,ta;function El(){return ta||(ta=1,Bs=RangeError),Bs}var ks,ea;function wl(){return ea||(ea=1,ks=ReferenceError),ks}var Us,ra;function Sl(){return ra||(ra=1,Us=SyntaxError),Us}var Ds,sa;function Al(){return sa||(sa=1,Ds=URIError),Ds}var Gs,ia;function Rl(){return ia||(ia=1,Gs=Math.abs),Gs}var zs,na;function Ml(){return na||(na=1,zs=Math.floor),zs}var $s,aa;function Il(){return aa||(aa=1,$s=Math.max),$s}var Vs,oa;function Cl(){return oa||(oa=1,Vs=Math.min),Vs}var Hs,ha;function Ll(){return ha||(ha=1,Hs=Math.pow),Hs}var qs,la;function Fl(){return la||(la=1,qs=Math.round),qs}var Xs,ua;function Pl(){return ua||(ua=1,Xs=Number.isNaN||function(t){return t!==t}),Xs}var js,ca;function Nl(){if(ca)return js;ca=1;var i=Pl();return js=function(e){return i(e)||e===0?e:e<0?-1:1},js}var Ws,da;function Ol(){return da||(da=1,Ws=Object.getOwnPropertyDescriptor),Ws}var Ys,fa;function Fo(){if(fa)return Ys;fa=1;var i=Ol();if(i)try{i([],"length")}catch{i=null}return Ys=i,Ys}var Zs,pa;function Bl(){if(pa)return Zs;pa=1;var i=Object.defineProperty||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}return Zs=i,Zs}var Ks,ma;function kl(){return ma||(ma=1,Ks=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(var n in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var a=Object.getOwnPropertySymbols(t);if(a.length!==1||a[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==s||o.enumerable!==!0)return!1}return!0}),Ks}var Js,ya;function Ul(){if(ya)return Js;ya=1;var i=typeof Symbol<"u"&&Symbol,t=kl();return Js=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Js}var Qs,ga;function Po(){return ga||(ga=1,Qs=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Qs}var ti,va;function No(){if(va)return ti;va=1;var i=Lo();return ti=i.getPrototypeOf||null,ti}var ei,_a;function Dl(){if(_a)return ei;_a=1;var i="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,e=Math.max,r="[object Function]",s=function(h,l){for(var u=[],c=0;c<h.length;c+=1)u[c]=h[c];for(var f=0;f<l.length;f+=1)u[f+h.length]=l[f];return u},n=function(h,l){for(var u=[],c=l,f=0;c<h.length;c+=1,f+=1)u[f]=h[c];return u},a=function(o,h){for(var l="",u=0;u<o.length;u+=1)l+=o[u],u+1<o.length&&(l+=h);return l};return ei=function(h){var l=this;if(typeof l!="function"||t.apply(l)!==r)throw new TypeError(i+l);for(var u=n(arguments,1),c,f=function(){if(this instanceof c){var y=l.apply(this,s(u,arguments));return Object(y)===y?y:this}return l.apply(h,s(u,arguments))},p=e(0,l.length-u.length),v=[],g=0;g<p;g++)v[g]="$"+g;if(c=Function("binder","return function ("+a(v,",")+"){ return binder.apply(this,arguments); }")(f),l.prototype){var d=function(){};d.prototype=l.prototype,c.prototype=new d,d.prototype=null}return c},ei}var ri,xa;function ds(){if(xa)return ri;xa=1;var i=Dl();return ri=Function.prototype.bind||i,ri}var si,ba;function on(){return ba||(ba=1,si=Function.prototype.call),si}var ii,Ta;function Oo(){return Ta||(Ta=1,ii=Function.prototype.apply),ii}var ni,Ea;function Gl(){return Ea||(Ea=1,ni=typeof Reflect<"u"&&Reflect&&Reflect.apply),ni}var ai,wa;function zl(){if(wa)return ai;wa=1;var i=ds(),t=Oo(),e=on(),r=Gl();return ai=r||i.call(e,t),ai}var oi,Sa;function Bo(){if(Sa)return oi;Sa=1;var i=ds(),t=rr(),e=on(),r=zl();return oi=function(n){if(n.length<1||typeof n[0]!="function")throw new t("a function is required");return r(i,e,n)},oi}var hi,Aa;function $l(){if(Aa)return hi;Aa=1;var i=Bo(),t=Fo(),e;try{e=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var r=!!e&&t&&t(Object.prototype,"__proto__"),s=Object,n=s.getPrototypeOf;return hi=r&&typeof r.get=="function"?i([r.get]):typeof n=="function"?function(o){return n(o==null?o:s(o))}:!1,hi}var li,Ra;function Vl(){if(Ra)return li;Ra=1;var i=Po(),t=No(),e=$l();return li=i?function(s){return i(s)}:t?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return t(s)}:e?function(s){return e(s)}:null,li}var ui,Ma;function Hl(){if(Ma)return ui;Ma=1;var i=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=ds();return ui=e.call(i,t),ui}var ci,Ia;function hn(){if(Ia)return ci;Ia=1;var i,t=Lo(),e=bl(),r=Tl(),s=El(),n=wl(),a=Sl(),o=rr(),h=Al(),l=Rl(),u=Ml(),c=Il(),f=Cl(),p=Ll(),v=Fl(),g=Nl(),d=Function,y=function(tt){try{return d('"use strict"; return ('+tt+").constructor;")()}catch{}},x=Fo(),E=Bl(),w=function(){throw new o},m=x?function(){try{return arguments.callee,w}catch{try{return x(arguments,"callee").get}catch{return w}}}():w,S=Ul()(),_=Vl(),B=No(),U=Po(),k=Oo(),D=on(),L={},j=typeof Uint8Array>"u"||!_?i:_(Uint8Array),H={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":S&&_?_([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":L,"%AsyncGenerator%":L,"%AsyncGeneratorFunction%":L,"%AsyncIteratorPrototype%":L,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?i:Float16Array,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":d,"%GeneratorFunction%":L,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":S&&_?_(_([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!S||!_?i:_(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":x,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":s,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!S||!_?i:_(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":S&&_?_(""[Symbol.iterator]()):i,"%Symbol%":S?Symbol:i,"%SyntaxError%":a,"%ThrowTypeError%":m,"%TypedArray%":j,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":h,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet,"%Function.prototype.call%":D,"%Function.prototype.apply%":k,"%Object.defineProperty%":E,"%Object.getPrototypeOf%":B,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":c,"%Math.min%":f,"%Math.pow%":p,"%Math.round%":v,"%Math.sign%":g,"%Reflect.getPrototypeOf%":U};if(_)try{null.error}catch(tt){var V=_(_(tt));H["%Error.prototype%"]=V}var T=function tt(q){var et;if(q==="%AsyncFunction%")et=y("async function () {}");else if(q==="%GeneratorFunction%")et=y("function* () {}");else if(q==="%AsyncGeneratorFunction%")et=y("async function* () {}");else if(q==="%AsyncGenerator%"){var rt=tt("%AsyncGeneratorFunction%");rt&&(et=rt.prototype)}else if(q==="%AsyncIteratorPrototype%"){var lt=tt("%AsyncGenerator%");lt&&_&&(et=_(lt.prototype))}return H[q]=et,et},A={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=ds(),F=Hl(),R=b.call(D,Array.prototype.concat),M=b.call(k,Array.prototype.splice),N=b.call(D,String.prototype.replace),P=b.call(D,String.prototype.slice),G=b.call(D,RegExp.prototype.exec),z=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Y=/\\(\\)?/g,Z=function(q){var et=P(q,0,1),rt=P(q,-1);if(et==="%"&&rt!=="%")throw new a("invalid intrinsic syntax, expected closing `%`");if(rt==="%"&&et!=="%")throw new a("invalid intrinsic syntax, expected opening `%`");var lt=[];return N(q,z,function(dt,J,Q,Mt){lt[lt.length]=Q?N(Mt,Y,"$1"):J||dt}),lt},K=function(q,et){var rt=q,lt;if(F(A,rt)&&(lt=A[rt],rt="%"+lt[0]+"%"),F(H,rt)){var dt=H[rt];if(dt===L&&(dt=T(rt)),typeof dt>"u"&&!et)throw new o("intrinsic "+q+" exists, but is not available. Please file an issue!");return{alias:lt,name:rt,value:dt}}throw new a("intrinsic "+q+" does not exist!")};return ci=function(q,et){if(typeof q!="string"||q.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof et!="boolean")throw new o('"allowMissing" argument must be a boolean');if(G(/^%?[^%]*%?$/,q)===null)throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var rt=Z(q),lt=rt.length>0?rt[0]:"",dt=K("%"+lt+"%",et),J=dt.name,Q=dt.value,Mt=!1,Nt=dt.alias;Nt&&(lt=Nt[0],M(rt,R([0,1],Nt)));for(var Me=1,ee=!0;Me<rt.length;Me+=1){var Dt=rt[Me],Ie=P(Dt,0,1),Ce=P(Dt,-1);if((Ie==='"'||Ie==="'"||Ie==="`"||Ce==='"'||Ce==="'"||Ce==="`")&&Ie!==Ce)throw new a("property names with quotes must have matching quotes");if((Dt==="constructor"||!ee)&&(Mt=!0),lt+="."+Dt,J="%"+lt+"%",F(H,J))Q=H[J];else if(Q!=null){if(!(Dt in Q)){if(!et)throw new o("base intrinsic for "+q+" exists, but the property is not available.");return}if(x&&Me+1>=rt.length){var Le=x(Q,Dt);ee=!!Le,ee&&"get"in Le&&!("originalValue"in Le.get)?Q=Le.get:Q=Q[Dt]}else ee=F(Q,Dt),Q=Q[Dt];ee&&!Mt&&(H[J]=Q)}}return Q},ci}var di,Ca;function ko(){if(Ca)return di;Ca=1;var i=hn(),t=Bo(),e=t([i("%String.prototype.indexOf%")]);return di=function(s,n){var a=i(s,!!n);return typeof a=="function"&&e(s,".prototype.")>-1?t([a]):a},di}var fi,La;function Uo(){if(La)return fi;La=1;var i=hn(),t=ko(),e=cs(),r=rr(),s=i("%Map%",!0),n=t("Map.prototype.get",!0),a=t("Map.prototype.set",!0),o=t("Map.prototype.has",!0),h=t("Map.prototype.delete",!0),l=t("Map.prototype.size",!0);return fi=!!s&&function(){var c,f={assert:function(p){if(!f.has(p))throw new r("Side channel does not contain "+e(p))},delete:function(p){if(c){var v=h(c,p);return l(c)===0&&(c=void 0),v}return!1},get:function(p){if(c)return n(c,p)},has:function(p){return c?o(c,p):!1},set:function(p,v){c||(c=new s),a(c,p,v)}};return f},fi}var pi,Fa;function ql(){if(Fa)return pi;Fa=1;var i=hn(),t=ko(),e=cs(),r=Uo(),s=rr(),n=i("%WeakMap%",!0),a=t("WeakMap.prototype.get",!0),o=t("WeakMap.prototype.set",!0),h=t("WeakMap.prototype.has",!0),l=t("WeakMap.prototype.delete",!0);return pi=n?function(){var c,f,p={assert:function(v){if(!p.has(v))throw new s("Side channel does not contain "+e(v))},delete:function(v){if(n&&v&&(typeof v=="object"||typeof v=="function")){if(c)return l(c,v)}else if(r&&f)return f.delete(v);return!1},get:function(v){return n&&v&&(typeof v=="object"||typeof v=="function")&&c?a(c,v):f&&f.get(v)},has:function(v){return n&&v&&(typeof v=="object"||typeof v=="function")&&c?h(c,v):!!f&&f.has(v)},set:function(v,g){n&&v&&(typeof v=="object"||typeof v=="function")?(c||(c=new n),o(c,v,g)):r&&(f||(f=r()),f.set(v,g))}};return p}:r,pi}var mi,Pa;function Xl(){if(Pa)return mi;Pa=1;var i=rr(),t=cs(),e=xl(),r=Uo(),s=ql(),n=s||r||e;return mi=function(){var o,h={assert:function(l){if(!h.has(l))throw new i("Side channel does not contain "+t(l))},delete:function(l){return!!o&&o.delete(l)},get:function(l){return o&&o.get(l)},has:function(l){return!!o&&o.has(l)},set:function(l,u){o||(o=n()),o.set(l,u)}};return h},mi}var yi,Na;function ln(){if(Na)return yi;Na=1;var i=String.prototype.replace,t=/%20/g,e={RFC1738:"RFC1738",RFC3986:"RFC3986"};return yi={default:e.RFC3986,formatters:{RFC1738:function(r){return i.call(r,t,"+")},RFC3986:function(r){return String(r)}},RFC1738:e.RFC1738,RFC3986:e.RFC3986},yi}var gi,Oa;function Do(){if(Oa)return gi;Oa=1;var i=ln(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r=function(){for(var d=[],y=0;y<256;++y)d.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return d}(),s=function(y){for(;y.length>1;){var x=y.pop(),E=x.obj[x.prop];if(e(E)){for(var w=[],m=0;m<E.length;++m)typeof E[m]<"u"&&w.push(E[m]);x.obj[x.prop]=w}}},n=function(y,x){for(var E=x&&x.plainObjects?{__proto__:null}:{},w=0;w<y.length;++w)typeof y[w]<"u"&&(E[w]=y[w]);return E},a=function d(y,x,E){if(!x)return y;if(typeof x!="object"&&typeof x!="function"){if(e(y))y.push(x);else if(y&&typeof y=="object")(E&&(E.plainObjects||E.allowPrototypes)||!t.call(Object.prototype,x))&&(y[x]=!0);else return[y,x];return y}if(!y||typeof y!="object")return[y].concat(x);var w=y;return e(y)&&!e(x)&&(w=n(y,E)),e(y)&&e(x)?(x.forEach(function(m,S){if(t.call(y,S)){var _=y[S];_&&typeof _=="object"&&m&&typeof m=="object"?y[S]=d(_,m,E):y.push(m)}else y[S]=m}),y):Object.keys(x).reduce(function(m,S){var _=x[S];return t.call(m,S)?m[S]=d(m[S],_,E):m[S]=_,m},w)},o=function(y,x){return Object.keys(x).reduce(function(E,w){return E[w]=x[w],E},y)},h=function(d,y,x){var E=d.replace(/\+/g," ");if(x==="iso-8859-1")return E.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(E)}catch{return E}},l=1024,u=function(y,x,E,w,m){if(y.length===0)return y;var S=y;if(typeof y=="symbol"?S=Symbol.prototype.toString.call(y):typeof y!="string"&&(S=String(y)),E==="iso-8859-1")return escape(S).replace(/%u[0-9a-f]{4}/gi,function(j){return"%26%23"+parseInt(j.slice(2),16)+"%3B"});for(var _="",B=0;B<S.length;B+=l){for(var U=S.length>=l?S.slice(B,B+l):S,k=[],D=0;D<U.length;++D){var L=U.charCodeAt(D);if(L===45||L===46||L===95||L===126||L>=48&&L<=57||L>=65&&L<=90||L>=97&&L<=122||m===i.RFC1738&&(L===40||L===41)){k[k.length]=U.charAt(D);continue}if(L<128){k[k.length]=r[L];continue}if(L<2048){k[k.length]=r[192|L>>6]+r[128|L&63];continue}if(L<55296||L>=57344){k[k.length]=r[224|L>>12]+r[128|L>>6&63]+r[128|L&63];continue}D+=1,L=65536+((L&1023)<<10|U.charCodeAt(D)&1023),k[k.length]=r[240|L>>18]+r[128|L>>12&63]+r[128|L>>6&63]+r[128|L&63]}_+=k.join("")}return _},c=function(y){for(var x=[{obj:{o:y},prop:"o"}],E=[],w=0;w<x.length;++w)for(var m=x[w],S=m.obj[m.prop],_=Object.keys(S),B=0;B<_.length;++B){var U=_[B],k=S[U];typeof k=="object"&&k!==null&&E.indexOf(k)===-1&&(x.push({obj:S,prop:U}),E.push(k))}return s(x),y},f=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},p=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},v=function(y,x){return[].concat(y,x)},g=function(y,x){if(e(y)){for(var E=[],w=0;w<y.length;w+=1)E.push(x(y[w]));return E}return x(y)};return gi={arrayToObject:n,assign:o,combine:v,compact:c,decode:h,encode:u,isBuffer:p,isRegExp:f,maybeMap:g,merge:a},gi}var vi,Ba;function jl(){if(Ba)return vi;Ba=1;var i=Xl(),t=Do(),e=ln(),r=Object.prototype.hasOwnProperty,s={brackets:function(d){return d+"[]"},comma:"comma",indices:function(d,y){return d+"["+y+"]"},repeat:function(d){return d}},n=Array.isArray,a=Array.prototype.push,o=function(g,d){a.apply(g,n(d)?d:[d])},h=Date.prototype.toISOString,l=e.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:e.formatters[l],indices:!1,serializeDate:function(d){return h.call(d)},skipNulls:!1,strictNullHandling:!1},c=function(d){return typeof d=="string"||typeof d=="number"||typeof d=="boolean"||typeof d=="symbol"||typeof d=="bigint"},f={},p=function g(d,y,x,E,w,m,S,_,B,U,k,D,L,j,H,V,T,A){for(var b=d,F=A,R=0,M=!1;(F=F.get(f))!==void 0&&!M;){var N=F.get(d);if(R+=1,typeof N<"u"){if(N===R)throw new RangeError("Cyclic object value");M=!0}typeof F.get(f)>"u"&&(R=0)}if(typeof U=="function"?b=U(y,b):b instanceof Date?b=L(b):x==="comma"&&n(b)&&(b=t.maybeMap(b,function(J){return J instanceof Date?L(J):J})),b===null){if(m)return B&&!V?B(y,u.encoder,T,"key",j):y;b=""}if(c(b)||t.isBuffer(b)){if(B){var P=V?y:B(y,u.encoder,T,"key",j);return[H(P)+"="+H(B(b,u.encoder,T,"value",j))]}return[H(y)+"="+H(String(b))]}var G=[];if(typeof b>"u")return G;var z;if(x==="comma"&&n(b))V&&B&&(b=t.maybeMap(b,B)),z=[{value:b.length>0?b.join(",")||null:void 0}];else if(n(U))z=U;else{var Y=Object.keys(b);z=k?Y.sort(k):Y}var Z=_?String(y).replace(/\./g,"%2E"):String(y),K=E&&n(b)&&b.length===1?Z+"[]":Z;if(w&&n(b)&&b.length===0)return K+"[]";for(var tt=0;tt<z.length;++tt){var q=z[tt],et=typeof q=="object"&&q&&typeof q.value<"u"?q.value:b[q];if(!(S&&et===null)){var rt=D&&_?String(q).replace(/\./g,"%2E"):String(q),lt=n(b)?typeof x=="function"?x(K,rt):K:K+(D?"."+rt:"["+rt+"]");A.set(d,R);var dt=i();dt.set(f,A),o(G,g(et,lt,x,E,w,m,S,_,x==="comma"&&V&&n(b)?null:B,U,k,D,L,j,H,V,T,dt))}}return G},v=function(d){if(!d)return u;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.encodeDotInKeys<"u"&&typeof d.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(d.encoder!==null&&typeof d.encoder<"u"&&typeof d.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=d.charset||u.charset;if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var x=e.default;if(typeof d.format<"u"){if(!r.call(e.formatters,d.format))throw new TypeError("Unknown format option provided.");x=d.format}var E=e.formatters[x],w=u.filter;(typeof d.filter=="function"||n(d.filter))&&(w=d.filter);var m;if(d.arrayFormat in s?m=d.arrayFormat:"indices"in d?m=d.indices?"indices":"repeat":m=u.arrayFormat,"commaRoundTrip"in d&&typeof d.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var S=typeof d.allowDots>"u"?d.encodeDotInKeys===!0?!0:u.allowDots:!!d.allowDots;return{addQueryPrefix:typeof d.addQueryPrefix=="boolean"?d.addQueryPrefix:u.addQueryPrefix,allowDots:S,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:m,charset:y,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!d.commaRoundTrip,delimiter:typeof d.delimiter>"u"?u.delimiter:d.delimiter,encode:typeof d.encode=="boolean"?d.encode:u.encode,encodeDotInKeys:typeof d.encodeDotInKeys=="boolean"?d.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof d.encoder=="function"?d.encoder:u.encoder,encodeValuesOnly:typeof d.encodeValuesOnly=="boolean"?d.encodeValuesOnly:u.encodeValuesOnly,filter:w,format:x,formatter:E,serializeDate:typeof d.serializeDate=="function"?d.serializeDate:u.serializeDate,skipNulls:typeof d.skipNulls=="boolean"?d.skipNulls:u.skipNulls,sort:typeof d.sort=="function"?d.sort:null,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:u.strictNullHandling}};return vi=function(g,d){var y=g,x=v(d),E,w;typeof x.filter=="function"?(w=x.filter,y=w("",y)):n(x.filter)&&(w=x.filter,E=w);var m=[];if(typeof y!="object"||y===null)return"";var S=s[x.arrayFormat],_=S==="comma"&&x.commaRoundTrip;E||(E=Object.keys(y)),x.sort&&E.sort(x.sort);for(var B=i(),U=0;U<E.length;++U){var k=E[U],D=y[k];x.skipNulls&&D===null||o(m,p(D,k,S,_,x.allowEmptyArrays,x.strictNullHandling,x.skipNulls,x.encodeDotInKeys,x.encode?x.encoder:null,x.filter,x.sort,x.allowDots,x.serializeDate,x.format,x.formatter,x.encodeValuesOnly,x.charset,B))}var L=m.join(x.delimiter),j=x.addQueryPrefix===!0?"?":"";return x.charsetSentinel&&(x.charset==="iso-8859-1"?j+="utf8=%26%2310003%3B&":j+="utf8=%E2%9C%93&"),L.length>0?j+L:""},vi}var _i,ka;function Wl(){if(ka)return _i;ka=1;var i=Do(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},s=function(f){return f.replace(/&#(\d+);/g,function(p,v){return String.fromCharCode(parseInt(v,10))})},n=function(f,p,v){if(f&&typeof f=="string"&&p.comma&&f.indexOf(",")>-1)return f.split(",");if(p.throwOnLimitExceeded&&v>=p.arrayLimit)throw new RangeError("Array limit exceeded. Only "+p.arrayLimit+" element"+(p.arrayLimit===1?"":"s")+" allowed in an array.");return f},a="utf8=%26%2310003%3B",o="utf8=%E2%9C%93",h=function(p,v){var g={__proto__:null},d=v.ignoreQueryPrefix?p.replace(/^\?/,""):p;d=d.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=v.parameterLimit===1/0?void 0:v.parameterLimit,x=d.split(v.delimiter,v.throwOnLimitExceeded?y+1:y);if(v.throwOnLimitExceeded&&x.length>y)throw new RangeError("Parameter limit exceeded. Only "+y+" parameter"+(y===1?"":"s")+" allowed.");var E=-1,w,m=v.charset;if(v.charsetSentinel)for(w=0;w<x.length;++w)x[w].indexOf("utf8=")===0&&(x[w]===o?m="utf-8":x[w]===a&&(m="iso-8859-1"),E=w,w=x.length);for(w=0;w<x.length;++w)if(w!==E){var S=x[w],_=S.indexOf("]="),B=_===-1?S.indexOf("="):_+1,U,k;B===-1?(U=v.decoder(S,r.decoder,m,"key"),k=v.strictNullHandling?null:""):(U=v.decoder(S.slice(0,B),r.decoder,m,"key"),k=i.maybeMap(n(S.slice(B+1),v,e(g[U])?g[U].length:0),function(L){return v.decoder(L,r.decoder,m,"value")})),k&&v.interpretNumericEntities&&m==="iso-8859-1"&&(k=s(String(k))),S.indexOf("[]=")>-1&&(k=e(k)?[k]:k);var D=t.call(g,U);D&&v.duplicates==="combine"?g[U]=i.combine(g[U],k):(!D||v.duplicates==="last")&&(g[U]=k)}return g},l=function(f,p,v,g){var d=0;if(f.length>0&&f[f.length-1]==="[]"){var y=f.slice(0,-1).join("");d=Array.isArray(p)&&p[y]?p[y].length:0}for(var x=g?p:n(p,v,d),E=f.length-1;E>=0;--E){var w,m=f[E];if(m==="[]"&&v.parseArrays)w=v.allowEmptyArrays&&(x===""||v.strictNullHandling&&x===null)?[]:i.combine([],x);else{w=v.plainObjects?{__proto__:null}:{};var S=m.charAt(0)==="["&&m.charAt(m.length-1)==="]"?m.slice(1,-1):m,_=v.decodeDotInKeys?S.replace(/%2E/g,"."):S,B=parseInt(_,10);!v.parseArrays&&_===""?w={0:x}:!isNaN(B)&&m!==_&&String(B)===_&&B>=0&&v.parseArrays&&B<=v.arrayLimit?(w=[],w[B]=x):_!=="__proto__"&&(w[_]=x)}x=w}return x},u=function(p,v,g,d){if(p){var y=g.allowDots?p.replace(/\.([^.[]+)/g,"[$1]"):p,x=/(\[[^[\]]*])/,E=/(\[[^[\]]*])/g,w=g.depth>0&&x.exec(y),m=w?y.slice(0,w.index):y,S=[];if(m){if(!g.plainObjects&&t.call(Object.prototype,m)&&!g.allowPrototypes)return;S.push(m)}for(var _=0;g.depth>0&&(w=E.exec(y))!==null&&_<g.depth;){if(_+=1,!g.plainObjects&&t.call(Object.prototype,w[1].slice(1,-1))&&!g.allowPrototypes)return;S.push(w[1])}if(w){if(g.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+g.depth+" and strictDepth is true");S.push("["+y.slice(w.index)+"]")}return l(S,v,g,d)}},c=function(p){if(!p)return r;if(typeof p.allowEmptyArrays<"u"&&typeof p.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof p.decodeDotInKeys<"u"&&typeof p.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(p.decoder!==null&&typeof p.decoder<"u"&&typeof p.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof p.throwOnLimitExceeded<"u"&&typeof p.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var v=typeof p.charset>"u"?r.charset:p.charset,g=typeof p.duplicates>"u"?r.duplicates:p.duplicates;if(g!=="combine"&&g!=="first"&&g!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var d=typeof p.allowDots>"u"?p.decodeDotInKeys===!0?!0:r.allowDots:!!p.allowDots;return{allowDots:d,allowEmptyArrays:typeof p.allowEmptyArrays=="boolean"?!!p.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof p.allowPrototypes=="boolean"?p.allowPrototypes:r.allowPrototypes,allowSparse:typeof p.allowSparse=="boolean"?p.allowSparse:r.allowSparse,arrayLimit:typeof p.arrayLimit=="number"?p.arrayLimit:r.arrayLimit,charset:v,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:r.charsetSentinel,comma:typeof p.comma=="boolean"?p.comma:r.comma,decodeDotInKeys:typeof p.decodeDotInKeys=="boolean"?p.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof p.decoder=="function"?p.decoder:r.decoder,delimiter:typeof p.delimiter=="string"||i.isRegExp(p.delimiter)?p.delimiter:r.delimiter,depth:typeof p.depth=="number"||p.depth===!1?+p.depth:r.depth,duplicates:g,ignoreQueryPrefix:p.ignoreQueryPrefix===!0,interpretNumericEntities:typeof p.interpretNumericEntities=="boolean"?p.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof p.parameterLimit=="number"?p.parameterLimit:r.parameterLimit,parseArrays:p.parseArrays!==!1,plainObjects:typeof p.plainObjects=="boolean"?p.plainObjects:r.plainObjects,strictDepth:typeof p.strictDepth=="boolean"?!!p.strictDepth:r.strictDepth,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof p.throwOnLimitExceeded=="boolean"?p.throwOnLimitExceeded:!1}};return _i=function(f,p){var v=c(p);if(f===""||f===null||typeof f>"u")return v.plainObjects?{__proto__:null}:{};for(var g=typeof f=="string"?h(f,v):f,d=v.plainObjects?{__proto__:null}:{},y=Object.keys(g),x=0;x<y.length;++x){var E=y[x],w=u(E,g[E],v,typeof f=="string");d=i.merge(d,w,v)}return v.allowSparse===!0?d:i.compact(d)},_i}var xi,Ua;function Yl(){if(Ua)return xi;Ua=1;var i=jl(),t=Wl(),e=ln();return xi={formats:e,parse:t,stringify:i},xi}var Da;function Zl(){if(Da)return de;Da=1;var i=yl();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var e=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r",`
`,"	"],a=["{","}","|","\\","^","`"].concat(n),o=["'"].concat(a),h=["%","/","?",";","#"].concat(o),l=["/","?","#"],u=255,c=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},d=Yl();function y(m,S,_){if(m&&typeof m=="object"&&m instanceof t)return m;var B=new t;return B.parse(m,S,_),B}t.prototype.parse=function(m,S,_){if(typeof m!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof m);var B=m.indexOf("?"),U=B!==-1&&B<m.indexOf("#")?"?":"#",k=m.split(U),D=/\\/g;k[0]=k[0].replace(D,"/"),m=k.join(U);var L=m;if(L=L.trim(),!_&&m.split("#").length===1){var j=s.exec(L);if(j)return this.path=L,this.href=L,this.pathname=j[1],j[2]?(this.search=j[2],S?this.query=d.parse(this.search.substr(1)):this.query=this.search.substr(1)):S&&(this.search="",this.query={}),this}var H=e.exec(L);if(H){H=H[0];var V=H.toLowerCase();this.protocol=V,L=L.substr(H.length)}if(_||H||L.match(/^\/\/[^@/]+@[^@/]+/)){var T=L.substr(0,2)==="//";T&&!(H&&v[H])&&(L=L.substr(2),this.slashes=!0)}if(!v[H]&&(T||H&&!g[H])){for(var A=-1,b=0;b<l.length;b++){var F=L.indexOf(l[b]);F!==-1&&(A===-1||F<A)&&(A=F)}var R,M;A===-1?M=L.lastIndexOf("@"):M=L.lastIndexOf("@",A),M!==-1&&(R=L.slice(0,M),L=L.slice(M+1),this.auth=decodeURIComponent(R)),A=-1;for(var b=0;b<h.length;b++){var F=L.indexOf(h[b]);F!==-1&&(A===-1||F<A)&&(A=F)}A===-1&&(A=L.length),this.host=L.slice(0,A),L=L.slice(A),this.parseHost(),this.hostname=this.hostname||"";var N=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!N)for(var P=this.hostname.split(/\./),b=0,G=P.length;b<G;b++){var z=P[b];if(z&&!z.match(c)){for(var Y="",Z=0,K=z.length;Z<K;Z++)z.charCodeAt(Z)>127?Y+="x":Y+=z[Z];if(!Y.match(c)){var tt=P.slice(0,b),q=P.slice(b+1),et=z.match(f);et&&(tt.push(et[1]),q.unshift(et[2])),q.length&&(L="/"+q.join(".")+L),this.hostname=tt.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=i.toASCII(this.hostname));var rt=this.port?":"+this.port:"",lt=this.hostname||"";this.host=lt+rt,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),L[0]!=="/"&&(L="/"+L))}if(!p[V])for(var b=0,G=o.length;b<G;b++){var dt=o[b];if(L.indexOf(dt)!==-1){var J=encodeURIComponent(dt);J===dt&&(J=escape(dt)),L=L.split(dt).join(J)}}var Q=L.indexOf("#");Q!==-1&&(this.hash=L.substr(Q),L=L.slice(0,Q));var Mt=L.indexOf("?");if(Mt!==-1?(this.search=L.substr(Mt),this.query=L.substr(Mt+1),S&&(this.query=d.parse(this.query)),L=L.slice(0,Mt)):S&&(this.search="",this.query={}),L&&(this.pathname=L),g[V]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var rt=this.pathname||"",Nt=this.search||"";this.path=rt+Nt}return this.href=this.format(),this};function x(m){return typeof m=="string"&&(m=y(m)),m instanceof t?m.format():t.prototype.format.call(m)}t.prototype.format=function(){var m=this.auth||"";m&&(m=encodeURIComponent(m),m=m.replace(/%3A/i,":"),m+="@");var S=this.protocol||"",_=this.pathname||"",B=this.hash||"",U=!1,k="";this.host?U=m+this.host:this.hostname&&(U=m+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(U+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(k=d.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var D=this.search||k&&"?"+k||"";return S&&S.substr(-1)!==":"&&(S+=":"),this.slashes||(!S||g[S])&&U!==!1?(U="//"+(U||""),_&&_.charAt(0)!=="/"&&(_="/"+_)):U||(U=""),B&&B.charAt(0)!=="#"&&(B="#"+B),D&&D.charAt(0)!=="?"&&(D="?"+D),_=_.replace(/[?#]/g,function(L){return encodeURIComponent(L)}),D=D.replace("#","%23"),S+U+_+D+B};function E(m,S){return y(m,!1,!0).resolve(S)}t.prototype.resolve=function(m){return this.resolveObject(y(m,!1,!0)).format()};function w(m,S){return m?y(m,!1,!0).resolveObject(S):S}return t.prototype.resolveObject=function(m){if(typeof m=="string"){var S=new t;S.parse(m,!1,!0),m=S}for(var _=new t,B=Object.keys(this),U=0;U<B.length;U++){var k=B[U];_[k]=this[k]}if(_.hash=m.hash,m.href==="")return _.href=_.format(),_;if(m.slashes&&!m.protocol){for(var D=Object.keys(m),L=0;L<D.length;L++){var j=D[L];j!=="protocol"&&(_[j]=m[j])}return g[_.protocol]&&_.hostname&&!_.pathname&&(_.pathname="/",_.path=_.pathname),_.href=_.format(),_}if(m.protocol&&m.protocol!==_.protocol){if(!g[m.protocol]){for(var H=Object.keys(m),V=0;V<H.length;V++){var T=H[V];_[T]=m[T]}return _.href=_.format(),_}if(_.protocol=m.protocol,!m.host&&!v[m.protocol]){for(var G=(m.pathname||"").split("/");G.length&&!(m.host=G.shift()););m.host||(m.host=""),m.hostname||(m.hostname=""),G[0]!==""&&G.unshift(""),G.length<2&&G.unshift(""),_.pathname=G.join("/")}else _.pathname=m.pathname;if(_.search=m.search,_.query=m.query,_.host=m.host||"",_.auth=m.auth,_.hostname=m.hostname||m.host,_.port=m.port,_.pathname||_.search){var A=_.pathname||"",b=_.search||"";_.path=A+b}return _.slashes=_.slashes||m.slashes,_.href=_.format(),_}var F=_.pathname&&_.pathname.charAt(0)==="/",R=m.host||m.pathname&&m.pathname.charAt(0)==="/",M=R||F||_.host&&m.pathname,N=M,P=_.pathname&&_.pathname.split("/")||[],G=m.pathname&&m.pathname.split("/")||[],z=_.protocol&&!g[_.protocol];if(z&&(_.hostname="",_.port=null,_.host&&(P[0]===""?P[0]=_.host:P.unshift(_.host)),_.host="",m.protocol&&(m.hostname=null,m.port=null,m.host&&(G[0]===""?G[0]=m.host:G.unshift(m.host)),m.host=null),M=M&&(G[0]===""||P[0]==="")),R)_.host=m.host||m.host===""?m.host:_.host,_.hostname=m.hostname||m.hostname===""?m.hostname:_.hostname,_.search=m.search,_.query=m.query,P=G;else if(G.length)P||(P=[]),P.pop(),P=P.concat(G),_.search=m.search,_.query=m.query;else if(m.search!=null){if(z){_.host=P.shift(),_.hostname=_.host;var Y=_.host&&_.host.indexOf("@")>0?_.host.split("@"):!1;Y&&(_.auth=Y.shift(),_.hostname=Y.shift(),_.host=_.hostname)}return _.search=m.search,_.query=m.query,(_.pathname!==null||_.search!==null)&&(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.href=_.format(),_}if(!P.length)return _.pathname=null,_.search?_.path="/"+_.search:_.path=null,_.href=_.format(),_;for(var Z=P.slice(-1)[0],K=(_.host||m.host||P.length>1)&&(Z==="."||Z==="..")||Z==="",tt=0,q=P.length;q>=0;q--)Z=P[q],Z==="."?P.splice(q,1):Z===".."?(P.splice(q,1),tt++):tt&&(P.splice(q,1),tt--);if(!M&&!N)for(;tt--;tt)P.unshift("..");M&&P[0]!==""&&(!P[0]||P[0].charAt(0)!=="/")&&P.unshift(""),K&&P.join("/").substr(-1)!=="/"&&P.push("");var et=P[0]===""||P[0]&&P[0].charAt(0)==="/";if(z){_.hostname=et?"":P.length?P.shift():"",_.host=_.hostname;var Y=_.host&&_.host.indexOf("@")>0?_.host.split("@"):!1;Y&&(_.auth=Y.shift(),_.hostname=Y.shift(),_.host=_.hostname)}return M=M||_.host&&P.length,M&&!et&&P.unshift(""),P.length>0?_.pathname=P.join("/"):(_.pathname=null,_.path=null),(_.pathname!==null||_.search!==null)&&(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.auth=m.auth||_.auth,_.slashes=_.slashes||m.slashes,_.href=_.format(),_},t.prototype.parseHost=function(){var m=this.host,S=r.exec(m);S&&(S=S[0],S!==":"&&(this.port=S.substr(1)),m=m.substr(0,m.length-S.length)),m&&(this.hostname=m)},de.parse=y,de.resolve=E,de.resolveObject=w,de.format=x,de.Url=t,de}Zl();const Ga={};function vt(i,t,e=3){if(Ga[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),Ga[t]=!0}let bi;function Kl(){return typeof bi>"u"&&(bi=function(){const i={stencil:!0,failIfMajorPerformanceCaveat:ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ft.ADAPTER.getWebGLRenderingContext())return!1;const t=ft.ADAPTER.createCanvas();let e=t.getContext("webgl",i)||t.getContext("experimental-webgl",i);const r=!!e?.getContextAttributes()?.stencil;if(e){const s=e.getExtension("WEBGL_lose_context");s&&s.loseContext()}return e=null,r}catch{return!1}}()),bi}var Jl={grad:.9,turn:360,rad:360/(2*Math.PI)},Kt=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},Lt=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Ut=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},Go=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},za=function(i){return{r:Ut(i.r,0,255),g:Ut(i.g,0,255),b:Ut(i.b,0,255),a:Ut(i.a)}},Ti=function(i){return{r:Lt(i.r),g:Lt(i.g),b:Lt(i.b),a:Lt(i.a,3)}},Ql=/^#([0-9a-f]{3,8})$/i,Mr=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},zo=function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=Math.max(t,e,r),a=n-Math.min(t,e,r),o=a?n===t?(e-r)/a:n===e?2+(r-t)/a:4+(t-e)/a:0;return{h:60*(o<0?o+6:o),s:n?a/n*100:0,v:n/255*100,a:s}},$o=function(i){var t=i.h,e=i.s,r=i.v,s=i.a;t=t/360*6,e/=100,r/=100;var n=Math.floor(t),a=r*(1-e),o=r*(1-(t-n)*e),h=r*(1-(1-t+n)*e),l=n%6;return{r:255*[r,o,a,a,h,r][l],g:255*[h,r,r,o,a,a][l],b:255*[a,a,h,r,r,o][l],a:s}},$a=function(i){return{h:Go(i.h),s:Ut(i.s,0,100),l:Ut(i.l,0,100),a:Ut(i.a)}},Va=function(i){return{h:Lt(i.h),s:Lt(i.s),l:Lt(i.l),a:Lt(i.a,3)}},Ha=function(i){return $o((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},yr=function(i){return{h:(t=zo(i)).h,s:(s=(200-(e=t.s))*(r=t.v)/100)>0&&s<200?e*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,r,s},tu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,eu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ru=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,su=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Di={string:[[function(i){var t=Ql.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?Lt(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?Lt(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=ru.exec(i)||su.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:za({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=tu.exec(i)||eu.exec(i);if(!t)return null;var e,r,s=$a({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(Jl[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Ha(s)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=s===void 0?1:s;return Kt(t)&&Kt(e)&&Kt(r)?za({r:Number(t),g:Number(e),b:Number(r),a:Number(n)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,s=i.a,n=s===void 0?1:s;if(!Kt(t)||!Kt(e)||!Kt(r))return null;var a=$a({h:Number(t),s:Number(e),l:Number(r),a:Number(n)});return Ha(a)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,s=i.a,n=s===void 0?1:s;if(!Kt(t)||!Kt(e)||!Kt(r))return null;var a=function(o){return{h:Go(o.h),s:Ut(o.s,0,100),v:Ut(o.v,0,100),a:Ut(o.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(n)});return $o(a)},"hsv"]]},qa=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},iu=function(i){return typeof i=="string"?qa(i.trim(),Di.string):typeof i=="object"&&i!==null?qa(i,Di.object):[null,void 0]},Ei=function(i,t){var e=yr(i);return{h:e.h,s:Ut(e.s+100*t,0,100),l:e.l,a:e.a}},wi=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},Xa=function(i,t){var e=yr(i);return{h:e.h,s:e.s,l:Ut(e.l+100*t,0,100),a:e.a}},Gi=function(){function i(t){this.parsed=iu(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return Lt(wi(this.rgba),2)},i.prototype.isDark=function(){return wi(this.rgba)<.5},i.prototype.isLight=function(){return wi(this.rgba)>=.5},i.prototype.toHex=function(){return t=Ti(this.rgba),e=t.r,r=t.g,s=t.b,a=(n=t.a)<1?Mr(Lt(255*n)):"","#"+Mr(e)+Mr(r)+Mr(s)+a;var t,e,r,s,n,a},i.prototype.toRgb=function(){return Ti(this.rgba)},i.prototype.toRgbString=function(){return t=Ti(this.rgba),e=t.r,r=t.g,s=t.b,(n=t.a)<1?"rgba("+e+", "+r+", "+s+", "+n+")":"rgb("+e+", "+r+", "+s+")";var t,e,r,s,n},i.prototype.toHsl=function(){return Va(yr(this.rgba))},i.prototype.toHslString=function(){return t=Va(yr(this.rgba)),e=t.h,r=t.s,s=t.l,(n=t.a)<1?"hsla("+e+", "+r+"%, "+s+"%, "+n+")":"hsl("+e+", "+r+"%, "+s+"%)";var t,e,r,s,n},i.prototype.toHsv=function(){return t=zo(this.rgba),{h:Lt(t.h),s:Lt(t.s),v:Lt(t.v),a:Lt(t.a,3)};var t},i.prototype.invert=function(){return qt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),qt(Ei(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),qt(Ei(this.rgba,-t))},i.prototype.grayscale=function(){return qt(Ei(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),qt(Xa(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),qt(Xa(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?qt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Lt(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=yr(this.rgba);return typeof t=="number"?qt({h:t,s:e.s,l:e.l,a:e.a}):Lt(e.h)},i.prototype.isEqual=function(t){return this.toHex()===qt(t).toHex()},i}(),qt=function(i){return i instanceof Gi?i:new Gi(i)},ja=[],nu=function(i){i.forEach(function(t){ja.indexOf(t)<0&&(t(Gi,Di),ja.push(t))})};function au(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in e)r[e[s]]=s;var n={};i.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,h,l=r[this.toHex()];if(l)return l;if(a?.closest){var u=this.toRgb(),c=1/0,f="black";if(!n.length)for(var p in e)n[p]=new i(e[p]).toRgb();for(var v in e){var g=(o=u,h=n[v],Math.pow(o.r-h.r,2)+Math.pow(o.g-h.g,2)+Math.pow(o.b-h.b,2));g<c&&(c=g,f=v)}return f}},t.string.push([function(a){var o=a.toLowerCase(),h=o==="transparent"?"#0000":e[o];return h?new i(h).toRgb():null},"name"])}nu([au]);const He=class Xr{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Xr)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){const s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,r,s]=this._components;return{r:t,g:e,b:r,a:s}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];const[e,r,s]=this._components;return t[0]=e,t[1]=r,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,s,n]=Xr.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return e&&(r=r*t+.5|0,s=s*t+.5|0,n=n*t+.5|0),(t*255<<24)+(r<<16)+(s<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,s,n]=this._components;return t[0]=e,t[1]=r,t[2]=s,t[3]=n,t}normalize(t){let e,r,s,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const a=t;e=(a>>16&255)/255,r=(a>>8&255)/255,s=(a&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,s,n=255]=t,e/=255,r/=255,s/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const o=Xr.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}const a=qt(t);a.isValid()&&({r:e,g:r,b:s,a:n}=a.rgba,e/=255,r/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((s,n)=>{t[n]=Math.min(Math.max(s,e),r)}),t)}};He.shared=new He,He.temp=new He,He.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Qe=He;function ou(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[st.NORMAL_NPM]=st.NORMAL,i[st.ADD_NPM]=st.ADD,i[st.SCREEN_NPM]=st.SCREEN,t[st.NORMAL]=st.NORMAL_NPM,t[st.ADD]=st.ADD_NPM,t[st.SCREEN]=st.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const hu=ou();function Vo(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function ts(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Wa(i){return!(i&i-1)&&!!i}function Ya(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function jr(i,t,e){const r=i.length;let s;if(t>=r||e===0)return;e=t+e>r?r-t:e;const n=r-e;for(s=t;s<n;++s)i[s]=i[s+e];i.length=n}let lu=0;function xr(){return++lu}const Za={},Xt=Object.create(null),ie=Object.create(null);function uu(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Ka(i,t=1){const e=ft.RETINA_PREFIX?.exec(i);return e?parseFloat(e[1]):t}var ht=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(ht||{});const zi=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},Ja=(i,t)=>zi(i).priority??t,mt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(zi).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...i){return i.map(zi).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,s=this._queue;r[e]?r[e]?.(t):(s[e]=s[e]||[],s[e]?.push(t))})}),this},handle(i,t,e){const r=this._addHandlers,s=this._removeHandlers;if(r[i]||s[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,s[i]=e;const n=this._queue;return n[i]&&(n[i]?.forEach(a=>t(a)),delete n[i]),this},handleByMap(i,t){return this.handle(i,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((s,n)=>Ja(n,e)-Ja(s,e)))},r=>{const s=t.indexOf(r.ref);s!==-1&&t.splice(s,1)})}};class cu{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const du=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function fu(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function pu(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=du.replace(/%forloop%/gi,fu(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const Si=0,Ai=1,Ri=2,Mi=3,Ii=4,Ci=5;class sr{constructor(){this.data=0,this.blendMode=st.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Si)}set blend(t){!!(this.data&1<<Si)!==t&&(this.data^=1<<Si)}get offsets(){return!!(this.data&1<<Ai)}set offsets(t){!!(this.data&1<<Ai)!==t&&(this.data^=1<<Ai)}get culling(){return!!(this.data&1<<Ri)}set culling(t){!!(this.data&1<<Ri)!==t&&(this.data^=1<<Ri)}get depthTest(){return!!(this.data&1<<Mi)}set depthTest(t){!!(this.data&1<<Mi)!==t&&(this.data^=1<<Mi)}get depthMask(){return!!(this.data&1<<Ci)}set depthMask(t){!!(this.data&1<<Ci)!==t&&(this.data^=1<<Ci)}get clockwiseFrontFace(){return!!(this.data&1<<Ii)}set clockwiseFrontFace(t){!!(this.data&1<<Ii)!==t&&(this.data^=1<<Ii)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==st.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new sr;return t.depthTest=!1,t.blend=!0,t}}sr.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const $i=[];function Ho(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=$i.length-1;r>=0;--r){const s=$i[r];if(s.test&&s.test(i,e))return new s(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Ht{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,s,n,a,o,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let c=0,f=u.length;c<f;c++)u[c][l](t,e,r,s,n,a,o,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Ht.prototype,{dispatch:{value:Ht.prototype.emit},run:{value:Ht.prototype.emit}});class br{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Ht("setRealSize"),this.onUpdate=new Ht("update"),this.onError=new Ht("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class qo extends br{constructor(t,e){const{width:r,height:s}=e||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Re.UNPACK);const n=e.realWidth,a=e.realHeight;return r.width===n&&r.height===a?s.texSubImage2D(e.target,0,0,0,n,a,e.format,r.type,this.data):(r.width=n,r.height=a,s.texImage2D(e.target,0,r.internalFormat,n,a,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const mu={scaleMode:Qt.NEAREST,alphaMode:Re.NPM},Vi=class qe extends us{constructor(t=null,e=null){super(),e=Object.assign({},qe.defaultOptions,e);const{alphaMode:r,mipmap:s,anisotropicLevel:n,scaleMode:a,width:o,height:h,wrapMode:l,format:u,type:c,target:f,resolution:p,resourceOptions:v}=e;t&&!(t instanceof br)&&(t=Ho(t,v),t.internal=!0),this.resolution=p||ft.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=a,this.format=u,this.type=c,this.target=f,this.alphaMode=r,this.uid=xr(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Wa(this.realWidth)&&Wa(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ie[this.cacheId],delete Xt[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),qe.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=ft.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else{if(!t._pixiId){const o=e?.pixiIdPrefix||"pixiid";t._pixiId=`${o}_${xr()}`}n=t._pixiId}let a=ie[n];if(s&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return a||(a=new qe(t,e),a.cacheId=n,qe.addToCache(a,n)),a}static fromBuffer(t,e,r,s){t=t||new Float32Array(e*r*4);const n=new qo(t,{width:e,height:r,...s?.resourceOptions});let a,o;return t instanceof Float32Array?(a=X.RGBA,o=ot.FLOAT):t instanceof Int32Array?(a=X.RGBA_INTEGER,o=ot.INT):t instanceof Uint32Array?(a=X.RGBA_INTEGER,o=ot.UNSIGNED_INT):t instanceof Int16Array?(a=X.RGBA_INTEGER,o=ot.SHORT):t instanceof Uint16Array?(a=X.RGBA_INTEGER,o=ot.UNSIGNED_SHORT):t instanceof Int8Array?(a=X.RGBA,o=ot.BYTE):(a=X.RGBA,o=ot.UNSIGNED_BYTE),n.internal=!0,new qe(n,Object.assign({},mu,{type:o,format:a},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ie[e]&&ie[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),ie[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=ie[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete ie[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete ie[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Vi.defaultOptions={mipmap:Se.POW2,anisotropicLevel:0,scaleMode:Qt.LINEAR,wrapMode:nn.CLAMP,alphaMode:Re.UNPACK,target:Ze.TEXTURE_2D,format:X.RGBA,type:ot.UNSIGNED_BYTE},Vi._globalBatch=0;let _t=Vi;class yu{constructor(){this.texArray=null,this.blend=0,this.type=Qr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let gu=0;class Ft{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=gu++,this.disposeRunner=new Ht("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Wt.ELEMENT_ARRAY_BUFFER:Wt.ARRAY_BUFFER}get index(){return this.type===Wt.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Ft(t)}}class es{constructor(t,e=0,r=!1,s=ot.FLOAT,n,a,o,h=1){this.buffer=t,this.size=e,this.normalized=r,this.type=s,this.stride=n,this.start=a,this.instance=o,this.divisor=h}destroy(){this.buffer=null}static from(t,e,r,s,n){return new es(t,e,r,s,n)}}const vu={Float32Array,Uint32Array,Int32Array,Uint8Array};function _u(i,t){let e=0,r=0;const s={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;const n=new ArrayBuffer(e*4);let a=null,o=0;for(let h=0;h<i.length;h++){const l=t[h],u=i[h],c=Vo(u);s[c]||(s[c]=new vu[c](n)),a=s[c];for(let f=0;f<u.length;f++){const p=(f/l|0)*r+o,v=f%l;a[p+v]=u[f]}o+=l}return new Float32Array(n)}const Qa={5126:4,5123:2,5121:1};let xu=0;const bu={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class tr{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=xu++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Ht("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,s=!1,n,a,o,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Ft||(e instanceof Array&&(e=new Float32Array(e)),e=new Ft(e));const l=t.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,r,s,n);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new es(u,r,s,n,a,o,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Ft||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ft(t)),t.type=Wt.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new Ft;let s;for(s in this.attributes){const n=this.attributes[s],a=this.buffers[n.buffer];t.push(a.data),e.push(n.size*Qa[n.type]/4),n.buffer=0}for(r.data=_u(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new tr;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Ft(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new es(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Wt.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new tr,r=[],s=[],n=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)s[h]=s[h]||0,s[h]+=a.buffers[h].data.length,n[h]=0}for(let o=0;o<a.buffers.length;o++)r[o]=new bu[Vo(a.buffers[o].data)](s[o]),e.buffers[o]=new Ft(r[o]);for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)r[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=Wt.ELEMENT_ARRAY_BUFFER;let o=0,h=0,l=0,u=0;for(let c=0;c<a.buffers.length;c++)if(a.buffers[c]!==a.indexBuffer){u=c;break}for(const c in a.attributes){const f=a.attributes[c];(f.buffer|0)===u&&(h+=f.size*Qa[f.type]/4)}for(let c=0;c<t.length;c++){const f=t[c].indexBuffer.data;for(let p=0;p<f.length;p++)e.indexBuffer.data[p+l]+=o;o+=t[c].buffers[u].data.length/h,l+=f.length}}return e}}class Tu extends tr{constructor(t=!1){super(),this._buffer=new Ft(null,t,!1),this._indexBuffer=new Ft(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ot.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ot.FLOAT).addAttribute("aColor",this._buffer,4,!0,ot.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ot.FLOAT).addIndex(this._indexBuffer)}}const Eu=Math.PI*2,wu=180/Math.PI,Su=Math.PI/180;var Xo=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(Xo||{});class Pt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Pt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}Pt.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Ir=[new Pt,new Pt,new Pt,new Pt];class Et{constructor(t=0,e=0,r=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(s),this.type=Xo.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Et(0,0,0,0)}clone(){return new Et(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const B=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=B)return!1;const U=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>U}const r=this.left,s=this.right,n=this.top,a=this.bottom;if(s<=r||a<=n)return!1;const o=Ir[0].set(t.left,t.top),h=Ir[1].set(t.left,t.bottom),l=Ir[2].set(t.right,t.top),u=Ir[3].set(t.right,t.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(o,o),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(o.x,h.x,l.x,u.x)<=r||Math.min(o.x,h.x,l.x,u.x)>=s||Math.max(o.y,h.y,l.y,u.y)<=n||Math.min(o.y,h.y,l.y,u.y)>=a))return!1;const f=c*(h.y-o.y),p=c*(o.x-h.x),v=f*r+p*n,g=f*s+p*n,d=f*r+p*a,y=f*s+p*a;if(Math.max(v,g,d,y)<=f*o.x+p*o.y||Math.min(v,g,d,y)>=f*u.x+p*u.y)return!1;const x=c*(o.y-l.y),E=c*(l.x-o.x),w=x*r+E*n,m=x*s+E*n,S=x*r+E*a,_=x*s+E*a;return!(Math.max(w,m,S,_)<=x*o.x+E*o.y||Math.min(w,m,S,_)>=x*u.x+E*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=s,this.height=n-s,this}}Et.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Ct{constructor(t=1,e=0,r=0,s=1,n=0,a=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,s,n,a){return this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Pt;const r=t.x,s=t.y;return e.x=this.a*r+this.c*s+this.tx,e.y=this.b*r+this.d*s+this.ty,e}applyInverse(t,e){e=e||new Pt;const r=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return e.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),s=this.a,n=this.c,a=this.tx;return this.a=s*e-this.b*r,this.b=s*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=a*e-this.ty*r,this.ty=a*r+this.ty*e,this}append(t){const e=this.a,r=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this}setTransform(t,e,r,s,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(r*this.a+s*this.c),this.ty=e-(r*this.b+s*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,s=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,s=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-s,n),h=Math.atan2(r,e),l=Math.abs(o+h);return l<1e-5||Math.abs(Eu-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(a.x*e+a.y*s),t.position.y=this.ty+(a.x*r+a.y*n),t}invert(){const t=this.a,e=this.b,r=this.c,s=this.d,n=this.tx,a=t*s-e*r;return this.a=s/a,this.b=-e/a,this.c=-r/a,this.d=t/a,this.tx=(r*this.ty-s*n)/a,this.ty=-(t*this.ty-e*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Ct;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Ct}static get TEMP_MATRIX(){return new Ct}}Ct.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const ge=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ve=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],_e=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],xe=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Hi=[],jo=[],Cr=Math.sign;function Au(){for(let i=0;i<16;i++){const t=[];Hi.push(t);for(let e=0;e<16;e++){const r=Cr(ge[i]*ge[e]+_e[i]*ve[e]),s=Cr(ve[i]*ge[e]+xe[i]*ve[e]),n=Cr(ge[i]*_e[e]+_e[i]*xe[e]),a=Cr(ve[i]*_e[e]+xe[i]*xe[e]);for(let o=0;o<16;o++)if(ge[o]===r&&ve[o]===s&&_e[o]===n&&xe[o]===a){t.push(o);break}}}for(let i=0;i<16;i++){const t=new Ct;t.set(ge[i],ve[i],_e[i],xe[i],0,0),jo.push(t)}}Au();const St={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>ge[i],uY:i=>ve[i],vX:i=>_e[i],vY:i=>xe[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Hi[i][t],sub:(i,t)=>Hi[i][St.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?St.S:St.N:Math.abs(t)*2<=Math.abs(i)?i>0?St.E:St.W:t>0?i>0?St.SE:St.SW:i>0?St.NE:St.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const s=jo[St.inv(t)];s.tx=e,s.ty=r,i.append(s)}};class Ee{constructor(t,e,r=0,s=0){this._x=r,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Ee(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}Ee.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const qi=class{constructor(){this.worldTransform=new Ct,this.localTransform=new Ct,this.position=new Ee(this.onChange,this,0,0),this.scale=new Ee(this.onChange,this,1,1),this.pivot=new Ee(this.onChange,this,0,0),this.skew=new Ee(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};qi.IDENTITY=new qi;let un=qi;un.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var Ru=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Mu=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function to(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function Li(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Wo(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Li(2*t);case"bvec3":return Li(3*t);case"bvec4":return Li(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ke=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],Iu={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Cu={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Lu(i,t){const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in i.uniforms){const s=t[r];if(!s){i.uniforms[r]?.group===!0&&(i.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const n=i.uniforms[r];let a=!1;for(let o=0;o<Ke.length;o++)if(Ke[o].test(s,n)){e.push(Ke[o].code(r,n)),a=!0;break}if(!a){const o=(s.size===1&&!s.isArray?Iu:Cu)[s.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${o};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const Yo={};let Lr=Yo;function Fu(){if(Lr===Yo||Lr?.isContextLost()){const i=ft.ADAPTER.createCanvas();let t;ft.PREFER_ENV>=Ae.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Lr=t}return Lr}let Fr;function Pu(){if(!Fr){Fr=kt.MEDIUM;const i=Fu();if(i&&i.getShaderPrecisionFormat){const t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&(Fr=t.precision?kt.HIGH:kt.MEDIUM)}}return Fr}function eo(i,t){const e=i.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),r=i.getShaderInfoLog(t),s=r.split(`
`),n={},a=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[""];a.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);o[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function Nu(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||eo(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||eo(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const Ou={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Zo(i){return Ou[i]}let Pr=null;const ro={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Ko(i,t){if(!Pr){const e=Object.keys(ro);Pr={};for(let r=0;r<e.length;++r){const s=e[r];Pr[i[s]]=ro[s]}}return Pr[t]}function so(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===kt.HIGH&&e!==kt.HIGH&&(r=kt.MEDIUM),`precision ${r} float;
${i}`}else if(e!==kt.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let ar;function Bu(){if(typeof ar=="boolean")return ar;try{ar=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{ar=!1}return ar}let ku=0;const Nr={},Xi=class Xe{constructor(t,e,r="pixi-shader",s={}){this.extra={},this.id=ku++,this.vertexSrc=t||Xe.defaultVertexSrc,this.fragmentSrc=e||Xe.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Nr[r]?(Nr[r]++,r+=`-${Nr[r]}`):Nr[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=so(this.vertexSrc,Xe.defaultVertexPrecision,kt.HIGH),this.fragmentSrc=so(this.fragmentSrc,Xe.defaultFragmentPrecision,Pu())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Mu}static get defaultFragmentSrc(){return Ru}static from(t,e,r){const s=t+e;let n=Za[s];return n||(Za[s]=n=new Xe(t,e,r)),n}};Xi.defaultVertexPrecision=kt.HIGH,Xi.defaultFragmentPrecision=je.apple.device?kt.HIGH:kt.MEDIUM;let we=Xi,Uu=0;class Yt{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Uu++,this.static=!!e,this.ubo=!!r,t instanceof Ft?(this.buffer=t,this.buffer.type=Wt.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Ft(new Float32Array(1)),this.buffer.type=Wt.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new Yt(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new Yt(t,e,r)}static uboFrom(t,e){return new Yt(t,e??!0,!0)}}class fs{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Yt?this.uniformGroup=e:this.uniformGroup=new Yt(e):this.uniformGroup=new Yt({}),this.disposeRunner=new Ht("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const s=e.uniforms[r];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const s=we.from(t,e);return new fs(s,r)}}class Du{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=n;this.defaultGroupCache[t]=Yt.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new we(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ct,default:this.defaultGroupCache[t]};return new fs(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class Gu{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function zu(){return!je.apple.device}function $u(i){let t=!0;const e=ft.ADAPTER.getNavigator();if(je.tablet||je.phone){if(je.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(je.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}class Jo{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var Vu=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Hu=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const cr=class Vt extends Jo{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Tu,this.vertexSize=6,this.state=sr.for2d(),this.size=Vt.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??$u(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??zu(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return vt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Hu}static get defaultFragmentTemplate(){return Vu}setShaderGenerator({vertex:t=Vt.defaultVertexSrc,fragment:e=Vt.defaultFragmentTemplate}={}){this.shaderGenerator=new Du(t,e)}contextChange(){const t=this.renderer.gl;ft.PREFER_ENV===Ae.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Vt.defaultMaxTextures),this.maxTextures=pu(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Vt,r=this.size/4,s=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new yu);for(;e.length<s;)e.push(new Gu);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=Vt._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,a=this.renderer.textureGC.count;let o=++_t._globalBatch,h=0,l=r[0],u=0;s.copyBoundTextures(n,e);for(let c=0;c<this._bufferSize;++c){const f=t[c];t[c]=null,f._batchEnabled!==o&&(l.count>=e&&(s.boundArray(l,n,o,e),this.buildDrawCalls(l,u,c),u=c,l=r[++h],++o),f._batchEnabled=o,f.touched=a,l.elements[l.count++]=f)}l.count>0&&(s.boundArray(l,n,o,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++o);for(let c=0;c<n.length;c++)n[c]=null;_t._globalBatch=o}buildDrawCalls(t,e,r){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:a,vertexSize:o}=this,h=Vt._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,f=h[l];f.start=this._iIndex,f.texArray=t;for(let p=e;p<r;++p){const v=s[p],g=v._texture.baseTexture,d=hu[g.alphaMode?1:0][v.blendMode];s[p]=null,e<p&&f.blend!==d&&(f.size=c-f.start,e=p,f=h[++l],f.texArray=t,f.start=c),this.packInterleavedGeometry(v,n,a,u,c),u+=v.vertexData.length/2*o,c+=v.indices.length,f.blend=d}e<r&&(f.size=c-f.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;Vt.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,s=Vt._drawCallPool;let n=null;for(let a=0;a<t;a++){const{texArray:o,type:h,size:l,start:u,blend:c}=s[a];n!==o&&(n=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,r.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Vt.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=ts(Math.ceil(t/8)),r=Ya(e),s=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new cu(s*this.vertexSize*4)),n}getIndexBuffer(t){const e=ts(Math.ceil(t/12)),r=Ya(e),s=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(s)),n}packInterleavedGeometry(t,e,r,s,n){const{uint32View:a,float32View:o}=e,h=s/this.vertexSize,l=t.uvs,u=t.indices,c=t.vertexData,f=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),v=Qe.shared.setValue(t._tintRGB).toPremultiplied(p,t._texture.baseTexture.alphaMode>0);for(let g=0;g<c.length;g+=2)o[s++]=c[g],o[s++]=c[g+1],o[s++]=l[g],o[s++]=l[g+1],a[s++]=v,o[s++]=f;for(let g=0;g<u.length;g++)r[n++]=h+u[g]}};cr.defaultBatchSize=4096,cr.extension={name:"batch",type:ht.RendererPlugin},cr._drawCallPool=[],cr._textureArrayPool=[];let be=cr;mt.add(be);var qu=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Xu=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const ji=class dr extends fs{constructor(t,e,r){const s=we.from(t||dr.defaultVertexSrc,e||dr.defaultFragmentSrc);super(s,r),this.padding=0,this.resolution=dr.defaultResolution,this.multisample=dr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new sr}apply(t,e,r,s,n){t.applyFilter(this,e,r,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Xu}static get defaultFragmentSrc(){return qu}};ji.defaultResolution=1,ji.defaultMultisample=Rt.NONE;let he=ji;class rs{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Qe(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:s}=t,n=r??e;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}rs.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},rs.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"background"};mt.add(rs);class Qo{constructor(t){this.renderer=t,this.emptyRenderer=new Jo(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=r[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,r,s){const{elements:n,ids:a,count:o}=t;let h=0;for(let l=0;l<o;l++){const u=n[l],c=u._batchLocation;if(c>=0&&c<s&&e[c]===u){a[l]=c;continue}for(;h<s;){const f=e[h];if(f&&f._batchEnabled===r&&f._batchLocation===h){h++;continue}a[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}}Qo.extension={type:ht.RendererSystem,name:"batch"};mt.add(Qo);let io=0;class ss{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=io++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=io++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(ft.PREFER_ENV>=Ae.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}ss.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},ss.extension={type:ht.RendererSystem,name:"context"};mt.add(ss);class Wi{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Ht("disposeFramebuffer"),this.multisample=Rt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new _t(null,{scaleMode:Qt.NEAREST,resolution:1,mipmap:Se.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new _t(null,{scaleMode:Qt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Se.OFF,format:X.DEPTH_COMPONENT,type:ot.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const s=this.colorTextures[r],n=s.resolution;s.setSize(t/n,e/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class th extends _t{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],s=arguments[2],n=arguments[3];t={width:e,height:r,scaleMode:s,resolution:n}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=Rt.NONE),super(null,t),this.mipmap=Se.OFF,this.valid=!0,this._clear=new Qe([0,0,0,0]),this.framebuffer=new Wi(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class te extends br{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,s=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(r,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=uu(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,s){const n=t.gl,a=e.realWidth,o=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Re.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&r.width===a&&r.height===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,r.type,s):(r.width=a,r.height=o,n.texImage2D(e.target,0,r.internalFormat,e.format,r.type,s)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class eh extends te{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;te.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??ft.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=a=>{r(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Re.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let s=!0;const n=e._glTextures;for(const a in n){const o=n[a];if(o!==r&&o.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class cn{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const s=e.width,n=e.height;if(r){const a=t.width/2/s,o=t.height/2/n,h=t.x/s+a,l=t.y/n+o;r=St.add(r,St.NW),this.x0=h+a*St.uX(r),this.y0=l+o*St.uY(r),r=St.add(r,2),this.x1=h+a*St.uX(r),this.y1=l+o*St.uY(r),r=St.add(r,2),this.x2=h+a*St.uX(r),this.y2=l+o*St.uY(r),r=St.add(r,2),this.x3=h+a*St.uX(r),this.y3=l+o*St.uY(r)}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}cn.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const no=new cn;function Or(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class xt extends us{constructor(t,e,r,s,n,a,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Et(0,0,1,1)),t instanceof xt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=no,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Pt(a.x,a.y):new Pt(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&Xt[e.url]&&xt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,xt.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new xt(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===no&&(this._uvs=new cn),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=ft.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else if(t instanceof _t){if(!t.cacheId){const o=e?.pixiIdPrefix||"pixiid";t.cacheId=`${o}-${xr()}`,_t.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const o=e?.pixiIdPrefix||"pixiid";t._pixiId=`${o}_${xr()}`}n=t._pixiId}let a=Xt[n];if(s&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(t instanceof _t)?(e.resolution||(e.resolution=Ka(t)),a=new xt(new _t(t,e)),a.baseTexture.cacheId=n,_t.addToCache(a.baseTexture,n),xt.addToCache(a,n)):!a&&t instanceof _t&&(a=new xt(t),xt.addToCache(a,n)),a}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),s=xt.from(t,Object.assign({resourceOptions:r},e),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,r,s){return new xt(_t.fromBuffer(t,e,r,s))}static fromLoader(t,e,r,s){const n=new _t(t,Object.assign({scaleMode:_t.defaultOptions.scaleMode,resolution:Ka(e)},s)),{resource:a}=n;a instanceof eh&&(a.url=e);const o=new xt(n);return r||(r=e),_t.addToCache(o.baseTexture,r),xt.addToCache(o,r),r!==e&&(_t.addToCache(o.baseTexture,e),xt.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(h=>{o.baseTexture.once("loaded",()=>h(o))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Xt[e]&&Xt[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Xt[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Xt[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Xt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Xt[t.textureCacheIds[e]]===t&&delete Xt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:s,height:n}=t,a=e+s>this.baseTexture.width,o=r+n>this.baseTexture.height;if(a||o){const h=a&&o?"and":"or",l=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,u=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return xt._EMPTY||(xt._EMPTY=new xt(new _t),Or(xt._EMPTY),Or(xt._EMPTY.baseTexture)),xt._EMPTY}static get WHITE(){if(!xt._WHITE){const t=ft.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),xt._WHITE=new xt(_t.from(t)),Or(xt._WHITE),Or(xt._WHITE.baseTexture)}return xt._WHITE}}class ps extends xt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const s=this.baseTexture.resolution,n=Math.round(t*s)/s,a=Math.round(e*s)/s;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,r&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new ps(new th(t))}}class rh{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=Rt.NONE){const s=new th(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new ps(s)}getOptimalTexture(t,e,r=1,s=Rt.NONE){let n;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=ts(t),e=ts(e),n=((t&65535)<<16|e&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(t,e,s)),a.filterPoolKey=n,a.setResolution(r),a}getFilterTexture(t,e,r){const s=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||Rt.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}rh.SCREEN_KEY=-1;class ju extends tr{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Wu extends tr{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ft(this.vertices),this.uvBuffer=new Ft(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+e.width/t.width,this.uvs[3]=s,this.uvs[4]=r+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=r,this.uvs[7]=s+e.height/t.height,r=e.x,s=e.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+e.width,this.vertices[3]=s,this.vertices[4]=r+e.width,this.vertices[5]=s+e.height,this.vertices[6]=r,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Yu{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Rt.NONE,this.sourceFrame=new Et,this.destinationFrame=new Et,this.bindingSourceFrame=new Et,this.bindingDestinationFrame=new Et,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Br=[new Pt,new Pt,new Pt,new Pt],Fi=new Ct;class sh{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new rh,this.statePool=[],this.quad=new ju,this.quadUv=new Wu,this.tempRect=new Et,this.activeState={},this.globalUniforms=new Yt({outputFrame:new Et,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new Yu,a=r.renderTexture;let o,h;if(a.current){const d=a.current;o=d.resolution,h=d.multisample}else o=r.resolution,h=r.multisample;let l=e[0].resolution||o,u=e[0].multisample??h,c=e[0].padding,f=e[0].autoFit,p=e[0].legacy??!0;for(let d=1;d<e.length;d++){const y=e[d];l=Math.min(l,y.resolution||o),u=Math.min(u,y.multisample??h),c=this.useMaxPadding?Math.max(c,y.padding):c+y.padding,f=f&&y.autoFit,p=p||(y.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),s.push(n),n.resolution=l,n.multisample=u,n.legacy=p,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(c);const v=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(Fi.copyFrom(r.projection.transform).invert(),v),f?(n.sourceFrame.fit(v),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(v)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,l,u),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const g=this.tempRect;g.x=0,g.y=0,g.width=n.sourceFrame.width,g.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,g),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const n=s.inputSize,a=s.inputPixel,o=s.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*e.resolution),a[1]=Math.round(n[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=e.sourceFrame.width*n[2]-.5*a[2],o[3]=e.sourceFrame.height*n[3]-.5*a[3],e.legacy){const l=s.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,h.renderTexture,ye.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<r.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),r[c].apply(this,l,u,ye.CLEAR,e);const f=l;l=u,u=f}r[c].apply(this,l,h.renderTexture,ye.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=ye.CLEAR){const{renderTexture:r,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,r.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(e===ye.CLEAR||e===ye.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,s){const n=this.renderer;n.state.set(t.state),this.bindAndClear(r,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(Qr.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(Qr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=e._texture,a=t.set(s.width,0,0,s.height,r.x,r.y),o=e.worldTransform.copyTo(Ct.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,s=Rt.NONE){return this.texturePool.getOptimalTexture(t,e,r,s)}getFilterTexture(t,e,r){if(typeof t=="number"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||Rt.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=Br[0],s=Br[1],n=Br[2],a=Br[3];r.set(e.left,e.top),s.set(e.left,e.bottom),n.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(r,r),t.apply(s,s),t.apply(n,n),t.apply(a,a);const o=Math.min(r.x,s.x,n.x,a.x),h=Math.min(r.y,s.y,n.y,a.y),l=Math.max(r.x,s.x,n.x,a.x),u=Math.max(r.y,s.y,n.y,a.y);e.x=o,e.y=h,e.width=l-o,e.height=u-h}roundFrame(t,e,r,s,n){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(n){const{a,b:o,c:h,d:l}=n;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}n=n?Fi.copyFrom(n):Fi.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}sh.extension={type:ht.RendererSystem,name:"filter"};mt.add(sh);class Zu{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Rt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Ku=new Et;class ih{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Wi(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Et,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;ft.PREFER_ENV===Ae.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:s}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=r),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>r,o=e.height>>r,h=a/e.width;this.setViewport(e.x*h,e.y*h,a,o)}else{const a=t.width>>r,o=t.height>>r;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,s){const n=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=r,n.height=s,this.gl.viewport(t,e,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,s,n=Ui.COLOR|Ui.DEPTH){const{gl:a}=this;a.clearColor(t,e,r,s),a.clear(n)}initFramebuffer(t){const{gl:e}=this,r=new Zu(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let a;this.renderer.context.webGLVersion===1?a=e.DEPTH_STENCIL:t.depth&&t.stencil?a=e.DEPTH24_STENCIL8:t.depth?a=e.DEPTH_COMPONENT24:a=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,a,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,a,t.width,t.height)}const s=t.colorTextures;let n=s.length;e.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const o=s[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0),a===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let a=n.length;r.drawBuffers||(a=Math.min(a,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const o=[];for(let h=0;h<a;h++){const l=n[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),o.push(r.COLOR_ATTACHMENT0+h))}if(o.length>1&&r.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||r.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):t.depth&&t.stencil?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):t.depth?(h=r.DEPTH_ATTACHMENT,l=r.DEPTH_COMPONENT24):(h=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,l,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,l,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,s.stencil)}else s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=Rt.NONE;if(t<=1||e===null)return r;for(let s=0;s<e.length;s++)if(e[s]<=t){r=e[s];break}return r===1&&(r=Rt.NONE),r}blit(t,e,r){const{current:s,renderer:n,gl:a,CONTEXT_UID:o}=this;if(n.context.webGLVersion!==2||!s)return;const h=s.glFramebuffers[o];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=s.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new Wi(s.width,s.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=Ku,e.width=s.width,e.height=s.height),r||(r=e);const l=e.width===r.width&&e.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,s=t.height,n=this.gl,a=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a);let o,h;this.renderer.context.webGLVersion===1?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH_STENCIL):t.depth?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH24_STENCIL8):(o=n.STENCIL_ATTACHMENT,h=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,h,r,s):n.renderbufferStorage(n.RENDERBUFFER,h,r,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,o,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Et}destroy(){this.renderer=null}}ih.extension={type:ht.RendererSystem,name:"framebuffer"};mt.add(ih);const Pi={5126:4,5123:2,5121:1};class nh{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;ft.PREFER_ENV===Ae.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=s=>r.bindVertexArrayOES(s),t.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),t.drawElementsInstanced=(s,n,a,o,h)=>r.drawElementsInstancedANGLE(s,n,a,o,h),t.drawArraysInstanced=(s,n,a,o)=>r.drawArraysInstancedANGLE(s,n,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const a=s[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const s=t.buffers[r];e.update(s)}}checkCompatibility(t,e){const r=t.attributes,s=e.attributeData;for(const n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const r=t.attributes,s=e.attributeData,n=["g",t.id];for(const a in r)s[a]&&n.push(a,s[a].location);return n.join("-")}initGeometryVao(t,e,r=!0){const s=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=e.program;o.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const h=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[o.id]=u,u;const c=t.buffers,f=t.attributes,p={},v={};for(const g in c)p[g]=0,v[g]=0;for(const g in f)!f[g].size&&o.attributeData[g]?f[g].size=o.attributeData[g].size:f[g].size||console.warn(`PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`),p[f[g].buffer]+=f[g].size*Pi[f[g].type];for(const g in f){const d=f[g],y=d.size;d.stride===void 0&&(p[d.buffer]===y*Pi[d.type]?d.stride=0:d.stride=p[d.buffer]),d.start===void 0&&(d.start=v[d.buffer],v[d.buffer]+=y*Pi[d.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let g=0;g<c.length;g++){const d=c[g];a.bind(d),r&&d._glBuffers[n].refCount++}return this.activateVao(t,o),l[o.id]=u,l[h]=u,s.bindVertexArray(null),a.unbind(Wt.ARRAY_BUFFER),u}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,a=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!r){if(a)for(let o=0;o<n.length;o++){const h=n[o]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&a.dispose(n[o],e))}if(!e){for(const o in r)if(o[0]==="g"){const h=r[o];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in o){const u=o[l],c=a[u.buffer],f=c._glBuffers[s];if(e.attributeData[l]){h!==f&&(n.bind(c),h=f);const p=e.attributeData[l].location;if(r.enableVertexAttribArray(p),r.vertexAttribPointer(p,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(p,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,s){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(t,e||a.indexBuffer.data.length,h,(r||0)*o,s||1):n.drawElements(t,e||a.indexBuffer.data.length,h,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(t,r,e||a.getSize(),s||1):n.drawArrays(t,r,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}nh.extension={type:ht.RendererSystem,name:"geometry"};mt.add(nh);const ao=new Ct;class Ju{constructor(t,e){this._texture=t,this.mapCoord=new Ct,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let s=0;s<t.length;s+=2){const n=t[s],a=t[s+1];e[s]=n*r.a+a*r.c+r.tx,e[s+1]=n*r.b+a*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=e.orig,n=e.trim;n&&(ao.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(ao));const a=e.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return o[0]=(e._frame.x+h+l)/a.width,o[1]=(e._frame.y+h+l)/a.height,o[2]=(e._frame.x+e._frame.width-h+l)/a.width,o[3]=(e._frame.y+e._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}var Qu=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,tc=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class ec extends he{constructor(t,e,r){let s=null;typeof t!="string"&&e===void 0&&r===void 0&&(s=t,t=void 0,e=void 0,r=void 0),super(t||tc,e||Qu,r),this.maskSprite=s,this.maskMatrix=new Ct}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,s){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Ju(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,r,s))}}class rc{constructor(t=null){this.type=It.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=he.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=It.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class ah{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const n=this.maskDataPool.pop()||new rc;n.pooled=!0,n.maskObject=e,r=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==It.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case It.SCISSOR:this.renderer.scissor.push(r);break;case It.STENCIL:this.renderer.stencil.push(r);break;case It.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case It.COLOR:this.pushColorMask(r);break}r.type===It.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case It.SCISSOR:this.renderer.scissor.pop(e);break;case It.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case It.SPRITE:this.popSpriteMask(e);break;case It.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===It.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=It.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=It.SCISSOR:t.type=It.STENCIL:t.type=It.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new ec])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;const n=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,s),r.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}ah.extension={type:ht.RendererSystem,name:"mask"};mt.add(ah);class oh{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==r&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const oo=new Ct,ho=[],hh=class Wr extends oh{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:s}=this,n=s.renderTexture,a=r.getBounds(!0,ho.pop()??new Et);this.roundFrameToPixels(a,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),e&&a.fit(e),t._scissorRectLocal=a}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:s,d:n}=t;return(Math.abs(r)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||Wr.isMatrixRotated(e.worldTransform)||Wr.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,s,n){Wr.isMatrixRotated(n)||(n=n?oo.copyFrom(n):oo.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&ho.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};hh.extension={type:ht.RendererSystem,name:"scissor"};let sc=hh;mt.add(sc);class lh extends oh{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(r._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}lh.extension={type:ht.RendererSystem,name:"stencil"};mt.add(lh);class uh{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return vt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return vt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return vt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}uh.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"_plugin"};mt.add(uh);class ch{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ct,this.transform=null}update(t,e,r,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,r,s){const n=this.projectionMatrix,a=s?-1:1;n.identity(),n.a=1/e.width*2,n.d=a*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-a-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}ch.extension={type:ht.RendererSystem,name:"projection"};mt.add(ch);const ic=new un,lo=new Et;class dh{constructor(t){this.renderer=t,this._tempMatrix=new Ct}generateTexture(t,e){const{region:r,...s}=e||{},n=r?.copyTo(lo)||t.getLocalBounds(lo,!0),a=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/a),n.height=Math.max(n.height,1/a),s.width=n.width,s.height=n.height,s.resolution=a,s.multisample??(s.multisample=this.renderer.multisample);const o=ps.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const h=t.transform;return t.transform=ic,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,o}destroy(){}}dh.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"textureGenerator"};mt.add(dh);const fe=new Et,or=new Et;class fh{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Et,this.destinationFrame=new Et,this.viewportFrame=new Et}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const s=this.renderer;this.current=t;let n,a,o;t?(n=t.baseTexture,o=n.resolution,e||(fe.width=t.frame.width,fe.height=t.frame.height,e=fe),r||(or.x=t.frame.x,or.y=t.frame.y,or.width=e.width,or.height=e.height,r=or),a=n.framebuffer):(o=s.resolution,e||(fe.width=s._view.screen.width,fe.height=s._view.screen.height,e=fe),r||(r=fe,r.width=e.width,r.height=e.height));const h=this.viewportFrame;h.x=r.x*o,h.y=r.y*o,h.width=r.width*o,h.height=r.height*o,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(r,e,o,!a),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=Qe.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const n=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==a.width||n.height!==a.height;if(o){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}fh.extension={type:ht.RendererSystem,name:"renderTexture"};mt.add(fh);class nc{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function ac(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const n=t.getActiveAttrib(i,s);if(n.name.startsWith("gl_"))continue;const a=Ko(t,n.type),o={type:a,name:n.name,size:Zo(a),location:t.getAttribLocation(i,n.name)};e[n.name]=o}return e}function oc(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){const n=t.getActiveUniform(i,s),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=Ko(t,n.type);e[a]={name:a,index:s,type:h,size:n.size,isArray:o,value:Wo(h,n.size)}}return e}function hc(i,t){const e=to(i,i.VERTEX_SHADER,t.vertexSrc),r=to(i,i.FRAGMENT_SHADER,t.fragmentSrc),s=i.createProgram();i.attachShader(s,e),i.attachShader(s,r);const n=t.extra?.transformFeedbackVaryings;if(n&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)||Nu(i,s,e,r),t.attributeData=ac(s,i),t.uniformData=oc(s,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const o=Object.keys(t.attributeData);o.sort((h,l)=>h>l?1:-1);for(let h=0;h<o.length;h++)t.attributeData[o[h]].location=h,i.bindAttribLocation(s,h,o[h]);i.linkProgram(s)}i.deleteShader(e),i.deleteShader(r);const a={};for(const o in t.uniformData){const h=t.uniformData[o];a[o]={location:i.getUniformLocation(s,o),value:Wo(h.type,h.size)}}return new nc(s,a)}function lc(i,t,e,r,s){e.buffer.update(s)}const uc={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},ph={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function cc(i){const t=i.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,r=0,s=0;for(let n=0;n<t.length;n++){const a=t[n];if(e=ph[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,r%e!==0&&r<16){const o=r%e%16;r+=o,s+=o}r+e>16?(s=Math.ceil(s/16)*16,a.offset=s,s+=e,r=e):(a.offset=s,r+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function dc(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,s)=>r.index-s.index),e}function fc(i,t){if(!i.autoManage)return{size:0,syncFunc:lc};const e=dc(i.uniforms,t),{uboElements:r,size:s}=cc(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<r.length;a++){const o=r[a],h=i.uniforms[o.data.name],l=o.data.name;let u=!1;for(let c=0;c<Ke.length;c++){const f=Ke[c];if(f.codeUbo&&f.test(o.data,h)){n.push(`offset = ${o.offset/4};`,Ke[c].codeUbo(o.data.name,h)),u=!0;break}}if(!u)if(o.data.size>1){const c=Zo(o.data.type),f=Math.max(ph[o.data.type]/16,1),p=c/f,v=(4-p%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*f}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${v};
                }

                `)}else{const c=uc[o.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};
                ${c};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let pc=0;const kr={textureCount:0,uboCount:0};class mh{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=pc++}systemCheck(){if(!Bu())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),e||(kr.textureCount=0,kr.uboCount=0,this.syncUniformGroup(t.uniformGroup,kr)),s}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=Lu(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const s=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),s(r.uniformData,t.uniforms,this.renderer,kr,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=fc(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(o.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const s=t.uniforms,n=[`${r}-`];for(const a in s)n.push(a),e[a]&&n.push(e[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,s=hc(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}mh.extension={type:ht.RendererSystem,name:"shader"};mt.add(mh);class is{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}is.defaultOptions={hello:!1},is.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"startup"};mt.add(is);function mc(i,t=[]){return t[st.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.ADD]=[i.ONE,i.ONE],t[st.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.NONE]=[0,0],t[st.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[st.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[st.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[st.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[st.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[st.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[st.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[st.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[st.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[st.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const yc=0,gc=1,vc=2,_c=3,xc=4,bc=5,yh=class Yi{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=st.NONE,this._blendEq=!1,this.map=[],this.map[yc]=this.setBlend,this.map[gc]=this.setOffset,this.map[vc]=this.setCullFace,this.map[_c]=this.setDepthTest,this.map[xc]=this.setFrontFace,this.map[bc]=this.setDepthMask,this.checks=[],this.defaultState=new sr,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=mc(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Yi.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Yi.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};yh.extension={type:ht.RendererSystem,name:"state"};let Tc=yh;mt.add(Tc);class Ec extends us{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(s=>t.systems[s]),r=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(const s of r)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Ht(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(s=>{const n=r.find(a=>this._systemsHash[a]===s);s[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const fr=class Yr{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Yr.defaultMaxIdle,this.checkCountMax=Yr.defaultCheckCountMax,this.mode=Yr.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==an.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let s=0;s<e.length;s++){const n=e[s];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[s]=null,r=!0)}if(r){let s=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[s++]=e[n]);e.length=s}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};fr.defaultMode=an.AUTO,fr.defaultMaxIdle=60*60,fr.defaultCheckCountMax=60*10,fr.extension={type:ht.RendererSystem,name:"textureGC"};let Te=fr;mt.add(Te);class Ni{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ot.UNSIGNED_BYTE,this.internalFormat=X.RGBA,this.samplerType=0}}function wc(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[i.RGB]:W.FLOAT,[i.RGBA]:W.FLOAT,[i.ALPHA]:W.FLOAT,[i.LUMINANCE]:W.FLOAT,[i.LUMINANCE_ALPHA]:W.FLOAT,[i.R8]:W.FLOAT,[i.R8_SNORM]:W.FLOAT,[i.RG8]:W.FLOAT,[i.RG8_SNORM]:W.FLOAT,[i.RGB8]:W.FLOAT,[i.RGB8_SNORM]:W.FLOAT,[i.RGB565]:W.FLOAT,[i.RGBA4]:W.FLOAT,[i.RGB5_A1]:W.FLOAT,[i.RGBA8]:W.FLOAT,[i.RGBA8_SNORM]:W.FLOAT,[i.RGB10_A2]:W.FLOAT,[i.RGB10_A2UI]:W.FLOAT,[i.SRGB8]:W.FLOAT,[i.SRGB8_ALPHA8]:W.FLOAT,[i.R16F]:W.FLOAT,[i.RG16F]:W.FLOAT,[i.RGB16F]:W.FLOAT,[i.RGBA16F]:W.FLOAT,[i.R32F]:W.FLOAT,[i.RG32F]:W.FLOAT,[i.RGB32F]:W.FLOAT,[i.RGBA32F]:W.FLOAT,[i.R11F_G11F_B10F]:W.FLOAT,[i.RGB9_E5]:W.FLOAT,[i.R8I]:W.INT,[i.R8UI]:W.UINT,[i.R16I]:W.INT,[i.R16UI]:W.UINT,[i.R32I]:W.INT,[i.R32UI]:W.UINT,[i.RG8I]:W.INT,[i.RG8UI]:W.UINT,[i.RG16I]:W.INT,[i.RG16UI]:W.UINT,[i.RG32I]:W.INT,[i.RG32UI]:W.UINT,[i.RGB8I]:W.INT,[i.RGB8UI]:W.UINT,[i.RGB16I]:W.INT,[i.RGB16UI]:W.UINT,[i.RGB32I]:W.INT,[i.RGB32UI]:W.UINT,[i.RGBA8I]:W.INT,[i.RGBA8UI]:W.UINT,[i.RGBA16I]:W.INT,[i.RGBA16UI]:W.UINT,[i.RGBA32I]:W.INT,[i.RGBA32UI]:W.UINT,[i.DEPTH_COMPONENT16]:W.FLOAT,[i.DEPTH_COMPONENT24]:W.FLOAT,[i.DEPTH_COMPONENT32F]:W.FLOAT,[i.DEPTH_STENCIL]:W.FLOAT,[i.DEPTH24_STENCIL8]:W.FLOAT,[i.DEPTH32F_STENCIL8]:W.FLOAT}:t={[i.RGB]:W.FLOAT,[i.RGBA]:W.FLOAT,[i.ALPHA]:W.FLOAT,[i.LUMINANCE]:W.FLOAT,[i.LUMINANCE_ALPHA]:W.FLOAT,[i.DEPTH_STENCIL]:W.FLOAT},t}function Sc(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[ot.UNSIGNED_BYTE]:{[X.RGBA]:i.RGBA8,[X.RGB]:i.RGB8,[X.RG]:i.RG8,[X.RED]:i.R8,[X.RGBA_INTEGER]:i.RGBA8UI,[X.RGB_INTEGER]:i.RGB8UI,[X.RG_INTEGER]:i.RG8UI,[X.RED_INTEGER]:i.R8UI,[X.ALPHA]:i.ALPHA,[X.LUMINANCE]:i.LUMINANCE,[X.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ot.BYTE]:{[X.RGBA]:i.RGBA8_SNORM,[X.RGB]:i.RGB8_SNORM,[X.RG]:i.RG8_SNORM,[X.RED]:i.R8_SNORM,[X.RGBA_INTEGER]:i.RGBA8I,[X.RGB_INTEGER]:i.RGB8I,[X.RG_INTEGER]:i.RG8I,[X.RED_INTEGER]:i.R8I},[ot.UNSIGNED_SHORT]:{[X.RGBA_INTEGER]:i.RGBA16UI,[X.RGB_INTEGER]:i.RGB16UI,[X.RG_INTEGER]:i.RG16UI,[X.RED_INTEGER]:i.R16UI,[X.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[ot.SHORT]:{[X.RGBA_INTEGER]:i.RGBA16I,[X.RGB_INTEGER]:i.RGB16I,[X.RG_INTEGER]:i.RG16I,[X.RED_INTEGER]:i.R16I},[ot.UNSIGNED_INT]:{[X.RGBA_INTEGER]:i.RGBA32UI,[X.RGB_INTEGER]:i.RGB32UI,[X.RG_INTEGER]:i.RG32UI,[X.RED_INTEGER]:i.R32UI,[X.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[ot.INT]:{[X.RGBA_INTEGER]:i.RGBA32I,[X.RGB_INTEGER]:i.RGB32I,[X.RG_INTEGER]:i.RG32I,[X.RED_INTEGER]:i.R32I},[ot.FLOAT]:{[X.RGBA]:i.RGBA32F,[X.RGB]:i.RGB32F,[X.RG]:i.RG32F,[X.RED]:i.R32F,[X.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[ot.HALF_FLOAT]:{[X.RGBA]:i.RGBA16F,[X.RGB]:i.RGB16F,[X.RG]:i.RG16F,[X.RED]:i.R16F},[ot.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:i.RGB565},[ot.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:i.RGBA4},[ot.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:i.RGB5_A1},[ot.UNSIGNED_INT_2_10_10_10_REV]:{[X.RGBA]:i.RGB10_A2,[X.RGBA_INTEGER]:i.RGB10_A2UI},[ot.UNSIGNED_INT_10F_11F_11F_REV]:{[X.RGB]:i.R11F_G11F_B10F},[ot.UNSIGNED_INT_5_9_9_9_REV]:{[X.RGB]:i.RGB9_E5},[ot.UNSIGNED_INT_24_8]:{[X.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[ot.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[X.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[ot.UNSIGNED_BYTE]:{[X.RGBA]:i.RGBA,[X.RGB]:i.RGB,[X.ALPHA]:i.ALPHA,[X.LUMINANCE]:i.LUMINANCE,[X.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ot.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:i.RGB},[ot.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:i.RGBA},[ot.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:i.RGBA}},t}class gh{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new _t,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Sc(t),this.samplerTypes=wc(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};const r=new Ni(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Ni(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=t-1;n>=0;--n){const a=e[n];a&&a._glTextures[s].samplerType!==W.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new Ni(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??W.FLOAT,this.webGLVersion===2&&t.type===ot.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==W.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,n=t.realHeight,a=r.gl;(e.width!==s||e.height!==n||e.dirtyId<0)&&(e.width=s,e.height=n,a.texImage2D(t.target,0,e.internalFormat,s,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const s=this.managedTextures.indexOf(t);s!==-1&&jr(this.managedTextures,s,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Se.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=nn.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==Se.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Qt.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===Qt.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Qt.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===Qt.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}gh.extension={type:ht.RendererSystem,name:"texture"};mt.add(gh);class vh{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:s}=this;e&&s.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:s}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[s]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];o&&(r.buffer.update(o),o._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const h=o._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(o,e))}r&&(e||s.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}vh.extension={type:ht.RendererSystem,name:"transformFeedback"};mt.add(vh);class ns{constructor(t){this.renderer=t}init(t){this.screen=new Et(0,0,t.width,t.height),this.element=t.view||ft.ADAPTER.createCanvas(),this.resolution=t.resolution||ft.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}ns.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},ns.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"_view"};mt.add(ns);ft.PREFER_ENV=Ae.WEBGL2;ft.STRICT_TEXTURE_CACHE=!1;ft.RENDER_OPTIONS={...ss.defaultOptions,...rs.defaultOptions,...ns.defaultOptions,...is.defaultOptions};Object.defineProperties(ft,{WRAP_MODE:{get(){return _t.defaultOptions.wrapMode},set(i){vt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),_t.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return _t.defaultOptions.scaleMode},set(i){vt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),_t.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return _t.defaultOptions.mipmap},set(i){vt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),_t.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return _t.defaultOptions.anisotropicLevel},set(i){vt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),_t.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return vt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),he.defaultResolution},set(i){he.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return vt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),he.defaultMultisample},set(i){he.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return be.defaultMaxTextures},set(i){vt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),be.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return be.defaultBatchSize},set(i){vt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),be.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return be.canUploadSameBuffer},set(i){vt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),be.canUploadSameBuffer=i}},GC_MODE:{get(){return Te.defaultMode},set(i){vt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Te.defaultMode=i}},GC_MAX_IDLE:{get(){return Te.defaultMaxIdle},set(i){vt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Te.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return Te.defaultCheckCountMax},set(i){vt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Te.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return we.defaultVertexPrecision},set(i){vt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),we.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return we.defaultFragmentPrecision},set(i){vt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),we.defaultFragmentPrecision=i}}});var as=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(as||{});class Oi{constructor(t,e=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const _h=class Bt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Oi(null,null,1/0),this.deltaMS=1/Bt.targetFPMS,this.elapsedMS=1/Bt.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=as.NORMAL){return this._addListener(new Oi(t,e,r))}addOnce(t,e,r=as.NORMAL){return this._addListener(new Oi(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Bt.targetFPMS;const r=this._head;let s=r.next;for(;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,Bt.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Bt._shared){const t=Bt._shared=new Bt;t.autoStart=!0,t._protected=!0}return Bt._shared}static get system(){if(!Bt._system){const t=Bt._system=new Bt;t.autoStart=!0,t._protected=!0}return Bt._system}};_h.targetFPMS=.06;let le=_h;Object.defineProperties(ft,{TARGET_FPMS:{get(){return le.targetFPMS},set(i){vt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),le.targetFPMS=i}}});class xh{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,as.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?le.shared:new le,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}xh.extension=ht.Application;mt.add(xh);const bh=[];mt.handleByList(ht.Renderer,bh);function Ac(i){for(const t of bh)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var Rc=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Mc=Rc;class Th{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=Rt.HIGH?this.multisample=Rt.HIGH:e>=Rt.MEDIUM?this.multisample=Rt.MEDIUM:e>=Rt.LOW?this.multisample=Rt.LOW:this.multisample=Rt.NONE}destroy(){}}Th.extension={type:ht.RendererSystem,name:"_multisample"};mt.add(Th);class Ic{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Eh{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,r){const{gl:s,CONTEXT_UID:n}=this;r=r||0;const a=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,a.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),r&&(e||s.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new Ic(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Eh.extension={type:ht.RendererSystem,name:"buffer"};mt.add(Eh);class wh{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let s,n,a,o;if(e&&(s=e.renderTexture,n=e.clear,a=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=a,!r.context.isLost){if(s||(this.lastObjectRendered=t),!o){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),s&&(e.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}wh.extension={type:ht.RendererSystem,name:"objectRenderer"};mt.add(wh);const Zr=class Zi extends Ec{constructor(t){super(),this.type=Co.WEBGL,t=Object.assign({},ft.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Yt({projectionMatrix:new Ct},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Zi.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(vt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Zi.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:Kl()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return vt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return vt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return vt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return vt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){vt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return vt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){vt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return vt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Zr.extension={type:ht.Renderer,priority:1},Zr.__plugins={},Zr.__systems={};let dn=Zr;mt.handleByMap(ht.RendererPlugin,dn.__plugins);mt.handleByMap(ht.RendererSystem,dn.__systems);mt.add(dn);class Sh extends br{constructor(t,e){const{width:r,height:s}=e||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const a=new _t;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof br?this.addResourceAt(t[r],r):this.addResourceAt(Ho(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}}class Cc extends Sh{constructor(t,e){const{width:r,height:s}=e||{};let n,a;Array.isArray(t)?(n=t,a=t.length):a=t,super(a,{width:r,height:s}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Ze.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:s,itemDirtyIds:n,items:a}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,e.format,r.type,null);for(let h=0;h<s;h++){const l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,r.type,l.resource.source))}return!0}}class Lc extends te{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Ah=class pr extends Sh{constructor(t,e){const{width:r,height:s,autoLoad:n,linkBaseTexture:a}=e||{};if(t&&t.length!==pr.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:s});for(let o=0;o<pr.SIDES;o++)this.items[o].target=Ze.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=a!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=Ze.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Ze.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const s=this.itemDirtyIds;for(let n=0;n<pr.SIDES;n++){const a=this.items[n];(s[n]<a.dirtyId||r.dirtyId<e.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(t,a,r),s[n]=a.dirtyId):s[n]<-1&&(t.gl.texImage2D(a.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),s[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===pr.SIDES}};Ah.SIDES=6;let Fc=Ah;class We extends te{constructor(t,e){e=e||{};let r,s,n;typeof t=="string"?(r=We.EMPTY,s=t,n=!0):(r=t,s=null,n=!1),super(r),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await ft.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Re.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return We._EMPTY=We._EMPTY??ft.ADAPTER.createCanvas(0,0),We._EMPTY}}const Ki=class Kr extends te{constructor(t,e){e=e||{},super(ft.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Kr.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;te.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/r*e,n=this._overrideHeight||this._overrideWidth/e*r),s=Math.round(s),n=Math.round(n);const a=this.source;a.width=s,a.height=n,a._pixiId=`canvas_${xr()}`,a.getContext("2d").drawImage(t,0,0,e,r,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(t){const e=Kr.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Kr.SVG_XML.test(t)}};Ki.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Ki.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Pc=Ki;class Nc extends te{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const Ji=class Qi extends te{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const s=t[0].src||t[0];te.crossOrigin(r,s,e.crossorigin);for(let n=0;n<t.length;++n){const a=document.createElement("source");let{src:o,mime:h}=t[n];if(o=o||t[n],o.startsWith("data:"))h=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){const l=o.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||Qi.MIME_TYPES[u]||`video/${u}`}a.src=o,h&&(a.type=h),r.appendChild(a)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=le.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(le.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(le.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(le.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Qi.TYPES.includes(e)}};Ji.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Ji.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Oc=Ji;$i.push(We,eh,Lc,Oc,Nc,Pc,qo,Fc,Cc);class uo{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Et.EMPTY:(t=t||new Et(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:s,c:n,d:a,tx:o,ty:h}=t,l=r*e.x+n*e.y+o,u=s*e.x+a*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,r=this.minY,s=this.maxX,n=this.maxY,a=t[0],o=t[1];e=a<e?a:e,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,a=t[2],o=t[3],e=a<e?a:e,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,a=t[4],o=t[5],e=a<e?a:e,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,a=t[6],o=t[7],e=a<e?a:e,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}addFrame(t,e,r,s,n){this.addFrameMatrix(t.worldTransform,e,r,s,n)}addFrameMatrix(t,e,r,s,n){const a=t.a,o=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let f=this.minX,p=this.minY,v=this.maxX,g=this.maxY,d=a*e+h*r+u,y=o*e+l*r+c;f=d<f?d:f,p=y<p?y:p,v=d>v?d:v,g=y>g?y:g,d=a*s+h*r+u,y=o*s+l*r+c,f=d<f?d:f,p=y<p?y:p,v=d>v?d:v,g=y>g?y:g,d=a*e+h*n+u,y=o*e+l*n+c,f=d<f?d:f,p=y<p?y:p,v=d>v?d:v,g=y>g?y:g,d=a*s+h*n+u,y=o*s+l*n+c,f=d<f?d:f,p=y<p?y:p,v=d>v?d:v,g=y>g?y:g,this.minX=f,this.minY=p,this.maxX=v,this.maxY=g}addVertexData(t,e,r){let s=this.minX,n=this.minY,a=this.maxX,o=this.maxY;for(let h=e;h<r;h+=2){const l=t[h],u=t[h+1];s=l<s?l:s,n=u<n?u:n,a=l>a?l:a,o=u>o?u:o}this.minX=s,this.minY=n,this.maxX=a,this.maxY=o}addVertices(t,e,r,s){this.addVerticesMatrix(t.worldTransform,e,r,s)}addVerticesMatrix(t,e,r,s,n=0,a=n){const o=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,f=t.ty;let p=this.minX,v=this.minY,g=this.maxX,d=this.maxY;for(let y=r;y<s;y+=2){const x=e[y],E=e[y+1],w=o*x+l*E+c,m=u*E+h*x+f;p=Math.min(p,w-n),g=Math.max(g,w+n),v=Math.min(v,m-a),d=Math.max(d,m+a)}this.minX=p,this.minY=v,this.maxX=g,this.maxY=d}addBounds(t){const e=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<o?r:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<o?r:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,s,n,a){t-=n,e-=a,r+=n,s+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class er extends us{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new un,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new uo,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const s=e[r];Object.defineProperty(er.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Et),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Et),t=this._localBoundsRect),this._localBounds||(this._localBounds=new uo);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=r?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-n,a}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,s){return e&&(t=e.toGlobal(t,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,s=1,n=0,a=0,o=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=a,this.skew.y=o,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Bc),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*wu}set angle(t){this.transform.rotation=t*Su}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class Bc extends er{constructor(){super(...arguments),this.sortDirty=null}}er.prototype.displayObjectUpdateTransform=er.prototype.updateTransform;const kc=new Ct;function Uc(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const Rh=class tn extends er{constructor(){super(),this.children=[],this.sortableChildren=tn.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t,this.onChildrenChange(r<s?r:s)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);jr(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,jr(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,jr(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,s=e,n=s-r;let a;if(n>0&&n<=s){a=this.children.splice(r,n);for(let o=0;o<a.length;++o)a[o].parent=null,a[o].transform&&(a[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<a.length;++o)a[o].emit("removed",this),this.emit("childRemoved",a[o],this,o);return a}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(Uc),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let s=0,n=this.children.length;s<n;++s){const a=this.children[s];a.visible&&a.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,s;this.cullArea?(r=this.cullArea,s=this.worldTransform):this._render!==tn.prototype._render&&(r=this.getBounds(!0));const n=t.projection.transform;if(n&&(s?(s=kc.copyFrom(s),s.prepend(n)):s=n),r&&e.intersects(r,s))this._render(t);else if(this.cullArea)return;for(let a=0,o=this.children.length;a<o;++a){const h=this.children[a],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n])}const s=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==It.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,a=this.children.length;n<a;++n)this.children[n].render(t)}s&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<r.length;++s)r[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};Rh.defaultSortableChildren=!1;let Tr=Rh;Tr.prototype.containerUpdateTransform=Tr.prototype.updateTransform;Object.defineProperties(ft,{SORTABLE_CHILDREN:{get(){return Tr.defaultSortableChildren},set(i){vt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Tr.defaultSortableChildren=i}}});const Mh=class en{constructor(t){this.stage=new Tr,t=Object.assign({forceCanvas:!1},t),this.renderer=Ac(t),en._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){const r=en._plugins.slice(0);r.reverse(),r.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Mh._plugins=[];let Dc=Mh;mt.handleByList(ht.Application,Dc._plugins);class Ih{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;e=s,r=n}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Ih.extension=ht.Application;mt.add(Ih);var Gc=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,zc=`uniform float radius;
uniform float strength;
uniform vec2 center;
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

void main()
{
    vec2 coord = vTextureCoord * filterArea.xy;
    coord -= center * dimensions.xy;
    float distance = length(coord);
    if (distance < radius) {
        float percent = distance / radius;
        if (strength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
        }
    }
    coord += center * dimensions.xy;
    coord /= filterArea.xy;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    gl_FragColor = color;
}
`;const Ch=class extends he{constructor(i){super(Gc,zc),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,Ch.defaults,i)}apply(i,t,e,r){const{width:s,height:n}=t.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,i.applyFilter(this,t,e,r)}get radius(){return this.uniforms.radius}set radius(i){this.uniforms.radius=i}get strength(){return this.uniforms.strength}set strength(i){this.uniforms.strength=i}get center(){return this.uniforms.center}set center(i){this.uniforms.center=i}};let $c=Ch;$c.defaults={center:[.5,.5],radius:100,strength:1};var Vc=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class co extends he{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Mc,Vc,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,s,n]=Qe.shared.setValue(t).toArray(),a=[r,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(a,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),s=Math.sin(t),n=Math.sqrt,a=1/3,o=n(a),h=r+(1-r)*a,l=a*(1-r)-o*s,u=a*(1-r)+o*s,c=a*(1-r)+o*s,f=r+a*(1-r),p=a*(1-r)-o*s,v=a*(1-r)-o*s,g=a*(1-r)+o*s,d=r+a*(1-r),y=[h,l,u,0,0,c,f,p,0,0,v,g,d,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const r=(t||0)+1,s=-.5*(r-1),n=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const r=t*2/3+1,s=(r-1)*-.5,n=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,s,n){t=t||.2,e=e||.15,r=r||16770432,s=s||3375104;const a=Qe.shared,[o,h,l]=a.setValue(r).toArray(),[u,c,f]=a.setValue(s).toArray(),p=[.3,.59,.11,0,0,o,h,l,t,0,u,c,f,e,0,o-u,h-c,l-f,0,0];this._loadMatrix(p,n)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}co.prototype.grayscale=co.prototype.greyscale;var Hc=Object.defineProperty,qc=(i,t,e)=>t in i?Hc(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,I=(i,t,e)=>qc(i,typeof t!="symbol"?t+"":t,e);class Xc{}class jc extends Xc{constructor(t){super(),I(this,"observer"),I(this,"flowSpeed",4),I(this,"currerntRenderScale",.75),this.canvas=t,this.observer=new ResizeObserver(()=>{const e=Math.max(1,t.clientWidth*window.devicePixelRatio*this.currerntRenderScale),r=Math.max(1,t.clientHeight*window.devicePixelRatio*this.currerntRenderScale);this.onResize(e,r)}),this.observer.observe(t)}setRenderScale(t){this.currerntRenderScale=t,this.onResize(this.canvas.clientWidth*window.devicePixelRatio*this.currerntRenderScale,this.canvas.clientHeight*window.devicePixelRatio*this.currerntRenderScale)}onResize(t,e){this.canvas.width=t,this.canvas.height=e}setFlowSpeed(t){this.flowSpeed=t}dispose(){this.observer.disconnect(),this.canvas.remove()}getElement(){return this.canvas}}const yt=1e-6,fo=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Lh=class At extends Float32Array{constructor(...t){switch(t.length){case 16:super(t);break;case 2:super(t[0],t[1],16);break;case 1:const e=t[0];typeof e=="number"?super([e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]):super(e,0,16);break;default:super(fo);break}}get str(){return At.str(this)}copy(t){return this.set(t),this}identity(){return this.set(fo),this}multiply(t){return At.multiply(this,this,t)}mul(t){return this}transpose(){return At.transpose(this,this)}invert(){return At.invert(this,this)}translate(t){return At.translate(this,this,t)}rotate(t,e){return At.rotate(this,this,t,e)}scale(t){return At.scale(this,this,t)}rotateX(t){return At.rotateX(this,this,t)}rotateY(t){return At.rotateY(this,this,t)}rotateZ(t){return At.rotateZ(this,this,t)}perspectiveNO(t,e,r,s){return At.perspectiveNO(this,t,e,r,s)}perspectiveZO(t,e,r,s){return At.perspectiveZO(this,t,e,r,s)}orthoNO(t,e,r,s,n,a){return At.orthoNO(this,t,e,r,s,n,a)}orthoZO(t,e,r,s,n,a){return At.orthoZO(this,t,e,r,s,n,a)}static create(){return new At}static clone(t){return new At(t)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static fromValues(...t){return new At(...t)}static set(t,...e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static transpose(t,e){if(t===e){const r=e[1],s=e[2],n=e[3],a=e[6],o=e[7],h=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=h}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}static invert(t,e){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],f=e[9],p=e[10],v=e[11],g=e[12],d=e[13],y=e[14],x=e[15],E=r*h-s*o,w=r*l-n*o,m=r*u-a*o,S=s*l-n*h,_=s*u-a*h,B=n*u-a*l,U=c*d-f*g,k=c*y-p*g,D=c*x-v*g,L=f*y-p*d,j=f*x-v*d,H=p*x-v*y;let V=E*H-w*j+m*L+S*D-_*k+B*U;return V?(V=1/V,t[0]=(h*H-l*j+u*L)*V,t[1]=(n*j-s*H-a*L)*V,t[2]=(d*B-y*_+x*S)*V,t[3]=(p*_-f*B-v*S)*V,t[4]=(l*D-o*H-u*k)*V,t[5]=(r*H-n*D+a*k)*V,t[6]=(y*m-g*B-x*w)*V,t[7]=(c*B-p*m+v*w)*V,t[8]=(o*j-h*D+u*U)*V,t[9]=(s*D-r*j-a*U)*V,t[10]=(g*_-d*m+x*E)*V,t[11]=(f*m-c*_-v*E)*V,t[12]=(h*k-o*L-l*U)*V,t[13]=(r*L-s*k+n*U)*V,t[14]=(d*w-g*S-y*E)*V,t[15]=(c*S-f*w+p*E)*V,t):null}static adjoint(t,e){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],f=e[9],p=e[10],v=e[11],g=e[12],d=e[13],y=e[14],x=e[15],E=r*h-s*o,w=r*l-n*o,m=r*u-a*o,S=s*l-n*h,_=s*u-a*h,B=n*u-a*l,U=c*d-f*g,k=c*y-p*g,D=c*x-v*g,L=f*y-p*d,j=f*x-v*d,H=p*x-v*y;return t[0]=h*H-l*j+u*L,t[1]=n*j-s*H-a*L,t[2]=d*B-y*_+x*S,t[3]=p*_-f*B-v*S,t[4]=l*D-o*H-u*k,t[5]=r*H-n*D+a*k,t[6]=y*m-g*B-x*w,t[7]=c*B-p*m+v*w,t[8]=o*j-h*D+u*U,t[9]=s*D-r*j-a*U,t[10]=g*_-d*m+x*E,t[11]=f*m-c*_-v*E,t[12]=h*k-o*L-l*U,t[13]=r*L-s*k+n*U,t[14]=d*w-g*S-y*E,t[15]=c*S-f*w+p*E,t}static determinant(t){const e=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=t[9],f=t[10],p=t[11],v=t[12],g=t[13],d=t[14],y=t[15],x=e*o-r*a,E=e*h-s*a,w=r*h-s*o,m=u*g-c*v,S=u*d-f*v,_=c*d-f*g,B=e*_-r*S+s*m,U=a*_-o*S+h*m,k=u*w-c*E+f*x,D=v*w-g*E+d*x;return l*B-n*U+y*k-p*D}static multiply(t,e,r){const s=e[0],n=e[1],a=e[2],o=e[3],h=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=e[9],v=e[10],g=e[11],d=e[12],y=e[13],x=e[14],E=e[15];let w=r[0],m=r[1],S=r[2],_=r[3];return t[0]=w*s+m*h+S*f+_*d,t[1]=w*n+m*l+S*p+_*y,t[2]=w*a+m*u+S*v+_*x,t[3]=w*o+m*c+S*g+_*E,w=r[4],m=r[5],S=r[6],_=r[7],t[4]=w*s+m*h+S*f+_*d,t[5]=w*n+m*l+S*p+_*y,t[6]=w*a+m*u+S*v+_*x,t[7]=w*o+m*c+S*g+_*E,w=r[8],m=r[9],S=r[10],_=r[11],t[8]=w*s+m*h+S*f+_*d,t[9]=w*n+m*l+S*p+_*y,t[10]=w*a+m*u+S*v+_*x,t[11]=w*o+m*c+S*g+_*E,w=r[12],m=r[13],S=r[14],_=r[15],t[12]=w*s+m*h+S*f+_*d,t[13]=w*n+m*l+S*p+_*y,t[14]=w*a+m*u+S*v+_*x,t[15]=w*o+m*c+S*g+_*E,t}static mul(t,e,r){return t}static translate(t,e,r){const s=r[0],n=r[1],a=r[2];if(e===t)t[12]=e[0]*s+e[4]*n+e[8]*a+e[12],t[13]=e[1]*s+e[5]*n+e[9]*a+e[13],t[14]=e[2]*s+e[6]*n+e[10]*a+e[14],t[15]=e[3]*s+e[7]*n+e[11]*a+e[15];else{const o=e[0],h=e[1],l=e[2],u=e[3],c=e[4],f=e[5],p=e[6],v=e[7],g=e[8],d=e[9],y=e[10],x=e[11];t[0]=o,t[1]=h,t[2]=l,t[3]=u,t[4]=c,t[5]=f,t[6]=p,t[7]=v,t[8]=g,t[9]=d,t[10]=y,t[11]=x,t[12]=o*s+c*n+g*a+e[12],t[13]=h*s+f*n+d*a+e[13],t[14]=l*s+p*n+y*a+e[14],t[15]=u*s+v*n+x*a+e[15]}return t}static scale(t,e,r){const s=r[0],n=r[1],a=r[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static rotate(t,e,r,s){let n=s[0],a=s[1],o=s[2],h=Math.sqrt(n*n+a*a+o*o);if(h<yt)return null;h=1/h,n*=h,a*=h,o*=h;const l=Math.sin(r),u=Math.cos(r),c=1-u,f=e[0],p=e[1],v=e[2],g=e[3],d=e[4],y=e[5],x=e[6],E=e[7],w=e[8],m=e[9],S=e[10],_=e[11],B=n*n*c+u,U=a*n*c+o*l,k=o*n*c-a*l,D=n*a*c-o*l,L=a*a*c+u,j=o*a*c+n*l,H=n*o*c+a*l,V=a*o*c-n*l,T=o*o*c+u;return t[0]=f*B+d*U+w*k,t[1]=p*B+y*U+m*k,t[2]=v*B+x*U+S*k,t[3]=g*B+E*U+_*k,t[4]=f*D+d*L+w*j,t[5]=p*D+y*L+m*j,t[6]=v*D+x*L+S*j,t[7]=g*D+E*L+_*j,t[8]=f*H+d*V+w*T,t[9]=p*H+y*V+m*T,t[10]=v*H+x*V+S*T,t[11]=g*H+E*V+_*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t}static rotateX(t,e,r){let s=Math.sin(r),n=Math.cos(r),a=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=e[9],f=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+u*s,t[5]=o*n+c*s,t[6]=h*n+f*s,t[7]=l*n+p*s,t[8]=u*n-a*s,t[9]=c*n-o*s,t[10]=f*n-h*s,t[11]=p*n-l*s,t}static rotateY(t,e,r){let s=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],h=e[2],l=e[3],u=e[8],c=e[9],f=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-u*s,t[1]=o*n-c*s,t[2]=h*n-f*s,t[3]=l*n-p*s,t[8]=a*s+u*n,t[9]=o*s+c*n,t[10]=h*s+f*n,t[11]=l*s+p*n,t}static rotateZ(t,e,r){let s=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],h=e[2],l=e[3],u=e[4],c=e[5],f=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+u*s,t[1]=o*n+c*s,t[2]=h*n+f*s,t[3]=l*n+p*s,t[4]=u*n-a*s,t[5]=c*n-o*s,t[6]=f*n-h*s,t[7]=p*n-l*s,t}static fromTranslation(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}static fromScaling(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromRotation(t,e,r){let s=r[0],n=r[1],a=r[2],o=Math.sqrt(s*s+n*n+a*a);if(o<yt)return null;o=1/o,s*=o,n*=o,a*=o;const h=Math.sin(e),l=Math.cos(e),u=1-l;return t[0]=s*s*u+l,t[1]=n*s*u+a*h,t[2]=a*s*u-n*h,t[3]=0,t[4]=s*n*u-a*h,t[5]=n*n*u+l,t[6]=a*n*u+s*h,t[7]=0,t[8]=s*a*u+n*h,t[9]=n*a*u-s*h,t[10]=a*a*u+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromXRotation(t,e){let r=Math.sin(e),s=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromYRotation(t,e){let r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromZRotation(t,e){const r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromRotationTranslation(t,e,r){const s=e[0],n=e[1],a=e[2],o=e[3],h=s+s,l=n+n,u=a+a,c=s*h,f=s*l,p=s*u,v=n*l,g=n*u,d=a*u,y=o*h,x=o*l,E=o*u;return t[0]=1-(v+d),t[1]=f+E,t[2]=p-x,t[3]=0,t[4]=f-E,t[5]=1-(c+d),t[6]=g+y,t[7]=0,t[8]=p+x,t[9]=g-y,t[10]=1-(c+v),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}static fromQuat2(t,e){const r=-e[0],s=-e[1],n=-e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7];let c=r*r+s*s+n*n+a*a;return c>0?(zt[0]=(o*a+u*r+h*n-l*s)*2/c,zt[1]=(h*a+u*s+l*r-o*n)*2/c,zt[2]=(l*a+u*n+o*s-h*r)*2/c):(zt[0]=(o*a+u*r+h*n-l*s)*2,zt[1]=(h*a+u*s+l*r-o*n)*2,zt[2]=(l*a+u*n+o*s-h*r)*2),At.fromRotationTranslation(t,e,zt),t}static normalFromMat4(t,e){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],f=e[9],p=e[10],v=e[11],g=e[12],d=e[13],y=e[14],x=e[15],E=r*h-s*o,w=r*l-n*o,m=r*u-a*o,S=s*l-n*h,_=s*u-a*h,B=n*u-a*l,U=c*d-f*g,k=c*y-p*g,D=c*x-v*g,L=f*y-p*d,j=f*x-v*d,H=p*x-v*y;let V=E*H-w*j+m*L+S*D-_*k+B*U;return V?(V=1/V,t[0]=(h*H-l*j+u*L)*V,t[1]=(l*D-o*H-u*k)*V,t[2]=(o*j-h*D+u*U)*V,t[3]=0,t[4]=(n*j-s*H-a*L)*V,t[5]=(r*H-n*D+a*k)*V,t[6]=(s*D-r*j-a*U)*V,t[7]=0,t[8]=(d*B-y*_+x*S)*V,t[9]=(y*m-g*B-x*w)*V,t[10]=(g*_-d*m+x*E)*V,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):null}static normalFromMat4Fast(t,e){const r=e[0],s=e[1],n=e[2],a=e[4],o=e[5],h=e[6],l=e[8],u=e[9],c=e[10];return t[0]=o*c-c*u,t[1]=h*l-l*c,t[2]=a*u-u*l,t[3]=0,t[4]=u*n-c*s,t[5]=c*r-l*n,t[6]=l*s-u*r,t[7]=0,t[8]=s*h-n*o,t[9]=n*a-r*h,t[10]=r*o-s*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static getTranslation(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}static getScaling(t,e){const r=e[0],s=e[1],n=e[2],a=e[4],o=e[5],h=e[6],l=e[8],u=e[9],c=e[10];return t[0]=Math.sqrt(r*r+s*s+n*n),t[1]=Math.sqrt(a*a+o*o+h*h),t[2]=Math.sqrt(l*l+u*u+c*c),t}static getRotation(t,e){At.getScaling(zt,e);const r=1/zt[0],s=1/zt[1],n=1/zt[2],a=e[0]*r,o=e[1]*s,h=e[2]*n,l=e[4]*r,u=e[5]*s,c=e[6]*n,f=e[8]*r,p=e[9]*s,v=e[10]*n,g=a+u+v;let d=0;return g>0?(d=Math.sqrt(g+1)*2,t[3]=.25*d,t[0]=(c-p)/d,t[1]=(f-h)/d,t[2]=(o-l)/d):a>u&&a>v?(d=Math.sqrt(1+a-u-v)*2,t[3]=(c-p)/d,t[0]=.25*d,t[1]=(o+l)/d,t[2]=(f+h)/d):u>v?(d=Math.sqrt(1+u-a-v)*2,t[3]=(f-h)/d,t[0]=(o+l)/d,t[1]=.25*d,t[2]=(c+p)/d):(d=Math.sqrt(1+v-a-u)*2,t[3]=(o-l)/d,t[0]=(f+h)/d,t[1]=(c+p)/d,t[2]=.25*d),t}static decompose(t,e,r,s){e[0]=s[12],e[1]=s[13],e[2]=s[14];const n=s[0],a=s[1],o=s[2],h=s[4],l=s[5],u=s[6],c=s[8],f=s[9],p=s[10];r[0]=Math.sqrt(n*n+a*a+o*o),r[1]=Math.sqrt(h*h+l*l+u*u),r[2]=Math.sqrt(c*c+f*f+p*p);const v=1/r[0],g=1/r[1],d=1/r[2],y=n*v,x=a*g,E=o*d,w=h*v,m=l*g,S=u*d,_=c*v,B=f*g,U=p*d,k=y+m+U;let D=0;return k>0?(D=Math.sqrt(k+1)*2,t[3]=.25*D,t[0]=(S-B)/D,t[1]=(_-E)/D,t[2]=(x-w)/D):y>m&&y>U?(D=Math.sqrt(1+y-m-U)*2,t[3]=(S-B)/D,t[0]=.25*D,t[1]=(x+w)/D,t[2]=(_+E)/D):m>U?(D=Math.sqrt(1+m-y-U)*2,t[3]=(_-E)/D,t[0]=(x+w)/D,t[1]=.25*D,t[2]=(S+B)/D):(D=Math.sqrt(1+U-y-m)*2,t[3]=(x-w)/D,t[0]=(_+E)/D,t[1]=(S+B)/D,t[2]=.25*D),t}static fromRotationTranslationScale(t,e,r,s){const n=e[0],a=e[1],o=e[2],h=e[3],l=n+n,u=a+a,c=o+o,f=n*l,p=n*u,v=n*c,g=a*u,d=a*c,y=o*c,x=h*l,E=h*u,w=h*c,m=s[0],S=s[1],_=s[2];return t[0]=(1-(g+y))*m,t[1]=(p+w)*m,t[2]=(v-E)*m,t[3]=0,t[4]=(p-w)*S,t[5]=(1-(f+y))*S,t[6]=(d+x)*S,t[7]=0,t[8]=(v+E)*_,t[9]=(d-x)*_,t[10]=(1-(f+g))*_,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}static fromRotationTranslationScaleOrigin(t,e,r,s,n){const a=e[0],o=e[1],h=e[2],l=e[3],u=a+a,c=o+o,f=h+h,p=a*u,v=a*c,g=a*f,d=o*c,y=o*f,x=h*f,E=l*u,w=l*c,m=l*f,S=s[0],_=s[1],B=s[2],U=n[0],k=n[1],D=n[2],L=(1-(d+x))*S,j=(v+m)*S,H=(g-w)*S,V=(v-m)*_,T=(1-(p+x))*_,A=(y+E)*_,b=(g+w)*B,F=(y-E)*B,R=(1-(p+d))*B;return t[0]=L,t[1]=j,t[2]=H,t[3]=0,t[4]=V,t[5]=T,t[6]=A,t[7]=0,t[8]=b,t[9]=F,t[10]=R,t[11]=0,t[12]=r[0]+U-(L*U+V*k+b*D),t[13]=r[1]+k-(j*U+T*k+F*D),t[14]=r[2]+D-(H*U+A*k+R*D),t[15]=1,t}static fromQuat(t,e){const r=e[0],s=e[1],n=e[2],a=e[3],o=r+r,h=s+s,l=n+n,u=r*o,c=s*o,f=s*h,p=n*o,v=n*h,g=n*l,d=a*o,y=a*h,x=a*l;return t[0]=1-f-g,t[1]=c+x,t[2]=p-y,t[3]=0,t[4]=c-x,t[5]=1-u-g,t[6]=v+d,t[7]=0,t[8]=p+y,t[9]=v-d,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static frustumNO(t,e,r,s,n,a,o=1/0){const h=1/(r-e),l=1/(n-s);if(t[0]=a*2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*l,t[6]=0,t[7]=0,t[8]=(r+e)*h,t[9]=(n+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const u=1/(a-o);t[10]=(o+a)*u,t[14]=2*o*a*u}else t[10]=-1,t[14]=-2*a;return t}static frustum(t,e,r,s,n,a,o=1/0){return t}static frustumZO(t,e,r,s,n,a,o=1/0){const h=1/(r-e),l=1/(n-s);if(t[0]=a*2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*l,t[6]=0,t[7]=0,t[8]=(r+e)*h,t[9]=(n+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const u=1/(a-o);t[10]=o*u,t[14]=o*a*u}else t[10]=-1,t[14]=-a;return t}static perspectiveNO(t,e,r,s,n=1/0){const a=1/Math.tan(e/2);if(t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){const o=1/(s-n);t[10]=(n+s)*o,t[14]=2*n*s*o}else t[10]=-1,t[14]=-2*s;return t}static perspective(t,e,r,s,n=1/0){return t}static perspectiveZO(t,e,r,s,n=1/0){const a=1/Math.tan(e/2);if(t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){const o=1/(s-n);t[10]=n*o,t[14]=n*s*o}else t[10]=-1,t[14]=-s;return t}static perspectiveFromFieldOfView(t,e,r,s){const n=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),h=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+h),u=2/(n+a);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((o-h)*l*.5),t[9]=(n-a)*u*.5,t[10]=s/(r-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*r/(r-s),t[15]=0,t}static orthoNO(t,e,r,s,n,a,o){const h=1/(e-r),l=1/(s-n),u=1/(a-o);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*h,t[13]=(n+s)*l,t[14]=(o+a)*u,t[15]=1,t}static ortho(t,e,r,s,n,a,o){return t}static orthoZO(t,e,r,s,n,a,o){const h=1/(e-r),l=1/(s-n),u=1/(a-o);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+r)*h,t[13]=(n+s)*l,t[14]=a*u,t[15]=1,t}static lookAt(t,e,r,s){const n=e[0],a=e[1],o=e[2],h=s[0],l=s[1],u=s[2],c=r[0],f=r[1],p=r[2];if(Math.abs(n-c)<yt&&Math.abs(a-f)<yt&&Math.abs(o-p)<yt)return At.identity(t);let v=n-c,g=a-f,d=o-p,y=1/Math.sqrt(v*v+g*g+d*d);v*=y,g*=y,d*=y;let x=l*d-u*g,E=u*v-h*d,w=h*g-l*v;y=Math.sqrt(x*x+E*E+w*w),y?(y=1/y,x*=y,E*=y,w*=y):(x=0,E=0,w=0);let m=g*w-d*E,S=d*x-v*w,_=v*E-g*x;return y=Math.sqrt(m*m+S*S+_*_),y?(y=1/y,m*=y,S*=y,_*=y):(m=0,S=0,_=0),t[0]=x,t[1]=m,t[2]=v,t[3]=0,t[4]=E,t[5]=S,t[6]=g,t[7]=0,t[8]=w,t[9]=_,t[10]=d,t[11]=0,t[12]=-(x*n+E*a+w*o),t[13]=-(m*n+S*a+_*o),t[14]=-(v*n+g*a+d*o),t[15]=1,t}static targetTo(t,e,r,s){const n=e[0],a=e[1],o=e[2],h=s[0],l=s[1],u=s[2];let c=n-r[0],f=a-r[1],p=o-r[2],v=c*c+f*f+p*p;v>0&&(v=1/Math.sqrt(v),c*=v,f*=v,p*=v);let g=l*p-u*f,d=u*c-h*p,y=h*f-l*c;return v=g*g+d*d+y*y,v>0&&(v=1/Math.sqrt(v),g*=v,d*=v,y*=v),t[0]=g,t[1]=d,t[2]=y,t[3]=0,t[4]=f*y-p*d,t[5]=p*g-c*y,t[6]=c*d-f*g,t[7]=0,t[8]=c,t[9]=f,t[10]=p,t[11]=0,t[12]=n,t[13]=a,t[14]=o,t[15]=1,t}static frob(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+t[6]*t[6]+t[7]*t[7]+t[8]*t[8]+t[9]*t[9]+t[10]*t[10]+t[11]*t[11]+t[12]*t[12]+t[13]*t[13]+t[14]*t[14]+t[15]*t[15])}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}static sub(t,e,r){return t}static multiplyScalar(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}static multiplyScalarAndAdd(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t[4]=e[4]+r[4]*s,t[5]=e[5]+r[5]*s,t[6]=e[6]+r[6]*s,t[7]=e[7]+r[7]*s,t[8]=e[8]+r[8]*s,t[9]=e[9]+r[9]*s,t[10]=e[10]+r[10]*s,t[11]=e[11]+r[11]*s,t[12]=e[12]+r[12]*s,t[13]=e[13]+r[13]*s,t[14]=e[14]+r[14]*s,t[15]=e[15]+r[15]*s,t}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}static equals(t,e){const r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],c=t[8],f=t[9],p=t[10],v=t[11],g=t[12],d=t[13],y=t[14],x=t[15],E=e[0],w=e[1],m=e[2],S=e[3],_=e[4],B=e[5],U=e[6],k=e[7],D=e[8],L=e[9],j=e[10],H=e[11],V=e[12],T=e[13],A=e[14],b=e[15];return Math.abs(r-E)<=yt*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(s-w)<=yt*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(n-m)<=yt*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-S)<=yt*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(o-_)<=yt*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(h-B)<=yt*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(l-U)<=yt*Math.max(1,Math.abs(l),Math.abs(U))&&Math.abs(u-k)<=yt*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(c-D)<=yt*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(f-L)<=yt*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(p-j)<=yt*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(v-H)<=yt*Math.max(1,Math.abs(v),Math.abs(H))&&Math.abs(g-V)<=yt*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(d-T)<=yt*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(y-A)<=yt*Math.max(1,Math.abs(y),Math.abs(A))&&Math.abs(x-b)<=yt*Math.max(1,Math.abs(x),Math.abs(b))}static str(t){return`Mat4(${t.join(", ")})`}};I(Lh,"BYTE_LENGTH",16*Float32Array.BYTES_PER_ELEMENT);let ut=Lh;const zt=new Float32Array(3);ut.prototype.mul=ut.prototype.multiply;ut.sub=ut.subtract;ut.mul=ut.multiply;ut.frustum=ut.frustumNO;ut.perspective=ut.perspectiveNO;ut.ortho=ut.orthoNO;const Fh=class jt extends Float32Array{constructor(...t){switch(t.length){case 3:super(t);break;case 2:super(t[0],t[1],3);break;case 1:{const e=t[0];typeof e=="number"?super([e,e,e]):super(e,0,3);break}default:super(3);break}}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}get magnitude(){const t=this[0],e=this[1],r=this[2];return Math.sqrt(t*t+e*e+r*r)}get mag(){return this.magnitude}get squaredMagnitude(){const t=this[0],e=this[1],r=this[2];return t*t+e*e+r*r}get sqrMag(){return this.squaredMagnitude}get str(){return jt.str(this)}copy(t){return this.set(t),this}add(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}sub(t){return this}multiply(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this}mul(t){return this}divide(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this}div(t){return this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}scaleAndAdd(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this[2]+=t[2]*e,this}distance(t){return jt.distance(this,t)}dist(t){return 0}squaredDistance(t){return jt.squaredDistance(this,t)}sqrDist(t){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}normalize(){return jt.normalize(this,this)}static create(){return new jt}static clone(t){return new jt(t)}static magnitude(t){let e=t[0],r=t[1],s=t[2];return Math.sqrt(e*e+r*r+s*s)}static mag(t){return 0}static length(t){return 0}static len(t){return 0}static fromValues(t,e,r){return new jt(t,e,r)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}static set(t,e,r,s){return t[0]=e,t[1]=r,t[2]=s,t}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}static sub(t,e,r){return[0,0,0]}static multiply(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}static mul(t,e,r){return[0,0,0]}static divide(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}static div(t,e,r){return[0,0,0]}static ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}static floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}static min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}static max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}static scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}static scaleAndAdd(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t}static distance(t,e){const r=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+s*s+n*n)}static dist(t,e){return 0}static squaredDistance(t,e){const r=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2];return r*r+s*s+n*n}static sqrDist(t,e){return 0}static squaredLength(t){const e=t[0],r=t[1],s=t[2];return e*e+r*r+s*s}static sqrLen(t,e){return 0}static negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}static inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}static abs(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}static normalize(t,e){const r=e[0],s=e[1],n=e[2];let a=r*r+s*s+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}static dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}static cross(t,e,r){const s=e[0],n=e[1],a=e[2],o=r[0],h=r[1],l=r[2];return t[0]=n*l-a*h,t[1]=a*o-s*l,t[2]=s*h-n*o,t}static lerp(t,e,r,s){const n=e[0],a=e[1],o=e[2];return t[0]=n+s*(r[0]-n),t[1]=a+s*(r[1]-a),t[2]=o+s*(r[2]-o),t}static slerp(t,e,r,s){const n=Math.acos(Math.min(Math.max(jt.dot(e,r),-1),1)),a=Math.sin(n),o=Math.sin((1-s)*n)/a,h=Math.sin(s*n)/a;return t[0]=o*e[0]+h*r[0],t[1]=o*e[1]+h*r[1],t[2]=o*e[2]+h*r[2],t}static hermite(t,e,r,s,n,a){const o=a*a,h=o*(2*a-3)+1,l=o*(a-2)+a,u=o*(a-1),c=o*(3-2*a);return t[0]=e[0]*h+r[0]*l+s[0]*u+n[0]*c,t[1]=e[1]*h+r[1]*l+s[1]*u+n[1]*c,t[2]=e[2]*h+r[2]*l+s[2]*u+n[2]*c,t}static bezier(t,e,r,s,n,a){const o=1-a,h=o*o,l=a*a,u=h*o,c=3*a*h,f=3*l*o,p=l*a;return t[0]=e[0]*u+r[0]*c+s[0]*f+n[0]*p,t[1]=e[1]*u+r[1]*c+s[1]*f+n[1]*p,t[2]=e[2]*u+r[2]*c+s[2]*f+n[2]*p,t}static transformMat4(t,e,r){const s=e[0],n=e[1],a=e[2],o=r[3]*s+r[7]*n+r[11]*a+r[15]||1;return t[0]=(r[0]*s+r[4]*n+r[8]*a+r[12])/o,t[1]=(r[1]*s+r[5]*n+r[9]*a+r[13])/o,t[2]=(r[2]*s+r[6]*n+r[10]*a+r[14])/o,t}static transformMat3(t,e,r){let s=e[0],n=e[1],a=e[2];return t[0]=s*r[0]+n*r[3]+a*r[6],t[1]=s*r[1]+n*r[4]+a*r[7],t[2]=s*r[2]+n*r[5]+a*r[8],t}static transformQuat(t,e,r){const s=r[0],n=r[1],a=r[2],o=r[3]*2,h=e[0],l=e[1],u=e[2],c=n*u-a*l,f=a*h-s*u,p=s*l-n*h,v=(n*p-a*f)*2,g=(a*c-s*p)*2,d=(s*f-n*c)*2;return t[0]=h+c*o+v,t[1]=l+f*o+g,t[2]=u+p*o+d,t}static rotateX(t,e,r,s){const n=r[1],a=r[2],o=e[1]-n,h=e[2]-a;return t[0]=e[0],t[1]=o*Math.cos(s)-h*Math.sin(s)+n,t[2]=o*Math.sin(s)+h*Math.cos(s)+a,t}static rotateY(t,e,r,s){const n=r[0],a=r[2],o=e[0]-n,h=e[2]-a;return t[0]=h*Math.sin(s)+o*Math.cos(s)+n,t[1]=e[1],t[2]=h*Math.cos(s)-o*Math.sin(s)+a,t}static rotateZ(t,e,r,s){const n=r[0],a=r[1],o=e[0]-n,h=e[1]-a;return t[0]=o*Math.cos(s)-h*Math.sin(s)+n,t[1]=o*Math.sin(s)+h*Math.cos(s)+a,t[2]=r[2],t}static angle(t,e){const r=t[0],s=t[1],n=t[2],a=e[0],o=e[1],h=e[2],l=Math.sqrt((r*r+s*s+n*n)*(a*a+o*o+h*h)),u=l&&jt.dot(t,e)/l;return Math.acos(Math.min(Math.max(u,-1),1))}static zero(t){return t[0]=0,t[1]=0,t[2]=0,t}static str(t){return`Vec3(${t.join(", ")})`}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}static equals(t,e){const r=t[0],s=t[1],n=t[2],a=e[0],o=e[1],h=e[2];return Math.abs(r-a)<=yt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-o)<=yt*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(n-h)<=yt*Math.max(1,Math.abs(n),Math.abs(h))}};I(Fh,"BYTE_LENGTH",3*Float32Array.BYTES_PER_ELEMENT);let gt=Fh;gt.prototype.sub=gt.prototype.subtract;gt.prototype.mul=gt.prototype.multiply;gt.prototype.div=gt.prototype.divide;gt.prototype.dist=gt.prototype.distance;gt.prototype.sqrDist=gt.prototype.squaredDistance;gt.sub=gt.subtract;gt.mul=gt.multiply;gt.div=gt.divide;gt.dist=gt.distance;gt.sqrDist=gt.squaredDistance;gt.sqrLen=gt.squaredLength;gt.mag=gt.magnitude;gt.length=gt.magnitude;gt.len=gt.magnitude;const Ph=class ae extends Float32Array{constructor(...t){switch(t.length){case 4:super(t);break;case 2:super(t[0],t[1],4);break;case 1:{const e=t[0];typeof e=="number"?super([e,e,e,e]):super(e,0,4);break}default:super(4);break}}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}get a(){return this[3]}set a(t){this[3]=t}get magnitude(){const t=this[0],e=this[1],r=this[2],s=this[3];return Math.sqrt(t*t+e*e+r*r+s*s)}get mag(){return this.magnitude}get str(){return ae.str(this)}copy(t){return super.set(t),this}add(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this[3]+=t[3],this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this[3]-=t[3],this}sub(t){return this}multiply(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this[3]*=t[3],this}mul(t){return this}divide(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this[3]/=t[3],this}div(t){return this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this}scaleAndAdd(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this[2]+=t[2]*e,this[3]+=t[3]*e,this}distance(t){return ae.distance(this,t)}dist(t){return 0}squaredDistance(t){return ae.squaredDistance(this,t)}sqrDist(t){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this[3]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this[3]=1/this[3],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this[3]=Math.abs(this[3]),this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}normalize(){return ae.normalize(this,this)}static create(){return new ae}static clone(t){return new ae(t)}static fromValues(t,e,r,s){return new ae(t,e,r,s)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}static set(t,e,r,s,n){return t[0]=e,t[1]=r,t[2]=s,t[3]=n,t}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}static sub(t,e,r){return t}static multiply(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}static mul(t,e,r){return t}static divide(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}static div(t,e,r){return t}static ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}static floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}static min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}static max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}static round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}static scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}static scaleAndAdd(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t}static distance(t,e){const r=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.hypot(r,s,n,a)}static dist(t,e){return 0}static squaredDistance(t,e){const r=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return r*r+s*s+n*n+a*a}static sqrDist(t,e){return 0}static magnitude(t){const e=t[0],r=t[1],s=t[2],n=t[3];return Math.sqrt(e*e+r*r+s*s+n*n)}static mag(t){return 0}static length(t){return 0}static len(t){return 0}static squaredLength(t){const e=t[0],r=t[1],s=t[2],n=t[3];return e*e+r*r+s*s+n*n}static sqrLen(t){return 0}static negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}static inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}static abs(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t}static normalize(t,e){const r=e[0],s=e[1],n=e[2],a=e[3];let o=r*r+s*s+n*n+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=s*o,t[2]=n*o,t[3]=a*o,t}static dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}static cross(t,e,r,s){const n=r[0]*s[1]-r[1]*s[0],a=r[0]*s[2]-r[2]*s[0],o=r[0]*s[3]-r[3]*s[0],h=r[1]*s[2]-r[2]*s[1],l=r[1]*s[3]-r[3]*s[1],u=r[2]*s[3]-r[3]*s[2],c=e[0],f=e[1],p=e[2],v=e[3];return t[0]=f*u-p*l+v*h,t[1]=-(c*u)+p*o-v*a,t[2]=c*l-f*o+v*n,t[3]=-(c*h)+f*a-p*n,t}static lerp(t,e,r,s){const n=e[0],a=e[1],o=e[2],h=e[3];return t[0]=n+s*(r[0]-n),t[1]=a+s*(r[1]-a),t[2]=o+s*(r[2]-o),t[3]=h+s*(r[3]-h),t}static transformMat4(t,e,r){const s=e[0],n=e[1],a=e[2],o=e[3];return t[0]=r[0]*s+r[4]*n+r[8]*a+r[12]*o,t[1]=r[1]*s+r[5]*n+r[9]*a+r[13]*o,t[2]=r[2]*s+r[6]*n+r[10]*a+r[14]*o,t[3]=r[3]*s+r[7]*n+r[11]*a+r[15]*o,t}static transformQuat(t,e,r){const s=e[0],n=e[1],a=e[2],o=r[0],h=r[1],l=r[2],u=r[3],c=u*s+h*a-l*n,f=u*n+l*s-o*a,p=u*a+o*n-h*s,v=-o*s-h*n-l*a;return t[0]=c*u+v*-o+f*-l-p*-h,t[1]=f*u+v*-h+p*-o-c*-l,t[2]=p*u+v*-l+c*-h-f*-o,t[3]=e[3],t}static zero(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}static str(t){return`Vec4(${t.join(", ")})`}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}static equals(t,e){const r=t[0],s=t[1],n=t[2],a=t[3],o=e[0],h=e[1],l=e[2],u=e[3];return Math.abs(r-o)<=yt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-h)<=yt*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-l)<=yt*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-u)<=yt*Math.max(1,Math.abs(a),Math.abs(u))}};I(Ph,"BYTE_LENGTH",4*Float32Array.BYTES_PER_ELEMENT);let nt=Ph;nt.prototype.sub=nt.prototype.subtract;nt.prototype.mul=nt.prototype.multiply;nt.prototype.div=nt.prototype.divide;nt.prototype.dist=nt.prototype.distance;nt.prototype.sqrDist=nt.prototype.squaredDistance;nt.sub=nt.subtract;nt.mul=nt.multiply;nt.div=nt.divide;nt.dist=nt.distance;nt.sqrDist=nt.squaredDistance;nt.sqrLen=nt.squaredLength;nt.mag=nt.magnitude;nt.length=nt.magnitude;nt.len=nt.magnitude;const Nh=class oe extends Float32Array{constructor(...t){switch(t.length){case 2:{const e=t[0];typeof e=="number"?super([e,t[1]]):super(e,t[1],2);break}case 1:{const e=t[0];typeof e=="number"?super([e,e]):super(e,0,2);break}default:super(2);break}}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get magnitude(){return Math.hypot(this[0],this[1])}get mag(){return this.magnitude}get squaredMagnitude(){const t=this[0],e=this[1];return t*t+e*e}get sqrMag(){return this.squaredMagnitude}get str(){return oe.str(this)}copy(t){return this.set(t),this}add(t){return this[0]+=t[0],this[1]+=t[1],this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this}sub(t){return this}multiply(t){return this[0]*=t[0],this[1]*=t[1],this}mul(t){return this}divide(t){return this[0]/=t[0],this[1]/=t[1],this}div(t){return this}scale(t){return this[0]*=t,this[1]*=t,this}scaleAndAdd(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this}distance(t){return oe.distance(this,t)}dist(t){return 0}squaredDistance(t){return oe.squaredDistance(this,t)}sqrDist(t){return 0}negate(){return this[0]*=-1,this[1]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this}dot(t){return this[0]*t[0]+this[1]*t[1]}normalize(){return oe.normalize(this,this)}static create(){return new oe}static clone(t){return new oe(t)}static fromValues(t,e){return new oe(t,e)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t}static set(t,e,r){return t[0]=e,t[1]=r,t}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}static sub(t,e,r){return[0,0]}static multiply(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}static mul(t,e,r){return[0,0]}static divide(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}static div(t,e,r){return[0,0]}static ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}static floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}static min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}static max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}static round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}static scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}static scaleAndAdd(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t}static distance(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}static dist(t,e){return 0}static squaredDistance(t,e){const r=e[0]-t[0],s=e[1]-t[1];return r*r+s*s}static sqrDist(t,e){return 0}static magnitude(t){let e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}static mag(t){return 0}static length(t){return 0}static len(t){return 0}static squaredLength(t){const e=t[0],r=t[1];return e*e+r*r}static sqrLen(t,e){return 0}static negate(t,e){return t[0]=-e[0],t[1]=-e[1],t}static inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}static abs(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t}static normalize(t,e){const r=e[0],s=e[1];let n=r*r+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}static dot(t,e){return t[0]*e[0]+t[1]*e[1]}static cross(t,e,r){const s=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=s,t}static lerp(t,e,r,s){const n=e[0],a=e[1];return t[0]=n+s*(r[0]-n),t[1]=a+s*(r[1]-a),t}static transformMat2(t,e,r){const s=e[0],n=e[1];return t[0]=r[0]*s+r[2]*n,t[1]=r[1]*s+r[3]*n,t}static transformMat2d(t,e,r){const s=e[0],n=e[1];return t[0]=r[0]*s+r[2]*n+r[4],t[1]=r[1]*s+r[3]*n+r[5],t}static transformMat3(t,e,r){const s=e[0],n=e[1];return t[0]=r[0]*s+r[3]*n+r[6],t[1]=r[1]*s+r[4]*n+r[7],t}static transformMat4(t,e,r){const s=e[0],n=e[1];return t[0]=r[0]*s+r[4]*n+r[12],t[1]=r[1]*s+r[5]*n+r[13],t}static rotate(t,e,r,s){const n=e[0]-r[0],a=e[1]-r[1],o=Math.sin(s),h=Math.cos(s);return t[0]=n*h-a*o+r[0],t[1]=n*o+a*h+r[1],t}static angle(t,e){const r=t[0],s=t[1],n=e[0],a=e[1],o=Math.sqrt(r*r+s*s)*Math.sqrt(n*n+a*a),h=o&&(r*n+s*a)/o;return Math.acos(Math.min(Math.max(h,-1),1))}static zero(t){return t[0]=0,t[1]=0,t}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]}static equals(t,e){const r=t[0],s=t[1],n=e[0],a=e[1];return Math.abs(r-n)<=yt*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(s-a)<=yt*Math.max(1,Math.abs(s),Math.abs(a))}static str(t){return`Vec2(${t.join(", ")})`}};I(Nh,"BYTE_LENGTH",2*Float32Array.BYTES_PER_ELEMENT);let ct=Nh;ct.prototype.sub=ct.prototype.subtract;ct.prototype.mul=ct.prototype.multiply;ct.prototype.div=ct.prototype.divide;ct.prototype.dist=ct.prototype.distance;ct.prototype.sqrDist=ct.prototype.squaredDistance;ct.sub=ct.subtract;ct.mul=ct.multiply;ct.div=ct.divide;ct.dist=ct.distance;ct.sqrDist=ct.squaredDistance;ct.sqrLen=ct.squaredLength;ct.mag=ct.magnitude;ct.length=ct.magnitude;ct.len=ct.magnitude;function Wc(i){return new Promise((t,e)=>{const r=document.createElement("img");r.onload=()=>t(r),r.onerror=e,r.src=i,r.crossOrigin="anonymous",r.loading="eager"})}function Yc(i){return new Promise((t,e)=>{const r=document.createElement("video");let s=!1,n=!1,a=!1;r.addEventListener("playing",()=>{s=!0,o()},!0),r.addEventListener("timeupdate",()=>{n=!0,o()},!0),r.addEventListener("error",h=>{a=!0,e(h)},!0);function o(){s&&n&&!a&&t(r)}r.src=i,r.playsInline=!0,r.crossOrigin="anonymous",r.autoplay=!0,r.loop=!0,r.muted=!0,r.play()})}function Zc(i,t=!1){return t?Yc(i):Wc(i)}function Kc(i){return new Promise((t,e)=>{(i instanceof HTMLImageElement?i.complete:i.readyState>=3)?t(i):(i.onload=()=>t(i),i.onerror=e)})}function Jc(i,t,e){const r=i.data,s=i.width,n=i.height;let a,o,h,l,u,c,f,p,v,g,d,y,x;const E=s-1,w=n-1,m=t+1,S=t+m,_=t+1,B=t+_,U=1/(S*B),k=[],D=[],L=[],j=[],H=[],V=[];for(;e-- >0;){for(x=y=0,c=0;c<n;c++){for(a=r[x]*m,o=r[x+1]*m,h=r[x+2]*m,l=r[x+3]*m,f=1;f<=t;f++)p=x+((f>E?E:f)<<2),a+=r[p++],o+=r[p++],h+=r[p++],l+=r[p];for(u=0;u<s;u++)k[y]=a,D[y]=o,L[y]=h,j[y]=l,c===0&&(H[u]=Math.min(u+m,E)<<2,V[u]=Math.max(u-t,0)<<2),v=x+H[u],g=x+V[u],a+=r[v++]-r[g++],o+=r[v++]-r[g++],h+=r[v++]-r[g++],l+=r[v]-r[g],y++;x+=s<<2}for(u=0;u<s;u++){for(d=u,a=k[d]*_,o=D[d]*_,h=L[d]*_,l=j[d]*_,f=1;f<=t;f++)d+=f>w?0:s,a+=k[d],o+=D[d],h+=L[d],l+=j[d];for(y=u<<2,c=0;c<n;c++)r[y]=a*U+.5|0,r[y+1]=o*U+.5|0,r[y+2]=h*U+.5|0,r[y+3]=l*U+.5|0,u===0&&(H[c]=Math.min(c+_,w)*s,V[c]=Math.max(c-t,0)*s),v=u+H[c],g=u+V[c],a+=k[v]-k[g],o+=D[v]-D[g],h+=L[v]-L[g],l+=j[v]-j[g],y+=s<<2}}}function Qc(i,t){const e=i.data;for(let r=0;r<e.length;r+=4){const s=e[r],n=e[r+1],a=e[r+2],o=e[r+3],h=s*.3+n*.59+a*.11;e[r]=h*(1-t)+s*t,e[r+1]=h*(1-t)+n*t,e[r+2]=h*(1-t)+a*t,e[r+3]=o}}function td(i,t){const e=i.data;for(let r=0;r<e.length;r+=4){const s=e[r],n=e[r+1],a=e[r+2],o=e[r+3];e[r]=s*t,e[r+1]=n*t,e[r+2]=a*t,e[r+3]=o}}function po(i,t){const e=i.data;for(let r=0;r<e.length;r+=4){const s=e[r],n=e[r+1],a=e[r+2],o=e[r+3];e[r]=(s-128)*t+128,e[r+1]=(n-128)*t+128,e[r+2]=(a-128)*t+128,e[r+3]=o}}const $=(i,t,e,r,s=0,n=0,a=1,o=1)=>Object.freeze({cx:i,cy:t,x:e,y:r,ur:s,vr:n,up:a,vp:o}),mr=(i,t,e)=>Object.freeze({width:i,height:t,conf:e}),mo=[mr(5,5,[$(0,0,-1,-1,0,0,1,1),$(1,0,-.5,-1,0,0,1,1),$(2,0,0,-1,0,0,1,1),$(3,0,.5,-1,0,0,1,1),$(4,0,1,-1,0,0,1,1),$(0,1,-1,-.5,0,0,1,1),$(1,1,-.5,-.5,0,0,1,1),$(2,1,-.0052029684413368305,-.6131420587090777,0,0,1,1),$(3,1,.5884227308309977,-.3990805107556692,0,0,1,1),$(4,1,1,-.5,0,0,1,1),$(0,2,-1,0,0,0,1,1),$(1,2,-.4210024670505933,-.11895058380429502,0,0,1,1),$(2,2,-.1019613423315412,-.023812118047224606,0,-47,.629,.849),$(3,2,.40275125660925437,-.06345314544600389,0,0,1,1),$(4,2,1,0,0,0,1,1),$(0,3,-1,.5,0,0,1,1),$(1,3,.06801958477287173,.5205913248960121,-31,-45,1,1),$(2,3,.21446469120128908,.29331610114301043,6,-56,.566,1.321),$(3,3,.5,.5,0,0,1,1),$(4,3,1,.5,0,0,1,1),$(0,4,-1,1,0,0,1,1),$(1,4,-.31378372841550195,1,0,0,1,1),$(2,4,.26153633255328046,1,0,0,1,1),$(3,4,.5,1,0,0,1,1),$(4,4,1,1,0,0,1,1)]),mr(4,4,[$(0,0,-1,-1,0,0,1,1),$(1,0,-.33333333333333337,-1,0,0,1,1),$(2,0,.33333333333333326,-1,0,0,1,1),$(3,0,1,-1,0,0,1,1),$(0,1,-1,-.04495399932657351,0,0,1,1),$(1,1,-.24056117520129328,-.22465999020104,0,0,1,1),$(2,1,.334758885767489,-.00531297192779423,0,0,1,1),$(3,1,.9989920470678106,-.3382976020775408,8,0,.566,1.792),$(0,2,-1,.33333333333333326,0,0,1,1),$(1,2,-.3425497314639411,-27501607956947893e-21,0,0,1,1),$(2,2,.3321437945812673,.1981776353859399,0,0,1,1),$(3,2,1,.0766118180296832,0,0,1,1),$(0,3,-1,1,0,0,1,1),$(1,3,-.33333333333333337,1,0,0,1,1),$(2,3,.33333333333333326,1,0,0,1,1),$(3,3,1,1,0,0,1,1)]),mr(4,4,[$(0,0,-1,-1,0,0,1,2.075),$(1,0,-.33333333333333337,-1,0,0,1,1),$(2,0,.33333333333333326,-1,0,0,1,1),$(3,0,1,-1,0,0,1,1),$(0,1,-1,-.4545779491139603,0,0,1,1),$(1,1,-.33333333333333337,-.33333333333333337,0,0,1,1),$(2,1,.0889403142626457,-.6025711180694033,-32,45,1,1),$(3,1,1,-.33333333333333337,0,0,1,1),$(0,2,-1,-.07402408608567845,1,0,1,.094),$(1,2,-.2719422694359541,.09775369930903222,25,-18,1.321,0),$(2,2,.19877414408395877,.4307383294587789,48,-40,.755,.975),$(3,2,1,.33333333333333326,-37,0,1,1),$(0,3,-1,1,0,0,1,1),$(1,3,-.33333333333333337,1,0,0,1,1),$(2,3,.5125850864305672,1,-20,-18,0,1.604),$(3,3,1,1,0,0,1,1)]),mr(5,5,[$(0,0,-1,-1,0,0,1,1),$(1,0,-.4501953125,-1,0,55,1,2.075),$(2,0,.1953125,-1,0,0,1,1),$(3,0,.4580078125,-1,0,-25,1,1),$(4,0,1,-1,0,0,1,1),$(0,1,-1,-.2514475377525607,-16,0,2.327,.943),$(1,1,-.55859375,-.6609325945787148,47,0,2.358,.377),$(2,1,.232421875,-.5244375756366635,-66,-25,1.855,1.164),$(3,1,.685546875,-.3753706470552125,0,0,1,1),$(4,1,1,-.6699125300354287,0,0,1,1),$(0,2,-1,.035910396862284255,0,0,1,1),$(1,2,-.4921875,.005378616309457018,90,23,1,1.981),$(2,2,.021484375,-.1365043639066228,0,42,1,1),$(3,2,.4765625,.05925822904974043,-30,0,1.95,.44),$(4,2,1,.251428847823418,0,0,1,1),$(0,3,-1,.6968336464764276,-68,0,1,.786),$(1,3,-.6904296875,.5890744209958608,-68,0,1,1),$(2,3,.1845703125,.3879238667654693,61,0,1,1),$(3,3,.60546875,.4633553246018661,-47,-59,.849,1.73),$(4,3,1,.6214021886400309,-33,0,.377,1.604),$(0,4,-1,1,0,0,1,1),$(1,4,-.5,1,0,-73,1,1),$(2,4,-.3271484375,1,0,-24,.314,2.704),$(3,4,.5,1,0,0,1,1),$(4,4,1,1,0,0,1,1)])],$t=(i,t)=>Math.random()*(t-i)+i;function ed(i,t,e){return Math.min(Math.max(i,t),e)}function rd(i,t,e){const r=ed((e-i)/(t-i),0,1);return r*r*(3-2*r)}function sd(i,t,e,r=2,s=.5,n=.1){let a=[],o=s;for(let u=0;u<e;u++){a[u]=[];for(let c=0;c<t;c++)a[u][c]=i[u*t+c]}const h=[[1,2,1],[2,4,2],[1,2,1]],l=16;for(let u=0;u<r;u++){const c=[];for(let f=0;f<e;f++){c[f]=[];for(let p=0;p<t;p++){if(p===0||p===t-1||f===0||f===e-1){c[f][p]=a[f][p];continue}let v=0,g=0,d=0,y=0,x=0,E=0;for(let A=-1;A<=1;A++)for(let b=-1;b<=1;b++){const F=h[A+1][b+1],R=a[f+A][p+b];v+=R.x*F,g+=R.y*F,d+=R.ur*F,y+=R.vr*F,x+=R.up*F,E+=R.vp*F}const w=v/l,m=g/l,S=d/l,_=y/l,B=x/l,U=E/l,k=a[f][p],D=k.x*(1-o)+w*o,L=k.y*(1-o)+m*o,j=k.ur*(1-o)+S*o,H=k.vr*(1-o)+_*o,V=k.up*(1-o)+B*o,T=k.vp*(1-o)+U*o;c[f][p]=$(p,f,D,L,j,H,V,T)}}a=c,o=Math.min(1,Math.max(o+n,0))}for(let u=0;u<e;u++)for(let c=0;c<t;c++)i[u*t+c]=a[u][c]}function Ur(i,t){return id(Math.sin(i*12.9898+t*78.233)*43758.5453)}function id(i){return i-Math.floor(i)}function nd(i,t){const e=Math.floor(i),r=Math.floor(t),s=e+1,n=r+1,a=i-e,o=t-r,h=a*a*(3-2*a),l=o*o*(3-2*o),u=Ur(e,r),c=Ur(s,r),f=Ur(e,n),p=Ur(s,n),v=u*(1-h)+c*h,g=f*(1-h)+p*h;return v*(1-l)+g*l}function ad(i,t,e,r=.001){const s=i(t+r,e),n=i(t-r,e),a=i(t,e+r),o=i(t,e-r),h=(s-n)/(2*r),l=(a-o)/(2*r),u=Math.sqrt(h*h+l*l)||1;return[h/u,l/u]}function od(i,t,e=$t(.4,.6),r=$t(.3,.6),s=.8,n=Math.floor($t(3,5)),a=$t(.2,.3),o=$t(-.1,-.05)){const h=i,l=t,u=[],c=2/(h-1),f=2/(l-1);for(let p=0;p<l;p++)for(let v=0;v<h;v++){const g=v/(h-1)*2-1,d=p/(l-1)*2-1,y=v===0||v===h-1||p===0||p===l-1,x=y?0:$t(-e*c,e*c),E=y?0:$t(-e*f,e*f);let w=g+x,m=d+E;const S=y?0:$t(-60,60),_=y?0:$t(-60,60),B=y?1:$t(.8,1.2),U=y?1:$t(.8,1.2);if(!y){const k=(g+1)/2,D=(d+1)/2,[L,j]=ad(nd,k,D,.001);let H=L*r,V=j*r;const T=Math.min(k,1-k,D,1-D),A=rd(0,1,T);H*=A,V*=A,w=w*(1-s)+(w+H)*s,m=m*(1-s)+(m+V)*s}u.push($(v,p,w,m,S,_,B,U))}return sd(u,h,l,n,a,o),mr(h,l,u)}const hd=`precision highp float;\r
\r
varying vec3 v_color;\r
varying vec2 v_uv;\r
uniform sampler2D u_texture;\r
uniform float u_time;\r
uniform float u_volume;\r
uniform float u_alpha;\r
\r
/* Gradient noise from Jorge Jimenez's presentation: */\r
/* http://www.iryoku.com/next-generation-post-processing-in-call-of-duty-advanced-warfare */\r
float gradientNoise(in vec2 uv) {\r
    return fract(52.9829189 * fract(dot(uv, vec2(0.06711056, 0.00583715))));\r
}\r
\r
vec2 rot(vec2 v, float a) {\r
    float s = sin(a);\r
    float c = cos(a);\r
    mat2 m = mat2(c, s, -s, c);\r
    return m * v;\r
}\r
\r
void main() {\r
    float dither = (1.0 / 255.0) * gradientNoise(gl_FragCoord.xy) - (0.5 / 255.0);\r
    vec2 centeredUV = v_uv - vec2(0.2);\r
    vec2 rotatedUV = rot(centeredUV, (u_time + u_volume) * 2.0);\r
    vec2 finalUV = rotatedUV * max(0.001, 1.0 - u_volume * 2.0) + vec2(0.5);\r
    vec4 result = texture2D(u_texture, finalUV);\r
    result *= vec4(v_color, u_alpha);\r
    result *= vec4(max(0.5, 1.0 - u_volume / 2.0));\r
    result += vec4(dither);\r
    gl_FragColor = result;\r
}`,ld=`precision highp float;\r
\r
attribute vec2 a_pos;\r
attribute vec3 a_color;\r
attribute vec2 a_uv;\r
varying vec3 v_color;\r
varying vec2 v_uv;\r
\r
uniform float u_aspect;\r
\r
void main() {\r
    v_color = a_color;\r
    v_uv = a_uv;\r
    vec2 pos = a_pos;\r
    if (u_aspect > 1.0) {\r
        pos.y *= u_aspect;\r
    } else {\r
        pos.x /= u_aspect;\r
    }\r
    gl_Position = vec4(pos, 0.0, 1.0);\r
}\r
`;class ud{constructor(t,e,r,s="unknown"){I(this,"gl"),I(this,"program"),I(this,"vertexShader"),I(this,"fragmentShader"),I(this,"attrs"),I(this,"notFoundUniforms",new Set),this.label=s,this.gl=t,this.vertexShader=this.createShader(t.VERTEX_SHADER,e),this.fragmentShader=this.createShader(t.FRAGMENT_SHADER,r),this.program=this.createProgram();const n=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),a={};for(let o=0;o<n;o++){const h=t.getActiveAttrib(this.program,o);if(!h)continue;const l=t.getAttribLocation(this.program,h.name);l!==-1&&(a[h.name]=l)}this.attrs=a}createShader(t,e){const r=this.gl,s=r.createShader(t);if(!s)throw new Error("Failed to create shader");if(r.shaderSource(s,e),r.compileShader(s),!r.getShaderParameter(s,r.COMPILE_STATUS))throw new Error(`Failed to compile shader for type ${t} "${this.label}": ${r.getShaderInfoLog(s)}`);return s}createProgram(){const t=this.gl,e=t.createProgram();if(!e)throw new Error("Failed to create program");if(t.attachShader(e,this.vertexShader),t.attachShader(e,this.fragmentShader),t.linkProgram(e),t.validateProgram(e),!t.getProgramParameter(e,t.LINK_STATUS)){const r=t.getProgramInfoLog(e);throw t.deleteProgram(e),new Error(`Failed to link program "${this.label}": ${r}`)}return e}use(){this.gl.useProgram(this.program)}warnUniformNotFound(t){this.notFoundUniforms.has(t)||(this.notFoundUniforms.add(t),console.warn(`Failed to get uniform location for program "${this.label}": ${t}`))}setUniform1f(t,e){const r=this.gl,s=r.getUniformLocation(this.program,t);s?r.uniform1f(s,e):this.warnUniformNotFound(t)}setUniform2f(t,e,r){const s=this.gl,n=s.getUniformLocation(this.program,t);n?s.uniform2f(n,e,r):this.warnUniformNotFound(t)}setUniform1i(t,e){const r=this.gl,s=r.getUniformLocation(this.program,t);s?r.uniform1i(s,e):this.warnUniformNotFound(t)}dispose(){const t=this.gl;t.deleteShader(this.vertexShader),t.deleteShader(this.fragmentShader),t.deleteProgram(this.program)}}class cd{constructor(t,e,r,s){I(this,"vertexWidth",0),I(this,"vertexHeight",0),I(this,"vertexBuffer"),I(this,"indexBuffer"),I(this,"vertexData"),I(this,"indexData"),I(this,"vertexIndexLength",0),I(this,"wireFrame",!1),this.gl=t,this.attrPos=e,this.attrColor=r,this.attrUV=s;const n=t.createBuffer();if(!n)throw new Error("Failed to create vertex buffer");this.vertexBuffer=n;const a=t.createBuffer();if(!a)throw new Error("Failed to create index buffer");this.indexBuffer=a,this.bind(),this.vertexData=new Float32Array(0),this.indexData=new Uint16Array(0),this.resize(2,2),this.update()}setWireFrame(t){this.wireFrame=t,this.resize(this.vertexWidth,this.vertexHeight)}setVertexPos(t,e,r,s){const n=(t+e*this.vertexWidth)*7;if(n>=this.vertexData.length-1){console.warn("Vertex position out of range",n,this.vertexData.length);return}this.vertexData[n]=r,this.vertexData[n+1]=s}setVertexColor(t,e,r,s,n){const a=(t+e*this.vertexWidth)*7+2;if(a>=this.vertexData.length-1){console.warn("Vertex position out of range",a,this.vertexData.length);return}this.vertexData[a]=r,this.vertexData[a+1]=s,this.vertexData[a+2]=n}setVertexUV(t,e,r,s){const n=(t+e*this.vertexWidth)*7+2+3;if(n>=this.vertexData.length-1){console.warn("Vertex position out of range",n,this.vertexData.length);return}this.vertexData[n]=r,this.vertexData[n+1]=s}getVertexIndexLength(){return this.vertexIndexLength}draw(){const t=this.gl;this.wireFrame?t.drawElements(t.LINES,this.vertexIndexLength,t.UNSIGNED_SHORT,0):t.drawElements(t.TRIANGLES,this.vertexIndexLength,t.UNSIGNED_SHORT,0)}resize(t,e){this.vertexWidth=t,this.vertexHeight=e,this.vertexIndexLength=t*e*6,this.wireFrame&&(this.vertexIndexLength=t*e*10);const r=new Float32Array(t*e*7),s=new Uint16Array(this.vertexIndexLength);this.vertexData=r,this.indexData=s;for(let a=0;a<e;a++)for(let o=0;o<t;o++){const h=o/(t-1)*2-1,l=a/(e-1)*2-1;this.setVertexPos(o,a,h||0,l||0),this.setVertexColor(o,a,1,1,1),this.setVertexUV(o,a,o/(t-1),a/(e-1))}for(let a=0;a<e-1;a++)for(let o=0;o<t-1;o++)if(this.wireFrame){const h=(a*t+o)*10;s[h]=a*t+o,s[h+1]=a*t+o+1,s[h+2]=a*t+o+1,s[h+3]=(a+1)*t+o,s[h+4]=(a+1)*t+o,s[h+5]=(a+1)*t+o+1,s[h+6]=(a+1)*t+o+1,s[h+7]=a*t+o+1,s[h+8]=a*t+o,s[h+9]=(a+1)*t+o}else{const h=(a*t+o)*6;s[h]=a*t+o,s[h+1]=a*t+o+1,s[h+2]=(a+1)*t+o,s[h+3]=a*t+o+1,s[h+4]=(a+1)*t+o+1,s[h+5]=(a+1)*t+o}const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indexData,n.STATIC_DRAW)}bind(){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.attrPos!==void 0&&(t.vertexAttribPointer(this.attrPos,2,t.FLOAT,!1,4*7,0),t.enableVertexAttribArray(this.attrPos)),this.attrColor!==void 0&&(t.vertexAttribPointer(this.attrColor,3,t.FLOAT,!1,4*7,4*2),t.enableVertexAttribArray(this.attrColor)),this.attrUV!==void 0&&(t.vertexAttribPointer(this.attrUV,2,t.FLOAT,!1,4*7,4*5),t.enableVertexAttribArray(this.attrUV))}update(){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexData,t.DYNAMIC_DRAW)}dispose(){this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer)}}class dd{constructor(){I(this,"color",gt.fromValues(1,1,1)),I(this,"location",ct.fromValues(0,0)),I(this,"uTangent",ct.fromValues(0,0)),I(this,"vTangent",ct.fromValues(0,0)),I(this,"_uRot",0),I(this,"_vRot",0),I(this,"_uScale",1),I(this,"_vScale",1),Object.seal(this)}get uRot(){return this._uRot}get vRot(){return this._vRot}set uRot(t){this._uRot=t,this.updateUTangent()}set vRot(t){this._vRot=t,this.updateVTangent()}get uScale(){return this._uScale}get vScale(){return this._vScale}set uScale(t){this._uScale=t,this.updateUTangent()}set vScale(t){this._vScale=t,this.updateVTangent()}updateUTangent(){this.uTangent[0]=Math.cos(this._uRot)*this._uScale,this.uTangent[1]=Math.sin(this._uRot)*this._uScale}updateVTangent(){this.vTangent[0]=-Math.sin(this._vRot)*this._vScale,this.vTangent[1]=Math.cos(this._vRot)*this._vScale}}const Je=ut.fromValues(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0),gr=ut.clone(Je).transpose(),ne=nt.create(),Dr=nt.create(),Oe=nt.create(),Be=ut.create(),ke=ut.create();function fd(i,t,e,r,s=ct.create()){ne[0]=i**3,ne[1]=i**2,ne[2]=i,ne[3]=1,Dr.copy(ne),Oe[0]=t**3,Oe[1]=t**2,Oe[2]=t,Oe[3]=1,Be.copy(e).transpose(),ut.mul(Be,Be,Je),ut.mul(Be,gr,Be),nt.transformMat4(ne,ne,Be);const n=Oe.dot(ne);ke.copy(r).transpose(),ut.mul(ke,ke,Je),ut.mul(ke,gr,ke),nt.transformMat4(Dr,Dr,ke);const a=Oe.dot(Dr);return s.x=n,s.y=a,s}function yo(i,t,e,r,s,n=ut.create()){const a=l=>l.location[s],o=l=>l.uTangent[s],h=l=>l.vTangent[s];return n[0]=a(i),n[1]=a(t),n[2]=h(i),n[3]=h(t),n[4]=a(e),n[5]=a(r),n[6]=h(e),n[7]=h(r),n[8]=o(i),n[9]=o(t),n[10]=0,n[11]=0,n[12]=o(e),n[13]=o(r),n[14]=0,n[15]=0,n}function Bi(i,t,e,r,s,n=ut.create()){const a=o=>o.color[s];return n.fill(0),n[0]=a(i),n[1]=a(t),n[4]=a(e),n[5]=a(r),n}const Jt=nt.create(),Gr=nt.create(),zr=nt.create(),pe=nt.create(),Ue=ut.create(),De=ut.create(),Ge=ut.create(),$r=gt.create();function pd(i,t,e,r,s){return Jt[0]=i**3,Jt[1]=i**2,Jt[2]=i,Jt[3]=1,Gr.copy(Jt),zr.copy(Jt),pe[0]=t**3,pe[1]=t**2,pe[2]=t,pe[3]=1,Ue.copy(e).transpose(),ut.mul(Ue,Ue,Je),ut.mul(Ue,gr,Ue),nt.transformMat4(Jt,Jt,Ue),$r.r=pe.dot(Jt),De.copy(r).transpose(),ut.mul(De,De,Je),ut.mul(De,gr,De),nt.transformMat4(Gr,Gr,De),$r.g=pe.dot(Gr),Ge.copy(s).transpose(),ut.mul(Ge,Ge,Je),ut.mul(Ge,gr,Ge),nt.transformMat4(zr,zr,Ge),$r.b=pe.dot(zr),$r}class md{constructor(t,e){I(this,"_width",0),I(this,"_height",0),I(this,"_data",[]),this.resize(t,e),Object.seal(this)}resize(t,e){this._width=t,this._height=e,this._data=new Array(t*e).fill(0)}set(t,e,r){this._data[t+e*this._width]=r}get(t,e){return this._data[t+e*this._width]}get width(){return this._width}get height(){return this._height}}class yd extends cd{constructor(t,e,r,s){super(t,e,r,s),I(this,"_subDivisions",10),I(this,"_controlPoints",new md(3,3)),I(this,"uMX",ut.create()),I(this,"uMY",ut.create()),I(this,"uMR",ut.create()),I(this,"uMG",ut.create()),I(this,"uMB",ut.create()),I(this,"tmpV2",ct.create()),this.resizeControlPoints(3,3),Object.seal(this)}setWireFrame(t){super.setWireFrame(t),this.updateMesh()}resetSubdivition(t){this._subDivisions=t,super.resize((this._controlPoints.width-1)*t,(this._controlPoints.height-1)*t)}resizeControlPoints(t,e){if(!(t>=2&&e>=2))throw new Error("Control points must be larger than 3x3 or equal");this._controlPoints.resize(t,e);for(let r=0;r<e;r++)for(let s=0;s<t;s++){const n=new dd;n.location.x=s/(t-1)*2-1,n.location.y=r/(e-1)*2-1,n.uTangent.x=2/(t-1),n.vTangent.y=2/(e-1),this._controlPoints.set(s,r,n)}this.resetSubdivition(this._subDivisions)}getControlPoint(t,e){return this._controlPoints.get(t,e)}updateMesh(){const t=this._subDivisions-1,e=t*(this._controlPoints.height-1),r=t*(this._controlPoints.width-1);for(let s=0;s<this._controlPoints.width-1;s++)for(let n=0;n<this._controlPoints.height-1;n++){const a=this._controlPoints.get(s,n),o=this._controlPoints.get(s,n+1),h=this._controlPoints.get(s+1,n),l=this._controlPoints.get(s+1,n+1),u=yo(a,o,h,l,"x",this.uMX),c=yo(a,o,h,l,"y",this.uMY),f=Bi(a,o,h,l,"r",this.uMR),p=Bi(a,o,h,l,"g",this.uMG),v=Bi(a,o,h,l,"b",this.uMB),g=s/(this._controlPoints.width-1),d=n/(this._controlPoints.height-1);for(let y=0;y<this._subDivisions;y++)for(let x=0;x<this._subDivisions;x++){const E=n*this._subDivisions+y,w=s*this._subDivisions+x,[m,S]=fd(y/t,x/t,u,c,this.tmpV2);this.setVertexPos(E,w,m,S),this.setVertexUV(E,w,g+x/r,1-d-y/e);const[_,B,U]=pd(y/t,x/t,f,p,v);this.setVertexColor(E,w,_,B,U)}}this.update()}}class go{constructor(t,e){I(this,"tex"),this.gl=t;const r=t.createTexture();if(!r)throw new Error("Failed to create texture");this.tex=r,t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)}bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex)}dispose(){this.gl.deleteTexture(this.tex)}}function gd(i,t){if("OffscreenCanvas"in window)return new OffscreenCanvas(i,t);const e=document.createElement("canvas");return e.width=i,e.height=t,e}class vd extends jc{constructor(t){super(t),I(this,"gl"),I(this,"lastFrameTime",0),I(this,"frameTime",0),I(this,"currentImageData"),I(this,"lastTickTime",0),I(this,"volume",0),I(this,"tickHandle",0),I(this,"maxFPS",60),I(this,"paused",!1),I(this,"staticMode",!1),I(this,"mainProgram"),I(this,"manualControl",!1),I(this,"reduceImageSizeCanvas",gd(32,32)),I(this,"targetSize",ct.fromValues(0,0)),I(this,"currentSize",ct.fromValues(0,0)),I(this,"isNoCover",!0),I(this,"meshStates",[]),I(this,"_disposed",!1),I(this,"onTickBinded",this.onTick.bind(this)),I(this,"supportTextureFloat",!0);const e=t.getContext("webgl");if(!e)throw new Error("WebGL not supported");e.getExtension("EXT_color_buffer_float")||console.warn("EXT_color_buffer_float not supported"),e.getExtension("EXT_float_blend")||(console.warn("EXT_float_blend not supported"),this.supportTextureFloat=!1),e.getExtension("OES_texture_float_linear")||console.warn("OES_texture_float_linear not supported"),e.getExtension("OES_texture_float")||(this.supportTextureFloat=!1,console.warn("OES_texture_float not supported")),this.gl=e,e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.depthFunc(e.ALWAYS),this.mainProgram=new ud(e,ld,hd,"main-program-mg"),this.requestTick()}setManualControl(t){this.manualControl=t}setWireFrame(t){for(const e of this.meshStates)e.mesh.setWireFrame(t)}getControlPoint(t,e){var r,s;return(s=(r=this.meshStates[this.meshStates.length-1])==null?void 0:r.mesh)==null?void 0:s.getControlPoint(t,e)}resizeControlPoints(t,e){var r,s;return(s=(r=this.meshStates[this.meshStates.length-1])==null?void 0:r.mesh)==null?void 0:s.resizeControlPoints(t,e)}resetSubdivition(t){var e,r;return(r=(e=this.meshStates[this.meshStates.length-1])==null?void 0:e.mesh)==null?void 0:r.resetSubdivition(t)}onTick(t){if(this.tickHandle=0,this.paused||this._disposed)return;Number.isNaN(this.lastFrameTime)&&(this.lastFrameTime=t);const e=t-this.lastTickTime,r=t-this.lastFrameTime;if(this.lastFrameTime=t,e<1e3/this.maxFPS){this.requestTick();return}this.frameTime+=r*this.flowSpeed,this.onRedraw(this.frameTime,r)&&this.staticMode?this.staticMode&&(this.lastFrameTime=Number.NaN):this.requestTick(),this.lastTickTime=t}checkIfResize(){const[t,e]=[this.targetSize.x,this.targetSize.y],[r,s]=[this.currentSize.x,this.currentSize.y];if(t!==r||e!==s){super.onResize(t,e);const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,t,e),this.currentSize.x=t,this.currentSize.y=e}}onRedraw(t,e){const r=this.meshStates[this.meshStates.length-1];let s=!1;if(r)if(r.mesh.bind(),this.manualControl&&r.mesh.updateMesh(),this.isNoCover){for(const o of this.meshStates)o.alpha=Math.max(0,o.alpha-e/500);const a=this.meshStates.filter(o=>o.alpha===0);this.meshStates=this.meshStates.filter(o=>o.alpha>0);for(const o of a)o.mesh.dispose(),o.texture.dispose();this.meshStates.length===0&&(s=!0)}else{if(r.alpha=Math.min(1,r.alpha+e/500),r.alpha>=1){const a=this.meshStates.splice(0,this.meshStates.length-1);for(const o of a)o.mesh.dispose(),o.texture.dispose()}this.meshStates.length===1&&r.alpha>=1&&(s=!0)}const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,null),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.clear(n.COLOR_BUFFER_BIT),this.checkIfResize(),this.mainProgram.use(),n.activeTexture(n.TEXTURE0),this.mainProgram.setUniform1f("u_time",t/1e4),this.mainProgram.setUniform1f("u_aspect",this.manualControl?1:this.canvas.width/this.canvas.height),this.mainProgram.setUniform1i("u_texture",0),this.mainProgram.setUniform1f("u_volume",this.volume);for(const a of this.meshStates)this.mainProgram.setUniform1f("u_alpha",a.alpha),a.texture.bind(),a.mesh.bind(),a.mesh.draw();return n.flush(),s}requestTick(){this._disposed||this.tickHandle===0&&(this.tickHandle=requestAnimationFrame(this.onTickBinded))}onResize(t,e){this.targetSize.x=Math.ceil(t),this.targetSize.y=Math.ceil(e),this.requestTick()}setStaticMode(t){this.staticMode=t,this.lastFrameTime=performance.now(),this.requestTick()}setFPS(t){this.maxFPS=t}pause(){this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0),this.paused=!0}resume(){this.paused=!1,this.requestTick()}async setAlbum(t,e){if(t===void 0||typeof t=="string"&&t.trim().length===0){this.isNoCover=!0;return}let r=null,s=5;for(;!r&&s>0;)try{typeof t=="string"?r=await Zc(t,e):r=await Kc(t)}catch(u){console.warn(`failed on loading album resource, retrying (${s})`,{albumSource:t,error:u}),s--}if(!r){console.error("Failed to load album resource",t),this.isNoCover=!0;return}this.isNoCover=!1;const n=this.reduceImageSizeCanvas,a=n.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("Failed to create canvas context");a.clearRect(0,0,n.width,n.height);const o=r instanceof HTMLVideoElement?r.videoWidth:r.naturalWidth,h=r instanceof HTMLVideoElement?r.videoHeight:r.naturalHeight;if(o*h===0)throw new Error("Invalid image size");a.drawImage(r,0,0,o,h,0,0,n.width,n.height);const l=a.getImageData(0,0,n.width,n.height);if(po(l,.4),Qc(l,3),po(l,1.7),td(l,.75),Jc(l,2,4),this.manualControl&&this.meshStates.length>0)this.meshStates[0].texture.dispose(),this.meshStates[0].texture=new go(this.gl,l);else{const u=new yd(this.gl,this.mainProgram.attrs.a_pos,this.mainProgram.attrs.a_color,this.mainProgram.attrs.a_uv);u.resetSubdivition(15);const c=Math.random()>.8?od(6,6):mo[Math.floor(Math.random()*mo.length)];u.resizeControlPoints(c.width,c.height);const f=2/(c.width-1),p=2/(c.height-1);for(const d of c.conf){const y=u.getControlPoint(d.cx,d.cy);y.location.x=d.x,y.location.y=d.y,y.uRot=d.ur*Math.PI/180,y.vRot=d.vr*Math.PI/180,y.uScale=f*d.up,y.vScale=p*d.vp}u.updateMesh(),this.currentImageData=l;const v=new go(this.gl,l),g={mesh:u,texture:v,alpha:0};this.meshStates.push(g)}this.requestTick()}setLowFreqVolume(t){this.volume=t/10}setHasLyric(t){}dispose(){super.dispose(),this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0),this._disposed=!0,this.mainProgram.dispose();for(const t of this.meshStates)t.mesh.dispose(),t.texture.dispose()}}class fn{constructor(t,e){I(this,"element"),I(this,"renderer"),this.renderer=t,this.element=e,e.style.pointerEvents="none",e.style.zIndex="-1",e.style.contain="strict"}static new(t){const e=document.createElement("canvas");return new fn(new t(e),e)}setRenderScale(t){this.renderer.setRenderScale(t)}setFlowSpeed(t){this.renderer.setFlowSpeed(t)}setStaticMode(t){this.renderer.setStaticMode(t)}setFPS(t){this.renderer.setFPS(t)}pause(){this.renderer.pause()}resume(){this.renderer.resume()}setLowFreqVolume(t){this.renderer.setLowFreqVolume(t)}setHasLyric(t){this.renderer.setHasLyric(t)}setAlbum(t,e){return this.renderer.setAlbum(t,e)}getElement(){return this.element}dispose(){this.renderer.dispose(),this.element.remove()}}const _d="_lyricLine_1vq69_6",xd="_lyricBgLine_1vq69_42",bd="_active_1vq69_51",Td="_hasDuetLine_1vq69_63",Ed="_lyricDuetLine_1vq69_64",wd="_lyricMainLine_1vq69_83",Sd="_emphasizeWrapper_1vq69_93",Ad="_emphasize_1vq69_93",Rd="_lyricSubLine_1vq69_116",Md="_disableSpring_1vq69_123",Id="_interludeDots_1vq69_128",Cd="_enabled_1vq69_140",Ld="_tmpDisableTransition_1vq69_166",bt={lyricLine:_d,lyricBgLine:xd,active:bd,hasDuetLine:Td,lyricDuetLine:Ed,lyricMainLine:wd,emphasizeWrapper:Sd,emphasize:Ad,lyricSubLine:Rd,disableSpring:Md,interludeDots:Id,enabled:Cd,tmpDisableTransition:Ld},Oh=-1,ms=0,vr=1,os=2,pn=3,mn=4,yn=5,gn=6,Bh=7,kh=8,vo=typeof self=="object"?self:globalThis,Fd=(i,t)=>{const e=(s,n)=>(i.set(n,s),s),r=s=>{if(i.has(s))return i.get(s);const[n,a]=t[s];switch(n){case ms:case Oh:return e(a,s);case vr:{const o=e([],s);for(const h of a)o.push(r(h));return o}case os:{const o=e({},s);for(const[h,l]of a)o[r(h)]=r(l);return o}case pn:return e(new Date(a),s);case mn:{const{source:o,flags:h}=a;return e(new RegExp(o,h),s)}case yn:{const o=e(new Map,s);for(const[h,l]of a)o.set(r(h),r(l));return o}case gn:{const o=e(new Set,s);for(const h of a)o.add(r(h));return o}case Bh:{const{name:o,message:h}=a;return e(new vo[o](h),s)}case kh:return e(BigInt(a),s);case"BigInt":return e(Object(BigInt(a)),s);case"ArrayBuffer":return e(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:o}=new Uint8Array(a);return e(new DataView(o),a)}}return e(new vo[n](a),s)};return r},_o=i=>Fd(new Map,i)(0),ze="",{toString:Pd}={},{keys:Nd}=Object,hr=i=>{const t=typeof i;if(t!=="object"||!i)return[ms,t];const e=Pd.call(i).slice(8,-1);switch(e){case"Array":return[vr,ze];case"Object":return[os,ze];case"Date":return[pn,ze];case"RegExp":return[mn,ze];case"Map":return[yn,ze];case"Set":return[gn,ze];case"DataView":return[vr,e]}return e.includes("Array")?[vr,e]:e.includes("Error")?[Bh,e]:[os,e]},Vr=([i,t])=>i===ms&&(t==="function"||t==="symbol"),Od=(i,t,e,r)=>{const s=(a,o)=>{const h=r.push(a)-1;return e.set(o,h),h},n=a=>{if(e.has(a))return e.get(a);let[o,h]=hr(a);switch(o){case ms:{let u=a;switch(h){case"bigint":o=kh,u=a.toString();break;case"function":case"symbol":if(i)throw new TypeError("unable to serialize "+h);u=null;break;case"undefined":return s([Oh],a)}return s([o,u],a)}case vr:{if(h){let f=a;return h==="DataView"?f=new Uint8Array(a.buffer):h==="ArrayBuffer"&&(f=new Uint8Array(a)),s([h,[...f]],a)}const u=[],c=s([o,u],a);for(const f of a)u.push(n(f));return c}case os:{if(h)switch(h){case"BigInt":return s([h,a.toString()],a);case"Boolean":case"Number":case"String":return s([h,a.valueOf()],a)}if(t&&"toJSON"in a)return n(a.toJSON());const u=[],c=s([o,u],a);for(const f of Nd(a))(i||!Vr(hr(a[f])))&&u.push([n(f),n(a[f])]);return c}case pn:return s([o,a.toISOString()],a);case mn:{const{source:u,flags:c}=a;return s([o,{source:u,flags:c}],a)}case yn:{const u=[],c=s([o,u],a);for(const[f,p]of a)(i||!(Vr(hr(f))||Vr(hr(p))))&&u.push([n(f),n(p)]);return c}case gn:{const u=[],c=s([o,u],a);for(const f of a)(i||!Vr(hr(f)))&&u.push(n(f));return c}}const{message:l}=a;return s([o,{name:h,message:l}],a)};return n},xo=(i,{json:t,lossy:e}={})=>{const r=[];return Od(!(t||e),!!t,new Map,r)(i),r},bo=typeof structuredClone=="function"?(i,t)=>t&&("json"in t||"lossy"in t)?_o(xo(i,t)):structuredClone(i):(i,t)=>_o(xo(i,t)),Bd=(i,t)=>i.size===t.size&&[...i].every(e=>t.has(e)),kd=i=>/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u.test(i);function Ud(i){return t=>(i(t+.001)-i(t-.001))/(2*.001)}function To(i){return Ud(i)}class hs{constructor(t=0){I(this,"currentPosition",0),I(this,"targetPosition",0),I(this,"currentTime",0),I(this,"params",{}),I(this,"currentSolver"),I(this,"getV"),I(this,"getV2"),I(this,"queueParams"),I(this,"queuePosition"),this.targetPosition=t,this.currentPosition=this.targetPosition,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}resetSolver(){const t=this.getV(this.currentTime);this.currentTime=0,this.currentSolver=Dd(this.currentPosition,t,this.targetPosition,0,this.params),this.getV=To(this.currentSolver),this.getV2=To(this.getV)}arrived(){return Math.abs(this.targetPosition-this.currentPosition)<.01&&this.getV(this.currentTime)<.01&&this.getV2(this.currentTime)<.01&&this.queueParams===void 0&&this.queuePosition===void 0}setPosition(t){this.targetPosition=t,this.currentPosition=t,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}update(t=0){this.currentTime+=t,this.currentPosition=this.currentSolver(this.currentTime),this.queueParams&&(this.queueParams.time-=t,this.queueParams.time<=0&&this.updateParams({...this.queueParams})),this.queuePosition&&(this.queuePosition.time-=t,this.queuePosition.time<=0&&this.setTargetPosition(this.queuePosition.position)),this.arrived()&&this.setPosition(this.targetPosition)}updateParams(t,e=0){e>0?this.queueParams={...this.queuePosition??{},...t,time:e}:(this.queuePosition=void 0,this.params={...this.params,...t},this.resetSolver())}setTargetPosition(t,e=0){e>0?this.queuePosition={...this.queuePosition??{},position:t,time:e}:(this.queuePosition=void 0,this.targetPosition=t,this.resetSolver())}getCurrentPosition(){return this.currentPosition}}function Dd(i,t,e,r=0,s){const n=s?.soft??!1,a=s?.stiffness??100,o=s?.damping??10,h=s?.mass??1,l=e-i;if(n||1<=o/(2*Math.sqrt(a*h))){const v=-Math.sqrt(a/h),g=-v*l-t;return d=>(d-=r,d<0?i:e-(l+d*g)*Math.E**(d*v))}const u=Math.sqrt(4*h*a-o**2),c=(o*l-2*h*t)/u,f=.5*u/h,p=-(.5*o)/h;return v=>(v-=r,v<0?i:e-(Math.cos(v*f)*l+Math.sin(v*f)*c)*Math.E**(v*p))}const rn=[],Eo=[];let sn=!1;function Gd(){let i=Eo.shift();for(;i;){try{i.resolve(i.task())}catch(t){i.reject(t)}i=Eo.shift()}for(i=rn.shift();i;){try{i.resolve(i.task())}catch(t){i.reject(t)}i=rn.shift()}sn=!1}function zd(){sn||(sn=!0,requestAnimationFrame(Gd))}function $d(i){const t={task:i,resolve:()=>{},reject:()=>{}},e=new Promise((r,s)=>{t.resolve=r,t.reject=s});return rn.push(t),zd(),e}class Vd{constructor(t){I(this,"element",document.createElement("div")),I(this,"left",0),I(this,"top",0),I(this,"delay",0),I(this,"lineSize",[0,0]),I(this,"lineTransforms",{posX:new hs(0),posY:new hs(0)}),I(this,"lastStyle",""),this.lyricPlayer=t,this.element.setAttribute("class",bt.lyricLine),this.rebuildStyle()}async measureSize(){return await $d(()=>[this.element.clientWidth,this.element.clientHeight])}show(){this.rebuildStyle()}hide(){this.rebuildStyle()}rebuildStyle(){let t=`transform:translate(${this.lineTransforms.posX.getCurrentPosition().toFixed(2)}px,${this.lineTransforms.posY.getCurrentPosition().toFixed(2)}px);`;!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(t+=`transition-delay:${this.delay}ms;`),t!==this.lastStyle&&(this.lastStyle=t,this.element.setAttribute("style",t))}getElement(){return this.element}setTransform(t=this.left,e=this.top,r=!1,s=0){this.left=t,this.top=e,this.delay=s*1e3|0,r||!this.lyricPlayer.getEnableSpring()?(r&&this.element.classList.add(bt.tmpDisableTransition),this.lineTransforms.posX.setPosition(t),this.lineTransforms.posY.setPosition(e),this.lyricPlayer.getEnableSpring()?this.rebuildStyle():this.show(),r&&requestAnimationFrame(()=>{this.element.classList.remove(bt.tmpDisableTransition)})):(this.lineTransforms.posX.setTargetPosition(t,s),this.lineTransforms.posY.setTargetPosition(e,s))}update(t=0){this.lyricPlayer.getEnableSpring()&&(this.lineTransforms.posX.update(t),this.lineTransforms.posY.update(t),this.isInSight?this.show():this.hide())}get isInSight(){const t=this.lineTransforms.posX.getCurrentPosition(),e=this.lineTransforms.posY.getCurrentPosition(),r=t+this.lineSize[0],s=e+this.lineSize[1],n=this.lyricPlayer.size[0],a=this.lyricPlayer.size[1];return!(t>n||e>a||r<0||s<0)}dispose(){this.element.remove()}}function Hd(i){const t=2.5949095;return i<.5?(2*i)**2*((t+1)*2*i-t)/2:((2*i-2)**2*((t+1)*(i*2-2)+t)+2)/2}function qd(i){return i===1?1:1-2**(-10*i)}const me=(i,t,e)=>Math.max(i,Math.min(t,e));class Xd{constructor(){I(this,"element",document.createElement("div")),I(this,"dot0",document.createElement("span")),I(this,"dot1",document.createElement("span")),I(this,"dot2",document.createElement("span")),I(this,"left",0),I(this,"top",0),I(this,"playing",!0),I(this,"lastStyle",""),I(this,"currentInterlude"),I(this,"currentTime",0),I(this,"targetBreatheDuration",1500),this.element.className=bt.interludeDots,this.element.appendChild(this.dot0),this.element.appendChild(this.dot1),this.element.appendChild(this.dot2)}getElement(){return this.element}setTransform(t=this.left,e=this.top){this.left=t,this.top=e,this.update()}setInterlude(t){this.currentInterlude=t,this.currentTime=t?.[0]??0,t?this.element.classList.add(bt.enabled):this.element.classList.remove(bt.enabled)}pause(){this.playing=!1,this.element.classList.remove(bt.playing)}resume(){this.playing=!0,this.element.classList.add(bt.playing)}update(t=0){if(!this.playing)return;this.currentTime+=t;let e="";if(e+=`transform:translate(${this.left.toFixed(2)}px, ${this.top.toFixed(2)}px)`,this.currentInterlude){const r=this.currentInterlude[1]-this.currentInterlude[0],s=this.currentTime-this.currentInterlude[0];if(s<=r){const n=r/Math.ceil(r/this.targetBreatheDuration);let a=1,o=1;a*=Math.sin(1.5*Math.PI-s/n*2)/20+1,s<2e3&&(a*=qd(s/2e3)),s<500?o=0:s<1e3&&(o*=(s-500)/500),r-s<750&&(a*=1-Hd((750-(r-s))/750/2)),r-s<375&&(o*=me(0,(r-s)/375,1));const h=Math.max(0,r-750);a=Math.max(0,a)*.7,e+=` scale(${a})`;const l=me(.25,s*3/h*.75,1),u=me(.25,(s-h/3)*3/h*.75,1),c=me(.25,(s-h/3*2)*3/h*.75,1);this.dot0.style.opacity=`${me(0,Math.max(0,o*l),1)}`,this.dot1.style.opacity=`${me(0,Math.max(0,o*u),1)}`,this.dot2.style.opacity=`${me(0,Math.max(0,o*c),1)}`}else e+=" scale(0)",this.dot0.style.opacity="0",this.dot1.style.opacity="0",this.dot2.style.opacity="0";e+=";",this.lastStyle!==e&&(this.element.setAttribute("style",e),this.lastStyle=e)}}dispose(){this.element.remove()}}class jd extends EventTarget{constructor(){super(),I(this,"element",document.createElement("div")),I(this,"currentTime",0),I(this,"lyricLinesSize",new WeakMap),I(this,"lyricLineElementMap",new WeakMap),I(this,"currentLyricLines",[]),I(this,"processedLines",[]),I(this,"lyricLinesIndexes",new WeakMap),I(this,"hotLines",new Set),I(this,"bufferedLines",new Set),I(this,"isNonDynamic",!1),I(this,"hasDuetLine",!1),I(this,"scrollToIndex",0),I(this,"disableSpring",!1),I(this,"interludeDotsSize",[0,0]),I(this,"interludeDots",new Xd),I(this,"bottomLine",new Vd(this)),I(this,"enableBlur",!0),I(this,"enableScale",!0),I(this,"hidePassedLines",!1),I(this,"scrollBoundary",[0,0]),I(this,"currentLyricLineObjects",[]),I(this,"isSeeking",!1),I(this,"lastCurrentTime",0),I(this,"alignAnchor","center"),I(this,"alignPosition",.35),I(this,"scrollOffset",0),I(this,"size",[0,0]),I(this,"allowScroll",!0),I(this,"isPageVisible",!0),I(this,"initialLayoutFinished",!1),I(this,"posXSpringParams",{mass:1,damping:10,stiffness:100}),I(this,"posYSpringParams",{mass:.9,damping:15,stiffness:90}),I(this,"scaleSpringParams",{mass:2,damping:25,stiffness:100}),I(this,"scaleForBGSpringParams",{mass:1,damping:20,stiffness:50}),I(this,"onPageShow",()=>{this.isPageVisible=!0,this.setCurrentTime(this.currentTime,!0)}),I(this,"onPageHide",()=>{this.isPageVisible=!1}),I(this,"scrolledHandler",0),I(this,"isScrolled",!1),I(this,"resizeObserver",new ResizeObserver(l=>{let u=!1,c=!1;for(const f of l)if(f.target===this.element){const p=f.contentRect;this.size[0]=p.width,this.size[1]=p.height,c=!0}else if(f.target===this.interludeDots.getElement())this.interludeDotsSize[0]=f.target.clientWidth,this.interludeDotsSize[1]=f.target.clientHeight,u=!0;else if(f.target===this.bottomLine.getElement()){const p=[f.target.clientWidth,f.target.clientHeight],v=this.bottomLine.lineSize;(p[0]!==v[0]||p[1]!==v[1])&&(this.bottomLine.lineSize=p,u=!0)}else{const p=this.lyricLineElementMap.get(f.target);if(p){const v=[f.target.clientWidth,f.target.clientHeight],g=this.lyricLinesSize.get(p)??[0,0];(v[0]!==g[0]||v[1]!==g[1])&&(this.lyricLinesSize.set(p,v),p.onLineSizeChange(v),u=!0)}}u&&this.calcLayout(!0),c&&this.onResize()})),I(this,"wordFadeWidth",.5),I(this,"targetAlignIndex",0),I(this,"isPlaying",!0),this.resizeObserver.observe(this.element),this.resizeObserver.observe(this.interludeDots.getElement()),this.element.classList.add(bt.lyricPlayer),this.element.appendChild(this.interludeDots.getElement()),this.element.appendChild(this.bottomLine.getElement()),this.interludeDots.setTransform(0,200),window.addEventListener("pageshow",this.onPageShow),window.addEventListener("pagehide",this.onPageHide);let t=0,e="none",r=0,s=0,n=0,a=Symbol("amll-scroll"),o=0,h=0;this.element.addEventListener("touchstart",l=>{this.beginScrollHandler()&&(l.preventDefault(),t=this.scrollOffset,r=l.touches[0].screenY,o=r,s=Date.now(),n=0)}),this.element.addEventListener("touchmove",l=>{if(this.beginScrollHandler()){l.preventDefault();const u=l.touches[0].screenY,c=u-r,f=u-o,p=f>0?"down":f<0?"up":"none";e!==p?(e=p,t=this.scrollOffset,r=u,s=Date.now()):this.scrollOffset=t-c,o=u,h=Date.now(),this.limitScrollOffset(),this.calcLayout(!0)}}),this.element.addEventListener("touchend",l=>{if(this.beginScrollHandler()){l.preventDefault(),r=0;const u=Date.now();if(u-h>100)return this.endScrollHandler();const c=u-s;n=(this.scrollOffset-t)/c*1e3;let f=0;const p=Symbol("amll-scroll");a=p;const v=g=>{f||(f=g),a===p&&this.beginScrollHandler()&&(this.scrollOffset+=n*(g-f)/1e3,n*=.99,this.limitScrollOffset(),this.calcLayout(!0),Math.abs(n)>1&&!this.scrollBoundary.includes(this.scrollOffset)&&requestAnimationFrame(v),this.endScrollHandler(),f=g)};requestAnimationFrame(v),this.endScrollHandler()}}),this.element.addEventListener("wheel",l=>{this.beginScrollHandler()&&(l.deltaMode===l.DOM_DELTA_PIXEL?(this.scrollOffset+=l.deltaY,this.limitScrollOffset(),this.calcLayout(!0)):(this.scrollOffset+=l.deltaY*50,this.limitScrollOffset(),this.calcLayout(!1)),this.endScrollHandler())})}beginScrollHandler(){const t=this.allowScroll;return t&&(this.isScrolled=!0,clearTimeout(this.scrolledHandler),this.scrolledHandler=setTimeout(()=>{this.isScrolled=!1,this.scrollOffset=0},5e3)),t}endScrollHandler(){}limitScrollOffset(){this.scrollOffset=Math.max(Math.min(this.scrollBoundary[1],this.scrollOffset),this.scrollBoundary[0])}setWordFadeWidth(t=.5){this.wordFadeWidth=Math.max(1e-4,t)}setEnableScale(t=!0){this.enableScale=t,this.calcLayout()}getEnableScale(){return this.enableScale}getWordFadeWidth(){return this.wordFadeWidth}setIsSeeking(t){this.isSeeking=t}setHidePassedLines(t){this.hidePassedLines=t,this.calcLayout()}setEnableBlur(t){this.enableBlur!==t&&(this.enableBlur=t,this.calcLayout())}setAlignAnchor(t){this.alignAnchor=t}setAlignPosition(t){this.alignPosition=t}setEnableSpring(t=!0){this.disableSpring=!t,t?this.element.classList.remove(bt.disableSpring):this.element.classList.add(bt.disableSpring),this.calcLayout(!0)}getEnableSpring(){return!this.disableSpring}getCurrentInterlude(){var t,e,r,s;if(this.bufferedLines.size>0)return;const n=this.currentTime+20,a=this.scrollToIndex;if(a===0){if((t=this.processedLines[0])!=null&&t.startTime){if(this.processedLines[0].startTime>n)return[n,Math.max(n,this.processedLines[0].startTime-250),-2,this.processedLines[0].isDuet];if(this.processedLines[1].startTime>n&&this.processedLines[0].endTime<n)return[Math.max(this.processedLines[0].endTime,n),this.processedLines[1].startTime,0,this.processedLines[1].isDuet]}}else if((e=this.processedLines[a])!=null&&e.endTime&&(r=this.processedLines[a+1])!=null&&r.startTime){if(this.processedLines[a+1].startTime>n&&this.processedLines[a].endTime<n)return[Math.max(this.processedLines[a].endTime,n),this.processedLines[a+1].startTime,a,this.processedLines[a+1].isDuet];if((s=this.processedLines[a+2])!=null&&s.startTime&&this.processedLines[a+2].startTime>n&&this.processedLines[a+1].endTime<n)return[Math.max(this.processedLines[a+1].endTime,n),this.processedLines[a+2].startTime,a+1,this.processedLines[a+2].isDuet]}}setLyricLines(t,e=0){this.initialLayoutFinished=!0;for(const r of t)for(const s of r.words)s.word=s.word.replace(/\s+/g," ");this.lastCurrentTime=e,this.currentTime=e,this.currentLyricLines=bo(t),this.processedLines=bo(t),this.isNonDynamic=!0;for(const r of this.processedLines)if(r.words.length>1){this.isNonDynamic=!1;break}this.hasDuetLine=this.processedLines.some(r=>r.isDuet),this.processedLines.forEach((r,s,n)=>{if(r.isBG)return;const a=n[s+1];a!=null&&a.isBG&&(a.startTime=Math.min(a.startTime,r.startTime),a.endTime=Math.max(a.endTime,r.endTime))});for(const r of this.currentLyricLineObjects)r.dispose();this.interludeDots.setInterlude(void 0),this.hotLines.clear(),this.bufferedLines.clear(),this.setCurrentTime(0,!0)}setCurrentTime(t,e=!1){var r,s,n,a,o,h,l,u,c;if(this.currentTime=t,!this.initialLayoutFinished&&!e)return;const f=new Set,p=new Set,v=new Set;for(const g of this.hotLines){const d=this.processedLines[g];if(d){if(d.isBG)continue;const y=this.processedLines[g+1];if(y!=null&&y.isBG){const x=this.processedLines[g+2],E=Math.min(d.startTime,y?.startTime),w=Math.min(Math.max(d.endTime,x?.startTime??Number.MAX_VALUE),Math.max(d.endTime,y?.endTime));(E>t||w<=t)&&(this.hotLines.delete(g),f.add(g),this.hotLines.delete(g+1),f.add(g+1),e&&((r=this.currentLyricLineObjects[g])==null||r.disable(),(s=this.currentLyricLineObjects[g+1])==null||s.disable()))}else(d.startTime>t||d.endTime<=t)&&(this.hotLines.delete(g),f.add(g),e&&((n=this.currentLyricLineObjects[g])==null||n.disable()))}else this.hotLines.delete(g),f.add(g),e&&((a=this.currentLyricLineObjects[g])==null||a.disable())}this.currentLyricLineObjects.forEach((g,d,y)=>{var x,E;const w=g.getLine();!w.isBG&&w.startTime<=t&&w.endTime>t&&(this.hotLines.has(d)||(this.hotLines.add(d),v.add(d),e&&g.enable(),(E=(x=y[d+1])==null?void 0:x.getLine())!=null&&E.isBG&&(this.hotLines.add(d+1),v.add(d+1),e&&y[d+1].enable())))});for(const g of this.bufferedLines)this.hotLines.has(g)||(p.add(g),e&&((o=this.currentLyricLineObjects[g])==null||o.disable()));if(e){this.bufferedLines.size>0?this.scrollToIndex=Math.min(...this.bufferedLines):this.scrollToIndex=this.processedLines.findIndex(g=>g.startTime>=t),this.bufferedLines.clear();for(const g of this.hotLines)this.bufferedLines.add(g);this.calcLayout()}else if(p.size>0||v.size>0)if(p.size===0&&v.size>0){for(const g of v)this.bufferedLines.add(g),(h=this.currentLyricLineObjects[g])==null||h.enable();this.scrollToIndex=Math.min(...this.bufferedLines),this.calcLayout()}else if(v.size===0&&p.size>0){if(Bd(p,this.bufferedLines)){for(const g of this.bufferedLines)this.hotLines.has(g)||(this.bufferedLines.delete(g),(l=this.currentLyricLineObjects[g])==null||l.disable());this.calcLayout()}}else{for(const g of v)this.bufferedLines.add(g),(u=this.currentLyricLineObjects[g])==null||u.enable();for(const g of p)this.bufferedLines.delete(g),(c=this.currentLyricLineObjects[g])==null||c.disable();this.bufferedLines.size>0&&(this.scrollToIndex=Math.min(...this.bufferedLines)),this.calcLayout()}this.lastCurrentTime=t}async calcLayout(t=!1){var e;const r=this.getCurrentInterlude();let s=-this.scrollOffset,n=this.scrollToIndex,a=0;r?(a=r[1]-r[0],a>=4e3&&this.currentLyricLineObjects[r[2]+1]&&(n=r[2]+1)):this.interludeDots.setInterlude(void 0);const o=this.size[1]/5,h=this.currentLyricLineObjects.slice(0,n).reduce((v,g)=>{var d;return v+(g.getLine().isBG&&this.isPlaying?0:((d=this.lyricLinesSize.get(g))==null?void 0:d[1])??o)},0);this.scrollBoundary[0]=-h,s-=h,s+=this.size[1]*this.alignPosition;const l=this.currentLyricLineObjects[n];if(this.targetAlignIndex=n,l){const v=((e=this.lyricLinesSize.get(l))==null?void 0:e[1])??o;switch(this.alignAnchor){case"bottom":s-=v;break;case"center":s-=v/2;break}}const u=Math.max(...this.bufferedLines);let c=0,f=t?0:.05,p=!1;this.currentLyricLineObjects.forEach((v,g)=>{var d,y;const x=this.bufferedLines.has(g),E=x||g>=this.scrollToIndex&&g<u,w=v.getLine();!p&&a>=4e3&&(g===this.scrollToIndex&&r?.[2]===-2||g===this.scrollToIndex+1)&&(p=!0,this.interludeDots.setTransform(0,s),r&&this.interludeDots.setInterlude([r[0],r[1]]),s+=this.interludeDotsSize[1]);let m;this.hidePassedLines?g<(r?r[2]+1:this.scrollToIndex)&&this.isPlaying?m=1e-5:x?m=.85:m=this.isNonDynamic?.2:1:x?m=.85:m=this.isNonDynamic?.2:1;let S=0;this.enableBlur&&(E?S=0:(S=1,g<this.scrollToIndex?S+=Math.abs(this.scrollToIndex-g)+1:S+=Math.abs(g-Math.max(this.scrollToIndex,u))));const _=this.enableScale?97:100;let B=100;!E&&this.isPlaying&&(w.isBG?B=75:B=_),v.setTransform(s,B,m,window.innerWidth<=1024?S*.8:S,!1,c),w.isBG&&(E||!this.isPlaying)?s+=((d=this.lyricLinesSize.get(v))==null?void 0:d[1])??o:w.isBG||(s+=((y=this.lyricLinesSize.get(v))==null?void 0:y[1])??o),s>=0&&!this.isSeeking&&(w.isBG||(c+=f),g>=this.scrollToIndex&&(f/=1.05))}),this.scrollBoundary[1]=s+this.scrollOffset-this.size[1]/2,this.bottomLine.setTransform(0,s,!1,c)}setLinePosXSpringParams(t={}){}setLinePosYSpringParams(t={}){this.posYSpringParams={...this.posYSpringParams,...t},this.bottomLine.lineTransforms.posY.updateParams(this.posYSpringParams);for(const e of this.currentLyricLineObjects)e.lineTransforms.posY.updateParams(this.posYSpringParams)}setLineScaleSpringParams(t={}){this.scaleSpringParams={...this.scaleSpringParams,...t},this.scaleForBGSpringParams={...this.scaleForBGSpringParams,...t};for(const e of this.currentLyricLineObjects)e.getLine().isBG?e.lineTransforms.scale.updateParams(this.scaleForBGSpringParams):e.lineTransforms.scale.updateParams(this.scaleSpringParams)}pause(){this.interludeDots.pause(),this.isPlaying&&(this.isPlaying=!1,this.calcLayout())}resume(){this.interludeDots.resume(),this.isPlaying||(this.isPlaying=!0,this.calcLayout())}update(t=0){this.bottomLine.update(t/1e3),this.interludeDots.update(t/1e3)}onResize(){}getBottomLineElement(){return this.bottomLine.getElement()}resetScroll(){this.isScrolled=!1,this.scrollOffset=0,clearTimeout(this.scrolledHandler),this.scrolledHandler=0}getLyricLines(){return this.currentLyricLines}getCurrentTime(){return this.currentTime}getElement(){return this.element}dispose(){this.element.remove(),window.removeEventListener("pageshow",this.onPageShow),window.removeEventListener("pagehide",this.onPageHide)}}class $e extends EventTarget{constructor(){super(...arguments),I(this,"top",0),I(this,"scale",1),I(this,"blur",0),I(this,"opacity",1),I(this,"delay",0),I(this,"lineTransforms",{posY:new hs(0),scale:new hs(100)})}onLineSizeChange(t){}setTransform(t=this.top,e=this.scale,r=this.opacity,s=this.blur,n=!1,a=0){this.top=t,this.scale=e,this.opacity=r,this.blur=s,this.delay=a}static shouldEmphasize(t){return kd(t.word)?t.endTime-t.startTime>=1e3:t.endTime-t.startTime>=1e3&&t.word.trim().length<=7&&t.word.trim().length>1}dispose(){}}function Wd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ki,wo;function Yd(){if(wo)return ki;wo=1;var i=4,t=.001,e=1e-7,r=10,s=11,n=1/(s-1),a=typeof Float32Array=="function";function o(g,d){return 1-3*d+3*g}function h(g,d){return 3*d-6*g}function l(g){return 3*g}function u(g,d,y){return((o(d,y)*g+h(d,y))*g+l(d))*g}function c(g,d,y){return 3*o(d,y)*g*g+2*h(d,y)*g+l(d)}function f(g,d,y,x,E){var w,m,S=0;do m=d+(y-d)/2,w=u(m,x,E)-g,w>0?y=m:d=m;while(Math.abs(w)>e&&++S<r);return m}function p(g,d,y,x){for(var E=0;E<i;++E){var w=c(d,y,x);if(w===0)return d;var m=u(d,y,x)-g;d-=m/w}return d}function v(g){return g}return ki=function(g,d,y,x){if(!(0<=g&&g<=1&&0<=y&&y<=1))throw new Error("bezier x values must be in [0, 1] range");if(g===d&&y===x)return v;for(var E=a?new Float32Array(s):new Array(s),w=0;w<s;++w)E[w]=u(w*n,g,y);function m(S){for(var _=0,B=1,U=s-1;B!==U&&E[B]<=S;++B)_+=n;--B;var k=(S-E[B])/(E[B+1]-E[B]),D=_+k*n,L=c(D,g,y);return L>=t?p(S,D,g,y):L===0?D:f(S,_,_+n,g,y)}return function(S){return S===0?0:S===1?1:u(m(S),d,x)}},ki}var Zd=Yd();const ys=Wd(Zd),Kd=/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u;function Jd(i){const t=[];for(const n of i){const a=n.word.replace(/\s/g,"").length,o=n.word.split(" ").filter(h=>h.trim().length>0);if(o.length>1){n.word.startsWith(" ")&&t.push({word:" ",startTime:0,endTime:0,obscene:!1});let h=0;for(const l of o){const u={word:l,obscene:n.obscene,startTime:n.startTime+h/a*(n.endTime-n.startTime),endTime:n.startTime+(h+l.length)/a*(n.endTime-n.startTime)};t.push(u),t.push({word:" ",startTime:0,endTime:0,obscene:!1}),h+=l.length}n.word.endsWith(" ")||t.pop()}else t.push({...n})}let e=[],r=[];const s=[];for(const n of t){const a=n.word;e.push(a),r.push(n),a.length>0&&a.trim().length===0?(e.pop(),r.pop(),r.length===1?s.push(r[0]):r.length>1&&s.push(r),s.push(n),e=[],r=[]):(!/^\s*[^\s]*\s*$/.test(e.join(""))||Kd.test(a))&&(e.pop(),r.pop(),r.length===1?s.push(r[0]):r.length>1&&s.push(r),e=[a],r=[n])}return r.length===1?s.push(r[0]):s.push(r),s}function Qd(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function tf(i,t=1,e={x:0,y:0}){const[r,s]=[e.x,e.y];return[i[0]*t,i[1]*t,i[2]*t,i[3],i[4]*t,i[5]*t,i[6]*t,i[7],i[8]*t,i[9]*t,i[10]*t,i[11],i[12]-r*t+r,i[13]-s*t+s,i[14],i[15]]}function ef(i,t=4){const e=(r,s)=>r.toFixed(t);return`matrix3d(${i.map(e).join(", ")})`}const Hr=32,Uh=(i,t)=>e=>Math.min(1,Math.max(0,(e-i)/(t-i))),vn=.5,rf=Uh(0,vn),sf=Uh(vn,1),nf=ys(.2,.4,.58,1),af=ys(.3,0,.58,1),of=i=>t=>t<i?nf(rf(t)):1-af(sf(t));function So(i,t=0,e="rgba(0,0,0,var(--bright-mask-alpha, 1.0))",r="rgba(0,0,0,var(--dark-mask-alpha, 1.0))"){const s=2+i+t,n=i/s,a=(1-n)/2;return[`linear-gradient(to right,${e} ${a*100}%,${r} ${(a+n)*100}%)`,s]}let hf=class extends MouseEvent{constructor(i,t){super(t.type,t),this.line=i}};function lf(i){const t=i.match(/matrix\(([^)]+)\)/);if(t){const e=t[1].split(", "),r=Number.parseFloat(e[0]),s=Number.parseFloat(e[3]);return(r+s)/2}return 1}let uf=class extends $e{constructor(i,t={words:[],translatedLyric:"",romanLyric:"",startTime:0,endTime:0,isBG:!1,isDuet:!1}){super(),I(this,"element",document.createElement("div")),I(this,"splittedWords",[]),I(this,"lineSize",[0,0]),I(this,"listenersMap",new Map),I(this,"onMouseEvent",n=>{const a=new hf(this,n);for(const o of this.listenersMap.get(n.type)??[])o.call(this,a);if(!this.dispatchEvent(a)||a.defaultPrevented)return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!1}),I(this,"isEnabled",!1),I(this,"lastWord"),I(this,"_hide",!0),I(this,"_prevParentEl"),I(this,"lastStyle",""),this.lyricPlayer=i,this.lyricLine=t,this._prevParentEl=i.getElement(),i.resizeObserver.observe(this.element),this.element.setAttribute("class",bt.lyricLine),this.lyricLine.isBG&&this.element.classList.add(bt.lyricBgLine),this.lyricLine.isDuet&&this.element.classList.add(bt.lyricDuetLine),this.lineTransforms.posY.setPosition(window.innerHeight*2),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div"));const e=this.element.children[0],r=this.element.children[1],s=this.element.children[2];e.setAttribute("class",bt.lyricMainLine),r.setAttribute("class",bt.lyricSubLine),s.setAttribute("class",bt.lyricSubLine),this.rebuildElement(),this.rebuildStyle()}addMouseEventListener(i,t,e){if(t){const r=this.listenersMap.get(i)??new Set;r.size===0&&this.element.addEventListener(i,this.onMouseEvent,e),r.add(t),this.listenersMap.set(i,r)}}removeMouseEventListener(i,t,e){if(t){const r=this.listenersMap.get(i);r&&(r.delete(t),r.size===0&&this.element.removeEventListener(i,this.onMouseEvent,e))}}areWordsOnSameLine(i,t){if(i!=null&&i.mainElement&&t!=null&&t.mainElement){const e=i.mainElement,r=t.mainElement,s=e.getBoundingClientRect(),n=r.getBoundingClientRect();return Math.abs(s.top-n.top)<10}return!0}async enable(i=this.lyricLine.startTime){this.isEnabled=!0,this.element.classList.add(bt.active);const t=this.element.children[0];for(const e of this.splittedWords){for(const r of e.elementAnimations)r.currentTime=0,r.playbackRate=1,r.play();for(const r of e.maskAnimations)r.currentTime=Math.min(this.totalDuration,Math.max(0,i-this.lyricLine.startTime)),r.playbackRate=1,r.play()}t.classList.add(bt.active)}disable(){this.isEnabled=!1,this.element.classList.remove(bt.active);const i=this.element.children[0];for(const t of this.splittedWords)for(const e of t.elementAnimations)(e.id==="float-word"||e.id.includes("emphasize-word-float-only"))&&(e.playbackRate=-1,e.play());i.classList.remove(bt.active)}async resume(){if(this.isEnabled)for(const i of this.splittedWords){for(const t of i.elementAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(i))&&t.play();for(const t of i.maskAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(i))&&t.play()}}async pause(){if(this.isEnabled)for(const i of this.splittedWords){for(const t of i.elementAnimations)t.pause();for(const t of i.maskAnimations)t.pause()}}setMaskAnimationState(i=0){const t=i-this.lyricLine.startTime;for(const e of this.splittedWords)for(const r of e.maskAnimations)r.currentTime=Math.min(this.totalDuration,Math.max(0,t)),r.playbackRate=1,t>=0&&t<this.totalDuration?r.play():r.pause()}getLine(){return this.lyricLine}show(){this._hide=!1,this.element.parentElement||(this._prevParentEl.appendChild(this.element),this.lyricPlayer.resizeObserver.observe(this.element)),this.rebuildStyle()}hide(){this._hide=!0,this.element.parentElement&&(this._prevParentEl.removeChild(this.element),this.lyricPlayer.resizeObserver.unobserve(this.element))}rebuildStyle(){let i="";i+=`transform:translateY(${this.lineTransforms.posY.getCurrentPosition().toFixed(1)}px) scale(${(this.lineTransforms.scale.getCurrentPosition()/100).toFixed(4)});`,!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(i+=`transition-delay:${this.delay}ms;`),i+=`filter:blur(${Math.min(32,this.blur)}px);`,i!==this.lastStyle&&(this.lastStyle=i,this.element.setAttribute("style",i))}rebuildElement(){this.disposeElements();const i=this.element.children[0],t=this.element.children[1],e=this.element.children[2];if(this.lyricPlayer._getIsNonDynamic()){i.innerText=this.lyricLine.words.map(s=>s.word).join(""),t.innerText=this.lyricLine.translatedLyric,e.innerText=this.lyricLine.romanLyric;return}const r=Jd(this.lyricLine.words);i.innerHTML="";for(const s of r)if(Array.isArray(s)){if(s.length===0)continue;const n=s.reduce((l,u)=>(l.endTime=Math.max(l.endTime,u.endTime),l.startTime=Math.min(l.startTime,u.startTime),l.word+=u.word,l),{word:"",startTime:Number.POSITIVE_INFINITY,endTime:Number.NEGATIVE_INFINITY,wordType:"normal",obscene:!1}),a=s.map(l=>$e.shouldEmphasize(l)).reduce((l,u)=>l||u,$e.shouldEmphasize(n)),o=document.createElement("span");o.classList.add(bt.emphasizeWrapper);const h=[];for(const l of s){const u=document.createElement("span");if(a){u.classList.add(bt.emphasize);const c=[];for(const p of l.word.trim().split("")){const v=document.createElement("span");v.innerText=p,c.push(v),h.push(v),u.appendChild(v)}const f={...l,mainElement:u,subElements:c,elementAnimations:[this.initFloatAnimation(l,u)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:a};this.splittedWords.push(f)}else u.innerText=l.word,this.splittedWords.push({...l,mainElement:u,subElements:[],elementAnimations:[this.initFloatAnimation(l,u)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:a});o.appendChild(u)}a&&this.splittedWords[this.splittedWords.length-1].elementAnimations.push(...this.initEmphasizeAnimation(n,h,n.endTime-n.startTime,n.startTime-this.lyricLine.startTime)),n.word.trimStart()!==n.word&&i.appendChild(document.createTextNode(" ")),i.appendChild(o),n.word.trimEnd()!==n.word&&$e.shouldEmphasize(n)&&i.appendChild(document.createTextNode(" "))}else if(s.word.trim().length===0)i.appendChild(document.createTextNode(" "));else{const n=$e.shouldEmphasize(s),a=document.createElement("span"),o={...s,mainElement:a,subElements:[],elementAnimations:[this.initFloatAnimation(s,a)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:n};if($e.shouldEmphasize(s)){a.classList.add(bt.emphasize);const h=[];for(const u of s.word.trim().split("")){const c=document.createElement("span");c.innerText=u,h.push(c),a.appendChild(c)}o.subElements=h;const l=Math.abs(o.endTime-o.startTime);o.elementAnimations.push(...this.initEmphasizeAnimation(s,h,l,o.startTime-this.lyricLine.startTime))}else a.innerText=s.word.trim();s.word.trimStart()!==s.word&&i.appendChild(document.createTextNode(" ")),i.appendChild(a),s.word.trimEnd()!==s.word&&i.appendChild(document.createTextNode(" ")),this.splittedWords.push(o)}t.innerText=this.lyricLine.translatedLyric,e.innerText=this.lyricLine.romanLyric}initFloatAnimation(i,t){const e=i.startTime-this.lyricLine.startTime,r=Math.max(1e3,i.endTime-i.startTime);let s=.05;this.lyricLine.isBG&&(s*=2);const n=t.animate([{transform:"translateY(0px)"},{transform:`translateY(${-s}em)`}],{duration:Number.isFinite(r)?r:0,delay:Number.isFinite(e)?e:0,id:"float-word",composite:"add",fill:"both",easing:"ease-out"});return n.pause(),n}initEmphasizeAnimation(i,t,e,r){const s=Math.max(0,r);let n=Math.max(1e3,e),a=[],o=n/2e3;o=o>1?Math.sqrt(o):o**3;let h=n/3e3;h=h>1?Math.sqrt(h):h**3,o*=.6,h*=.5,this.lyricLine.words.length>0&&i.word.includes(this.lyricLine.words[this.lyricLine.words.length-1].word)&&(o*=1.6,h*=1.5,n*=1.2),o=Math.min(1.2,o),h=Math.min(.8,h);const l=Number.isFinite(n)?n:0,u=of(vn);return a=t.flatMap((c,f,p)=>{const v=s+n/2.5/p.length*f,g=[],d=new Array(Hr).fill(0).map((w,m)=>{const S=(m+1)/Hr,_=u(S),B=u(S)*h,U=tf(Qd(),1+_*.1*o),k=-_*.03*o*(p.length/2-f),D=-_*.025*o;return{offset:S,transform:`${ef(U,4)} translate(${k}em, ${D}em)`,textShadow:`0 0 ${Math.min(.3,h*.3)}em rgba(255, 255, 255, ${B})`}}),y=c.animate(d,{duration:l,delay:Number.isFinite(v)?v:0,id:`emphasize-word-${c.innerText}-${f}`,iterations:1,composite:"replace",fill:"both"});y.onfinish=()=>{y.pause()},y.pause(),g.push(y);const x=new Array(Hr).fill(0).map((w,m)=>{const S=(m+1)/Hr;let _=Math.sin(S*Math.PI);return this.lyricLine.isBG&&(_*=2),{offset:S,transform:`translateY(${-_*.05}em)`}}),E=c.animate(x,{duration:l*1.4,delay:Number.isFinite(v)?v-400:0,id:"emphasize-word-float",iterations:1,composite:"add",fill:"both"});return E.onfinish=()=>{E.pause()},E.pause(),g.push(E),g}),a}get totalDuration(){return this.lyricLine.endTime-this.lyricLine.startTime}onLineSizeChange(i){this.updateMaskImageSync()}updateMaskImageSync(){for(const i of this.splittedWords){const t=i.mainElement;t?(i.padding=Number.parseFloat(getComputedStyle(t).paddingLeft),i.width=t.clientWidth-i.padding*2,i.height=t.clientHeight-i.padding*2):(i.width=0,i.height=0,i.padding=0)}this.lyricPlayer.supportMaskImage?this.generateWebAnimationBasedMaskImage():this.generateCalcBasedMaskImage(),this.isEnabled&&this.enable(this.lyricPlayer.getCurrentTime())}generateCalcBasedMaskImage(){for(const i of this.splittedWords){const t=i.mainElement;if(t){i.width=t.clientWidth,i.height=t.clientHeight;const e=i.height*this.lyricPlayer.getWordFadeWidth(),[r,s]=So(e/i.width),n=`${s*100}% 100%`;this.lyricPlayer.supportMaskImage?(t.style.maskImage=r,t.style.maskRepeat="no-repeat",t.style.maskOrigin="left",t.style.maskSize=n):(t.style.webkitMaskImage=r,t.style.webkitMaskRepeat="no-repeat",t.style.webkitMaskOrigin="left",t.style.webkitMaskSize=n);const a=i.width+e,o=`clamp(${-a}px,calc(${-a}px + (var(--amll-player-time) - ${i.startTime})*${a/Math.abs(i.endTime-i.startTime)}px),0px) 0px, left top`;t.style.maskPosition=o,t.style.webkitMaskPosition=o}}}generateWebAnimationBasedMaskImage(){const i=Math.max(this.splittedWords.reduce((t,e)=>Math.max(e.endTime,t),0),this.lyricLine.endTime)-this.lyricLine.startTime;this.splittedWords.forEach((t,e)=>{const r=t.mainElement;if(r){const s=t.height*this.lyricPlayer.getWordFadeWidth(),[n,a]=So(s/(t.width+t.padding*2)),o=`${a*100}% 100%`;this.lyricPlayer.supportMaskImage?(r.style.maskImage=n,r.style.maskRepeat="no-repeat",r.style.maskOrigin="left",r.style.maskSize=o):(r.style.webkitMaskImage=n,r.style.webkitMaskRepeat="no-repeat",r.style.webkitMaskOrigin="left",r.style.webkitMaskSize=o);const h=this.splittedWords.slice(0,e).reduce((x,E)=>x+E.width,0)+(this.splittedWords[0]?s:0),l=-(t.width+t.padding*2+s),u=x=>Math.max(l,Math.min(0,x));let c=-h-t.width-t.padding-s,f=0;const p=[];let v=c,g=0;const d=()=>{const x=c-v,E=Math.max(0,Math.min(1,f)),w=E-g,m=Math.abs(w/x);if(c>l&&v<l){const B=Math.abs(v-l)*m,U=`${u(v)}px 0`,k={offset:g+B,maskPosition:U};p.push(k)}if(c>0&&v<0){const B=Math.abs(v)*m,U=`${u(c)}px 0`,k={offset:g+B,maskPosition:U};p.push(k)}const S=`${u(c)}px 0`,_={offset:E,maskPosition:S};p.push(_),v=c,g=E};d();let y=0;this.splittedWords.forEach((x,E)=>{{const w=x.startTime-this.lyricLine.startTime,m=w-y;f+=m/i,m>0&&d(),y=w}{const w=x.endTime-x.startTime;f+=w/i,c+=x.width,E===0&&(c+=s*1.5),E===this.splittedWords.length-1&&(c+=s*.5),w>0&&d(),y+=w}});for(const x of t.maskAnimations)x.cancel();try{const x=r.animate(p,{duration:i||1,id:`fade-word-${t.word}-${e}`,fill:"both"});x.pause(),t.maskAnimations=[x]}catch(x){console.warn("应用渐变动画发生错误",p,i,x)}}})}getElement(){return this.element}setTransform(i=this.top,t=this.scale,e=1,r=0,s=!1,n=0){super.setTransform(i,t,e,r,s,n);const a=this.isInSight,o=this.lyricPlayer.getEnableSpring();this.top=i,this.scale=t,this.delay=n*1e3|0;const h=this.element.children[0];if(h.style.opacity=`${e}`,s||!o)if(this.blur=Math.min(32,r),this.lineTransforms.posY.setPosition(i),this.lineTransforms.scale.setPosition(t),o)this.rebuildStyle();else{const l=this.isInSight;a||l?this.show():this.hide()}else if(this.lineTransforms.posY.setTargetPosition(i,n),this.lineTransforms.scale.setTargetPosition(t),this.blur!==Math.min(32,r)){this.blur=Math.min(32,r);const l=r.toFixed(3);this.element.style.filter=`blur(${l}px)`}}update(i=0){if(this.lyricPlayer.getEnableSpring())if(this.lineTransforms.posY.update(i),this.lineTransforms.scale.update(i),this.isInSight?this.show():this.hide(),this.lyricPlayer.getEnableSpring())this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.2+.2}`);else{const t=window.getComputedStyle(this.element).transform,e=lf(t);this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,(e-.97)/.03))*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,(e-.97)/.03))*.2+.2}`)}}_getDebugTargetPos(){return`[位移: ${this.top}; 缩放: ${this.scale}; 延时: ${this.delay}]`}get isInSight(){var i;const t=this.lineTransforms.posY.getCurrentPosition(),e=((i=this.lyricPlayer.lyricLinesSize.get(this))==null?void 0:i[1])??0,r=t+e,s=this.lyricPlayer.size[1];return!(t>s+e||r<-e)}disposeElements(){var i,t;for(const e of this.splittedWords){for(const r of e.elementAnimations)r.cancel();for(const r of e.maskAnimations)r.cancel();for(const r of e.subElements)r.remove(),(i=r.parentNode)==null||i.removeChild(r);e.elementAnimations=[],e.maskAnimations=[],e.subElements=[],e.mainElement.remove(),(t=e.mainElement.parentNode)==null||t.removeChild(e.mainElement)}this.splittedWords=[]}dispose(){this.disposeElements(),this.lyricPlayer.resizeObserver.unobserve(this.element),this.element.remove()}};class cf extends MouseEvent{constructor(t,e,r){super(`line-${r.type}`,r),this.lineIndex=t,this.line=e}}class df extends jd{constructor(){super(),I(this,"currentLyricLineObjects",[]),I(this,"supportPlusLighter",CSS.supports("mix-blend-mode","plus-lighter")),I(this,"supportMaskImage",CSS.supports("mask-image","none")),I(this,"innerSize",[0,0]),I(this,"onLineClickedHandler",t=>{const e=new cf(this.lyricLinesIndexes.get(t.line)??-1,t.line,t);this.dispatchEvent(e)||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}),I(this,"_baseFontSize",Number.parseFloat(getComputedStyle(this.element).fontSize)),this.onResize(),this.element.classList.add("amll-lyric-player","dom"),this.disableSpring&&this.element.classList.add(bt.disableSpring)}onResize(){const t=getComputedStyle(this.element);this._baseFontSize=Number.parseFloat(t.fontSize),this.rebuildStyle()}_getIsNonDynamic(){return this.isNonDynamic}get baseFontSize(){return this._baseFontSize}rebuildStyle(){}setWordFadeWidth(t=.5){super.setWordFadeWidth(t);for(const e of this.currentLyricLineObjects)e.updateMaskImageSync()}setLyricLines(t,e=0){super.setLyricLines(t,e),this.hasDuetLine?this.element.classList.add(bt.hasDuetLine):this.element.classList.remove(bt.hasDuetLine),this.supportMaskImage||this.element.style.setProperty("--amll-player-time",`${e}`);for(const r of this.currentLyricLineObjects)r.removeMouseEventListener("click",this.onLineClickedHandler),r.removeMouseEventListener("contextmenu",this.onLineClickedHandler),r.dispose();this.currentLyricLineObjects=this.processedLines.map((r,s)=>{const n=new uf(this,r);return n.addMouseEventListener("click",this.onLineClickedHandler),n.addMouseEventListener("contextmenu",this.onLineClickedHandler),this.element.appendChild(n.getElement()),this.lyricLinesIndexes.set(n,s),this.lyricLineElementMap.set(n.getElement(),n),n}),this.setLinePosXSpringParams({}),this.setLinePosYSpringParams({}),this.setLineScaleSpringParams({}),this.calcLayout(!0)}pause(){super.pause(),this.element.classList.remove("playing"),this.interludeDots.pause();for(const t of this.currentLyricLineObjects)t.pause()}resume(){super.resume(),this.element.classList.add("playing"),this.interludeDots.resume();for(const t of this.currentLyricLineObjects)t.resume()}update(t=0){if(!this.initialLayoutFinished||(super.update(t),this.supportMaskImage||this.element.style.setProperty("--amll-player-time",`${this.currentTime}`),!this.isPageVisible))return;const e=t/1e3;this.interludeDots.update(t),this.bottomLine.update(e);for(const r of this.currentLyricLineObjects)r.update(e)}dispose(){super.dispose(),this.element.remove();for(const t of this.currentLyricLineObjects)t.dispose();this.bottomLine.dispose(),this.interludeDots.dispose()}}ys(.2,.4,.58,1);ys(.3,0,.58,1);it.forwardRef(({album:i,albumIsVideo:t,fps:e,playing:r,flowSpeed:s,renderScale:n,staticMode:a,lowFreqVolume:o,hasLyric:h,renderer:l,style:u,...c},f)=>{const p=it.useRef(null),v=it.useRef(null),g=it.useRef(null),d=l??vd;return it.useEffect(()=>{var y;(g.current!==d||p.current===void 0)&&(g.current=d,(y=p.current)==null||y.dispose(),p.current=fn.new(d))},[d]),it.useEffect(()=>{var y;d&&i&&((y=p.current)==null||y.setAlbum(i,t))},[d,i,t]),it.useEffect(()=>{var y;d&&e&&((y=p.current)==null||y.setFPS(e))},[d,e]),it.useEffect(()=>{var y,x,E;d&&(r===void 0?(y=p.current)==null||y.resume():r?(x=p.current)==null||x.resume():(E=p.current)==null||E.pause())},[d,r]),it.useEffect(()=>{var y;d&&s&&((y=p.current)==null||y.setFlowSpeed(s))},[d,s]),it.useEffect(()=>{var y;d&&((y=p.current)==null||y.setStaticMode(a??!1))},[d,a]),it.useEffect(()=>{var y;d&&n&&((y=p.current)==null||y.setRenderScale(n??.5))},[d,n]),it.useEffect(()=>{var y;d&&o&&((y=p.current)==null||y.setLowFreqVolume(o??1))},[d,o]),it.useEffect(()=>{var y;d&&h!==void 0&&((y=p.current)==null||y.setHasLyric(h??!0))},[d,h]),it.useEffect(()=>{var y;if(p.current){const x=p.current.getElement();x.style.width="100%",x.style.height="100%",x.style.minHeight="0",x.style.minWidth="0",x.style.overflow="hidden",(y=v.current)==null||y.appendChild(x)}},[p.current]),it.useImperativeHandle(f,()=>({wrapperEl:v.current,bgRender:p.current}),[v.current,p.current]),Ye.jsx("div",{style:{display:"contents",...u},...c,ref:v})});const ff=it.forwardRef(({disabled:i,playing:t,alignAnchor:e,alignPosition:r,enableSpring:s,enableBlur:n,enableScale:a,hidePassedLines:o,lyricLines:h,currentTime:l,isSeeking:u,wordFadeWidth:c,linePosXSpringParams:f,linePosYSpringParams:p,lineScaleSpringParams:v,bottomLine:g,lyricPlayer:d,onLyricLineClick:y,onLyricLineContextMenu:x,...E},w)=>{const[m,S]=it.useState(),_=it.useRef(null),B=it.useRef(l);return it.useLayoutEffect(()=>{var U;const k=new(d??df);return S(k),(U=_.current)==null||U.appendChild(k.getElement()),()=>{k?.dispose(),S(void 0)}},[d]),it.useLayoutEffect(()=>{h!==void 0?(m?.setLyricLines(h,B.current),m?.update()):(m?.setLyricLines([]),m?.update())},[m,h]),it.useEffect(()=>{if(!i){let U=!1,k=-1;const D=L=>{U||(k===-1&&(k=L),m?.update(L-k),k=L,requestAnimationFrame(D))};return m?.calcLayout(),requestAnimationFrame(D),()=>{U=!0}}},[m,i]),it.useEffect(()=>{t!==void 0?t?m?.resume():m?.pause():m?.resume()},[m,t]),it.useEffect(()=>{e!==void 0&&m?.setAlignAnchor(e)},[m,e]),it.useEffect(()=>{o!==void 0&&m?.setHidePassedLines(o)},[m,o]),it.useEffect(()=>{r!==void 0&&m?.setAlignPosition(r)},[m,r]),it.useEffect(()=>{s!==void 0?m?.setEnableSpring(s):m?.setEnableSpring(!0)},[m,s]),it.useEffect(()=>{a!==void 0?m?.setEnableScale(a):m?.setEnableScale(!0)},[m,a]),it.useEffect(()=>{m?.setEnableBlur(n??!0)},[m,n]),it.useEffect(()=>{l!==void 0?(m?.setCurrentTime(l),B.current=l):m?.setCurrentTime(0)},[m,l]),it.useEffect(()=>{m?.setIsSeeking(!!u)},[m,u]),it.useEffect(()=>{m?.setWordFadeWidth(c)},[m,c]),it.useEffect(()=>{f!==void 0&&m?.setLinePosXSpringParams(f)},[m,f]),it.useEffect(()=>{p!==void 0&&m?.setLinePosYSpringParams(p)},[m,p]),it.useEffect(()=>{v!==void 0&&m?.setLineScaleSpringParams(v)},[m,v]),it.useEffect(()=>{if(y){const U=k=>y(k);return m?.addEventListener("line-click",U),()=>m?.removeEventListener("line-click",U)}},[m,y]),it.useEffect(()=>{if(x){const U=k=>x(k);return m?.addEventListener("line-contextmenu",U),()=>m?.removeEventListener("line-contextmenu",U)}},[m,x]),it.useImperativeHandle(w,()=>({wrapperEl:_.current,lyricPlayer:m}),[m]),Ye.jsxs(Ye.Fragment,{children:[Ye.jsx("div",{...E,ref:_}),m!=null&&m.getBottomLineElement()&&g?Kh.createPortal(g,m?.getBottomLineElement()):null]})}),Dh=-1,gs=0,_r=1,ls=2,_n=3,xn=4,bn=5,Tn=6,Gh=7,zh=8,Ao=typeof self=="object"?self:globalThis,pf=(i,t)=>{const e=(s,n)=>(i.set(n,s),s),r=s=>{if(i.has(s))return i.get(s);const[n,a]=t[s];switch(n){case gs:case Dh:return e(a,s);case _r:{const o=e([],s);for(const h of a)o.push(r(h));return o}case ls:{const o=e({},s);for(const[h,l]of a)o[r(h)]=r(l);return o}case _n:return e(new Date(a),s);case xn:{const{source:o,flags:h}=a;return e(new RegExp(o,h),s)}case bn:{const o=e(new Map,s);for(const[h,l]of a)o.set(r(h),r(l));return o}case Tn:{const o=e(new Set,s);for(const h of a)o.add(r(h));return o}case Gh:{const{name:o,message:h}=a;return e(new Ao[o](h),s)}case zh:return e(BigInt(a),s);case"BigInt":return e(Object(BigInt(a)),s);case"ArrayBuffer":return e(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:o}=new Uint8Array(a);return e(new DataView(o),a)}}return e(new Ao[n](a),s)};return r},Ro=i=>pf(new Map,i)(0),Ve="",{toString:mf}={},{keys:yf}=Object,lr=i=>{const t=typeof i;if(t!=="object"||!i)return[gs,t];const e=mf.call(i).slice(8,-1);switch(e){case"Array":return[_r,Ve];case"Object":return[ls,Ve];case"Date":return[_n,Ve];case"RegExp":return[xn,Ve];case"Map":return[bn,Ve];case"Set":return[Tn,Ve];case"DataView":return[_r,e]}return e.includes("Array")?[_r,e]:e.includes("Error")?[Gh,e]:[ls,e]},qr=([i,t])=>i===gs&&(t==="function"||t==="symbol"),gf=(i,t,e,r)=>{const s=(a,o)=>{const h=r.push(a)-1;return e.set(o,h),h},n=a=>{if(e.has(a))return e.get(a);let[o,h]=lr(a);switch(o){case gs:{let u=a;switch(h){case"bigint":o=zh,u=a.toString();break;case"function":case"symbol":if(i)throw new TypeError("unable to serialize "+h);u=null;break;case"undefined":return s([Dh],a)}return s([o,u],a)}case _r:{if(h){let f=a;return h==="DataView"?f=new Uint8Array(a.buffer):h==="ArrayBuffer"&&(f=new Uint8Array(a)),s([h,[...f]],a)}const u=[],c=s([o,u],a);for(const f of a)u.push(n(f));return c}case ls:{if(h)switch(h){case"BigInt":return s([h,a.toString()],a);case"Boolean":case"Number":case"String":return s([h,a.valueOf()],a)}if(t&&"toJSON"in a)return n(a.toJSON());const u=[],c=s([o,u],a);for(const f of yf(a))(i||!qr(lr(a[f])))&&u.push([n(f),n(a[f])]);return c}case _n:return s([o,a.toISOString()],a);case xn:{const{source:u,flags:c}=a;return s([o,{source:u,flags:c}],a)}case bn:{const u=[],c=s([o,u],a);for(const[f,p]of a)(i||!(qr(lr(f))||qr(lr(p))))&&u.push([n(f),n(p)]);return c}case Tn:{const u=[],c=s([o,u],a);for(const f of a)(i||!qr(lr(f)))&&u.push(n(f));return c}}const{message:l}=a;return s([o,{name:h,message:l}],a)};return n},Mo=(i,{json:t,lossy:e}={})=>{const r=[];return gf(!(t||e),!!t,new Map,r)(i),r},vf=typeof structuredClone=="function"?(i,t)=>t&&("json"in t||"lossy"in t)?Ro(Mo(i,t)):structuredClone(i):(i,t)=>Ro(Mo(i,t)),_f="_amllWrapper_xobkp_1",xf="_isDark_xobkp_7",Io={amllWrapper:_f,isDark:xf};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(i,t){return this.cache.has(i)?this.cache.get(i):(this.cache.set(i,t),t)}};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(i,t){return this.cache.has(i)?this.cache.get(i):(this.cache.set(i,t),t)}};const Ef=it.memo(()=>{const i=Jh.c(21),t=ce(Qh),e=ce(tl),r=ce(el),s=ce(rl),n=ce(al),a=ce(ol),o=ce(hl),h=it.useRef(null);let l,u;if(i[0]!==t.lyricLines||i[1]!==a||i[2]!==n){let w;i[4]!==a||i[5]!==n?(w=m=>({...m,translatedLyric:n?m.translatedLyric:"",romanLyric:a?m.romanLyric:""}),i[4]=a,i[5]=n,i[6]=w):w=i[6],u=vf(t.lyricLines.map(w)),i[0]=t.lyricLines,i[1]=a,i[2]=n,i[3]=u}else u=i[3];l=u;const c=l;let f,p;i[7]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{setTimeout(()=>{h.current?.lyricPlayer?.calcLayout(!0,!0)},1500)},p=[],i[7]=f,i[8]=p):(f=i[7],p=i[8]),it.useEffect(f,p);const v=s&&Io.isDark;let g;i[9]!==v?(g=sl(Io.amllWrapper,v),i[9]=v,i[10]=g):g=i[10];let d,y;i[11]===Symbol.for("react.memo_cache_sentinel")?(d={height:"100%",boxSizing:"content-box"},y=w=>{h.current?.lyricPlayer?.resetScroll(),il.seekMusic(w.line.getLine().startTime/1e3)},i[11]=d,i[12]=y):(d=i[11],y=i[12]);let x;i[13]!==e||i[14]!==r||i[15]!==c||i[16]!==o?(x=Ye.jsx(ff,{style:d,onLyricLineClick:y,lyricLines:c,currentTime:e,playing:r,wordFadeWidth:o,ref:h}),i[13]=e,i[14]=r,i[15]=c,i[16]=o,i[17]=x):x=i[17];let E;return i[18]!==g||i[19]!==x?(E=Ye.jsx(nl,{className:g,children:x}),i[18]=g,i[19]=x,i[20]=E):E=i[20],E});export{Ef as AMLLWrapper,Ef as default};
//# sourceMappingURL=index-DEgCEXVd.js.map
